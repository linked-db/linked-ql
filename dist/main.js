(()=>{var Ra=Object.defineProperty;var ve=(o,e)=>{for(var t in e)Ra(o,t,{get:e[t],enumerable:!0})};var aa={};ve(aa,{CTE:()=>mt,CTEItem:()=>dt,CTEItemAlias:()=>_t,PGCycleClause:()=>ft,PGSearchClause:()=>yt});function fe(o){return!Array.isArray(o)&&typeof o=="object"&&o}function oe(o,e,t=!1,s=null){if(Array.isArray(o)&&Array.isArray(e))return o.length===e.length&&(e=e.slice(0).sort())&&o.slice(0).sort().every((r,n)=>oe(r,e[n],t,s));if(typeof o?.jsonfy=="function"&&(o=o.jsonfy()),typeof e?.jsonfy=="function"&&(e=e.jsonfy()),fe(o)&&fe(e)){let r={indexs_a:Object.keys(o),indexs_b:Object.keys(e)};if(s?.length){let n=[].concat(s);r.indexs_a=r.indexs_a.filter(a=>!n.includes(a)),r.indexs_b=r.indexs_b.filter(a=>!n.includes(a))}return r.indexs_a.length===r.indexs_b.length&&r.indexs_a.reduce((n,a)=>n&&oe(o[a],e[a],t,s),!0)}return typeof o=="string"&&typeof e=="string"&&t===!1?o.toLowerCase()===e.toLowerCase():o===e}function ga(o){let e=o.replace(/([a-z0-9])([A-Z])/g,"$1_$2");return e=e.replace(/([A-Z])([A-Z][a-z])/g,"$1_$2"),e.toUpperCase()}var ra={};ve(ra,{TOK_TYPES:()=>st,aggrFunctionNames:()=>La,dataTypes:()=>Ma,functionNames:()=>Da,keywords:()=>Ia,operators:()=>ct,statements:()=>ka});var st={data_type:{type:"data_type",value:void 0,resolve(){return this}},identifier:{type:"identifier",value:void 0,delim:[void 0],resolve({dialect:o,mysqlAnsiQuotes:e}={}){return{...this,delim:this.delim.concat(o==="mysql"?e?['"',"`"]:["`"]:['"'])}}},keyword:{type:"keyword",value:void 0,resolve(){return this}},operator:{type:"operator",value:void 0,prec:void 0,assoc:void 0,resultType:void 0,resolve(){return this}},punctuation:{type:"punctuation",value:void 0,resolve(){return this}},string_literal:{type:"string_literal",value:void 0,delim:["'"],modifier:[void 0],resolve({dialect:o,mysqlAnsiQuotes:e}={}){return{...this,delim:this.delim.concat(o==="mysql"?e?[]:['"']:[/^(\$\$|\$[a-zA-Z_][a-zA-Z0-9_]*\$)$/]),modifier:this.modifier.concat(o==="mysql"?["N"]:["E"])}}},number_literal:{type:"number_literal",value:void 0,match({value:o}){return!!/^[+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?$/.test(o)}},null_literal:{type:"null_literal",value:void 0,resolve(){return this}},unknown_literal:{type:"unknown_literal",value:void 0,resolve(){return this}},bool_literal:{type:"bool_literal",value:void 0,resolve(){return this}},hex_literal:{type:"hex_literal",value:void 0,resolve(){return this}},bit_literal:{type:"bit_literal",value:void 0,resolve(){return this}},bind_var:{type:"bind_var",value:void 0,delim:[],resolve({dialect:o}={}){return{...this,delim:this.delim.concat(o==="mysql"?["?"]:["$"])}}},version_spec:{type:"version_spec",value:void 0,delim:[void 0,"'"],resolve(){return this}},user_var:{type:"user_var",value:void 0,delim:[void 0],resolve({dialect:o}={}){return{...this,delim:this.delim.concat(o==="mysql"?["'"]:[])}}},system_var:{type:"system_var",value:void 0,resolve(){return this}},brace_block:{type:"brace_block",value:void 0,resolve(){return this}},bracket_block:{type:"bracket_block",value:void 0,resolve(){return this}},parent_block:{type:"paren_block",value:void 0,resolve(){return this}},block_comment:{type:"block_comment",value:void 0,resolve(){return this}},line_comment:{type:"line_comment",value:void 0,delim:["--"],resolve({dialect:o}={}){return{...this,delim:this.delim.concat(o==="mysql"?["#"]:[])}}}},ka={common:["ALTER","CREATE","DROP","SELECT","INSERT","UPSERT","UPDATE","MERGE","DELETE","BEGIN","COMMIT","ROLLBACK","RELEASE","DESCRIBE","EXPLAIN","USE"],postgres:["ANALYZE","CLUSTER","COMMENT ON","REFRESH","REINDEX","VACUUM"],mysql:["ANALYZE","FLUSH","LOCK","OPTIMIZE","RENAME","REPAIR","RESET","SET","SHOW","TRUNCATE","UNLOCK"]},Ia={common:["ALL","ON","NO","KEY","ANY","AS","BY","ASC","CASE","CAST","DEFAULT","DESC","DO","DISTINCT","ELSE","END","ESCAPE","EXISTS","FIRST","LAST","FOLLOWING","FOR","HAVING","FILTER","SHARE","UNIQUE","JOIN","SEPARATOR","SKIP","LOCKED","NOWAIT","OF","RECURSIVE","LIMIT","LOAD","NEXT","NOTHING","NULLS","OFFSET","ONLY","TIES","OVER","PARTITION","PRECEDING","RANGE","RETURNING","ROW","ROWS","INCLUDE","EXCLUDE","SET","SOME","THEN","USING","MATERIALIZED","MODE","TEMPORARY","MATCH","PARTIAL","SIMPLE","WITHIN","BOTH","CHECK","PRIMARY","FOREIGN","CONSTRAINT","REFERENCES","INHERITS","DATABASE","TABLE","COLUMN","INDEX","SEQUENCE","TRIGGER","VIEW","SAVEPOINT","VALUES","WHEN","WHERE","WINDOW","WITH","WITHOUT","TO","TABLESPACE","INTO","FROM","GROUP","ORDER","PARTITION","BREADTH","DEPTH","GENERATED","ALWAYS","INNER","LEFT","RIGHT","OUTER","FULL","CROSS","NATURAL","NO OTHERS","NO INHERIT","ROLLUP","UNBOUNDED","CURRENT ROW","GROUPS","IGNORE","RESPECT","CHARACTER SET","NO ACTION","SET NULL","SET DEFAULT","RESTRICT","CASCADE","STORED","GIST"],postgres:["ARRAY","GROUPING SETS","CUBE","TABLESAMPLE","REPEATABLE","SEARCH","LATERAL","ORDINALITY","OVERLAPS","SIMILAR","BERNOULLI","SYSTEM","UNLOGGED","PERFORM","CURRENT OF","TYPE","EXTENSION","IMMUTABLE","STABLE","VOLATILE","CYCLE","CONFLICT","TEMP","TIME ZONE","FETCH","LOCAL","IDENTITY","DEFERRABLE","INITIALLY","DEFERRED","IMMEDIATE"],mysql:["LOCK","RENAME","REPLACE","SHOW","UNLOCK","VIRTUAL","VISIBLE","INVISIBLE","HIGH_PRIORITY","CACHE","SQL_CACHE","SQL_NO_CACHE","STRAIGHT_JOIN","COMMENT","DATABASES","TABLES","COLUMNS","PROCEDURE","FUNCTION","AUTO_INCREMENT","CHARACTER SET","ENGINE","VALUE","DUPLICATE"]},Da={common:["NOW","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","IF","NULLIF","IFNULL","COALESCE","GREATEST","LEAST","CONCAT","GROUPING","CONCAT_WS","FORMAT","UNNEST","MD5","SHA1","ST_ASTEXT","ST_ASGEOJSON","ST_GEOMFROMTEXT","ST_WITHIN","ST_CONTAINS","ST_INTERSECTS","ST_DISTANCE","ST_BUFFER"],postgres:["MAKE_DATE","MAKE_TIME","MAKE_TIMESTAMP","TO_JSON","TO_JSONB","JSON_TYPEOF","JSONB_TYPEOF","JSON_BUILD_ARRAY","JSONB_BUILD_ARRAY","JSON_BUILD_OBJECT","JSONB_BUILD_OBJECT","JSON_POPULATE_RECORD","JSONB_POPULATE_RECORD","JSON_PATH_QUERY","JSON_PATH_EXISTS"],mysql:["CURDATE","CURTIME","SYSDATE","STR_TO_DATE","MAKEDATE","MAKETIME","JSON_ARRAY","JSON_OBJECT","JSON_EXTRACT","JSON_UNQUOTE","JSON_SET","JSON_INSERT","JSON_REPLACE","JSON_REMOVE","JSON_SEARCH","JSON_CONTAINS","JSON_CONTAINS_PATH","JSON_KEYS","JSON_ARRAY_APPEND","JSON_ARRAY_INSERT","JSON_DEPTH","JSON_LENGTH","JSON_MERGE_PRESERVE","JSON_MERGE_PATCH","JSON_PRETTY","JSON_STORAGE_FREE"]},La={common:["COUNT","SUM","AVG","MIN","MAX","COVAR_POP","COVAR_SAMP","CORR","ROW_NUMBER","BIT_AND","BIT_OR","STDDEV_POP","STDDEV_SAMP","VAR_POP","VAR_SAMP","VARIANCE","STD","LEAD","LAG","NTILE","FIRST_VALUE","LAST_VALUE"],postgres:["ARRAY_AGG","STRING_AGG","REGR_SLOPE","PERCENTILE_CONT","PERCENTILE_DISC","MODE","RANK","DENSE_RANK","EVERY","BOOL_AND","BOOL_OR","JSON_AGG","JSON_OBJECT_AGG","JSONB_OBJECT_AGG","XMLAGG"],mysql:["GROUP_CONCAT","BIT_XOR","JSON_ARRAYAGG","JSON_OBJECTAGG"]},Ma={common:["SMALLINT","INTEGER","INT","BIGINT","DECIMAL","DEC","NUMERIC","REAL","FLOAT","DATE","TIME","TIMESTAMP","INTERVAL","CHAR","CHARACTER","VARCHAR","TEXT","BINARY","VARBINARY","BOOLEAN","JSON","GEOMETRY","POINT","LINESTRING","POLYGON","DOUBLE PRECISION","CHARACTER VARYING","BYTEA","ENUM"],postgres:["SERIAL","BIGSERIAL","MONEY","BIT","CIDR","INET","MACADDR","MACADDR8","TIMESTAMPTZ","TIMETZ","TSVECTOR","TSQUERY","UUID","XML","INT4RANGE","INT8RANGE","NUMRANGE","TSRANGE","TSTZRANGE","DATERANGE","BOX","PATH","CIRCLE","LINE","LSEG","POLYGON","OID","BIT VARYING","JSONB","REGCLASS"],mysql:["TINYINT","MEDIUMINT","BIT","YEAR","DATETIME","TINYTEXT","QUERY","MEDIUMTEXT","LONGTEXT","TINYBLOB","BLOB","MEDIUMBLOB","LONGBLOB","GEOMETRYCOLLECTION","MULTIPOINT","MULTILINESTRING","MULTIPOLYGON","BOOL"]},ct={common:[["<~",{prec:90,assoc:"left",resultType:":right"}],["~>",{prec:90,assoc:"right",resultType:":right"}],["BETWEEN",{prec:85,assoc:"left",resultType:"boolean"}],["NOT",{prec:80,assoc:"right",resultType:"boolean"}],["*",{prec:70,assoc:"left",resultType:"number"}],["/",{prec:70,assoc:"left",resultType:"number"}],["%",{prec:70,assoc:"left",resultType:"number"}],["+",{prec:60,assoc:"left",resultType:"number"}],["-",{prec:60,assoc:"left",resultType:"number"}],["&",{prec:60,assoc:"left",resultType:"number"}],["|",{prec:60,assoc:"left",resultType:"number"}],["<<",{prec:60,assoc:"left",resultType:"number"}],[">>",{prec:60,assoc:"left",resultType:"number"}],["=",{prec:50,assoc:"left",resultType:"boolean"}],["!=",{prec:50,assoc:"left",resultType:"boolean"}],["<>",{prec:50,assoc:"left",resultType:"boolean"}],["<",{prec:50,assoc:"left",resultType:"boolean"}],["<=",{prec:50,assoc:"left",resultType:"boolean"}],[">",{prec:50,assoc:"left",resultType:"boolean"}],[">=",{prec:50,assoc:"left",resultType:"boolean"}],["IS",{prec:50,assoc:"left",resultType:"boolean"}],["IS NOT",{prec:50,assoc:"left",resultType:"boolean"}],["DISTINCT FROM",{prec:50,assoc:"left",resultType:"boolean"}],["IN",{prec:50,assoc:"left",resultType:"boolean"}],["LIKE",{prec:50,assoc:"left",resultType:"boolean"}],["AND",{prec:40,assoc:"left",resultType:"boolean"}],["OR",{prec:30,assoc:"left",resultType:"boolean"}],["INTERSECT",{prec:20,assoc:"left",resultType:"set"}],["UNION",{prec:10,assoc:"left",resultType:"set"}],["EXCEPT",{prec:10,assoc:"left",resultType:"set"}]],postgres:[["COLLATE",{prec:83,assoc:"left",resultType:"string"}],["||",{prec:60,assoc:"left",resultType:"string"}],["::",{prec:100,assoc:"left",resultType:"casted"}],["AT",{prec:95,assoc:"left",resultType:"timestamptz"}],["^",{prec:90,assoc:"left",resultType:"number"}],["#",{prec:60,assoc:"left",resultType:"number"}],["->",{prec:80,assoc:"left",resultType:"json"}],["->>",{prec:80,assoc:"left",resultType:"text"}],["#>",{prec:80,assoc:"left",resultType:"json"}],["#>>",{prec:80,assoc:"left",resultType:"text"}],["@>",{prec:80,assoc:"left",resultType:"boolean"}],["<@",{prec:80,assoc:"left",resultType:"boolean"}],["?",{prec:80,assoc:"left",resultType:"boolean"}],["?|",{prec:80,assoc:"left",resultType:"boolean"}],["?&",{prec:80,assoc:"left",resultType:"boolean"}],["-@",{prec:80,assoc:"left",resultType:"boolean"}],["#-",{prec:80,assoc:"left",resultType:"json"}],["@?",{prec:80,assoc:"left",resultType:"boolean"}],["@@",{prec:80,assoc:"left",resultType:"boolean"}],["ILIKE",{prec:50,assoc:"left",resultType:"boolean"}],["~",{prec:50,assoc:"left",resultType:"boolean"}],["!~",{prec:50,assoc:"left",resultType:"boolean"}],["~*",{prec:50,assoc:"left",resultType:"boolean"}],["!~*",{prec:50,assoc:"left",resultType:"boolean"}],["SIMILAR TO",{prec:50,assoc:"left",resultType:"boolean"}],["&&",{prec:60,assoc:"left",resultType:"boolean"}],["<->",{prec:60,assoc:"left",resultType:"number"}],["@",{prec:60,assoc:"left",resultType:"geometry"}],["&<",{prec:60,assoc:"left",resultType:"boolean"}],["&>",{prec:60,assoc:"left",resultType:"boolean"}],["|-",{prec:60,assoc:"left",resultType:"boolean"}],["-|",{prec:60,assoc:"left",resultType:"boolean"}],["<<",{prec:60,assoc:"left",resultType:"boolean"}],[">>",{prec:60,assoc:"left",resultType:"boolean"}],["<<|",{prec:60,assoc:"left",resultType:"boolean"}],["|>>",{prec:60,assoc:"left",resultType:"boolean"}],["&<|",{prec:60,assoc:"left",resultType:"boolean"}],["|&>",{prec:60,assoc:"left",resultType:"boolean"}],["~=",{prec:50,assoc:"left",resultType:"boolean"}],["?#",{prec:60,assoc:"left",resultType:"boolean"}],["?-",{prec:60,assoc:"left",resultType:"boolean"}],["?-|",{prec:60,assoc:"left",resultType:"boolean"}],["?|",{prec:60,assoc:"left",resultType:"boolean"}],["?||",{prec:60,assoc:"left",resultType:"boolean"}],["#",{prec:60,assoc:"left",resultType:"number"}],["##",{prec:60,assoc:"left",resultType:"geometry"}],["@-@",{prec:60,assoc:"left",resultType:"number"}]],mysql:[["DIV",{prec:70,assoc:"left",resultType:"number"}],["MOD",{prec:70,assoc:"left",resultType:"number"}],["BINARY",{prec:90,assoc:"right",resultType:"binary"}],["^",{prec:80,assoc:"left",resultType:"number"}],["~",{prec:85,assoc:"right",resultType:"number"}],["<=>",{prec:50,assoc:"left",resultType:"boolean"}],["REGEXP",{prec:50,assoc:"left",resultType:"boolean"}],["RLIKE",{prec:50,assoc:"left",resultType:"boolean"}],["!",{prec:80,assoc:"right",resultType:"boolean"}],["XOR",{prec:40,assoc:"left",resultType:"boolean"}],["&&",{prec:40,assoc:"left",resultType:"boolean"}],["||",{prec:30,assoc:"left",resultType:"boolean"}],[":=",{prec:10,assoc:"right",resultType:":right"}],["SOUNDS LIKE",{prec:50,assoc:"left",resultType:"boolean"}]]};var at=class{buffer="";cursor=0;line=1;column=1;mysqlBindingIndex=0;nestingContext=[];nextTokenEscape=0;next(e=1,t=!1){t&&(this.line++,this.column=0),this.column+=e,this.cursor+=e,this.nextTokenEscape===1?this.nextTokenEscape=2:this.nextTokenEscape===2&&(this.nextTokenEscape=0)}},nt=class{#e;#i;#t=!1;#n=!1;#o=!1;#r=null;#s=[];#a;#l=[];constructor(e,{state:t,...s}={}){this.#e=e,this.#i=s}[Symbol.asyncIterator](){return this}get options(){return this.#i}get locked(){return this.#t}get started(){return this.#n}get done(){return this.#o&&!this.#l.length}previous(){return this.#s[this.#s.length-1]}current(){return this.#a}async next(){this.#u("next()"),this.#n=!0;let e,t=!1;return this.#l.length?(this.#p(this.#a),this.#a=this.#f(),e=this.#a):({value:e,done:t}=await this.#e.next(),this.#p(this.#a),this.#a=e,this.#o=t),this.#r!==null&&e?.type.endsWith("_block")&&e.value.savepoint(),{value:e,done:t}}async match(e,t=void 0){let[s,r,n]=typeof arguments[0]=="number"?arguments:[0,e,t],a=p=>p&&(Array.isArray(r)?r.includes(p.type):r===p.type)&&(n===void 0||(Array.isArray(n)?n.includes(p.value)||n.includes(void 0):n===p.value))&&p||void 0;if(s===1/0){let p=0,c;for(;c=await this.peek(p++);)if(a(c))return c;return}return a(s?await this.peek(s):this.current())}async peek(e=1){if(e===0)return this.#a;let t=e-this.#l.length;for(;t;){let r=await this.#e.next();if(r.done)break;this.#m(r.value),t--}return this.#l[e-1]}async eat(e=void 0,t=void 0){let s=e?await this.match(e,t):this.current();return s&&(await this.next())?.value,s}async expect(e,t=void 0){let s=await this.eat(e,t);if(!s)throw new Error(`Expected token: ${e}${t?` (${t})`:""}`);return s}#p(e){e?.type.endsWith("_block"),this.#r!==null?this.#s.push(e):this.#s=[e]}#f(){let e=this.#l.shift();return e?.type.endsWith("_block")&&(e.value.#t=!1),e}#c(){let e=this.#s.pop();return e?.type.endsWith("_block")&&e.value.restore(e.value.#r),e}#y(e){e?.type.endsWith("_block")&&(e.value.restore(e.value.#r),e.value.#t=!0),this.#l.unshift(e)}#m(e){e?.type.endsWith("_block")&&(e.value.#t=!0),this.#l.push(e)}#u(e){if(this.#t)throw new Error(`Can't execute ${e}; TokenStream is locked`)}savepoint(){this.#u("savepoint()");let e=this.#s.length;return this.#r===null&&(this.#r=e),e}savepointStatus(){return this.#r!==null?this.#s.length:null}restore(e){if(this.#u("restore()"),this.#r===null||typeof e!="number"||e>this.#s.length)throw new Error(`Invalid restore point ${e}${this.#r===null?". Not in savepoint mode":""}`);for(;e<this.#s.length;)this.#a&&this.#y(this.#a),this.#a=this.#c()}commit(e){if(this.#u("commit()"),e!==this.#r)return;let t;for(;e<this.#s.length&&(t=this.#c());)t.type.endsWith("_block")&&t.value.commit(t.value.#r);this.#r=null}static async create(e,{dialect:t="postgres",state:s=new at,...r}={}){return Array.isArray(e)&&e.every(n=>typeof n=="object"&&n?.type)&&(e=e.slice())?new this(e[Symbol.iterator](),{dialect:t,...r}):(r.normalized||(r=Ea({dialect:t,...r,normalized:!0})),new this(await this.createIterator(e,{dialect:t,state:s,...r,extendedAPI:!0}),{dialect:t,...r}))}static toIterator(e){return typeof e[Symbol.asyncIterator]=="function"?typeof e.next=="function"?e:e[Symbol.asyncIterator]():typeof e[Symbol.iterator]=="function"&&typeof e!="string"&&!(e instanceof String)?typeof e.next=="function"?e:e[Symbol.iterator]():function*(){yield e+""}()}static async*createIterator(e,{dialect:t="postgres",state:s=new at,...r}={}){let n=this.toIterator(e);if(!["postgres","mysql"].includes(t))throw new Error(`Unknown dialect: ${t}`);if(!(s instanceof at))throw new Error("options.state must be an instance of TokenStreamState");r.normalized?r={dialect:t,...r}:r=Ea({dialect:t,...r,normalized:!0});let a={token:null,prevEmittedToken:null,nextTokenSpaceBefore:"",multiwordBuffer:[]},p=(u,f=!1)=>u?Sa(u,{options:r,state:s,localState:a},f):[],c={value:""};do{s.buffer+=c.value||"";let u;for(;u=s.buffer[s.cursor];){let f=s.buffer[s.cursor+1]===void 0&&!c.done,m=Na.has(u),d=()=>{throw new SyntaxError(`Unexpected token: ${u} at line ${s.line}, column ${s.column}`)};if(a.token?.type==="hex_literal"||a.token?.type==="bit_literal"){(a.token.delim?u===a.token.delim:m)?(yield*p(a.token),a.token=null,m&&r.spaces&&(a.nextTokenSpaceBefore+=u)):(a.token?.type==="hex_literal"?/[0-9A-Fa-f]/.test(u)||d():/[01]/.test(u)||d(),a.token.value+=u),s.next();continue}if(a.token?.type==="version_spec"){let _=a.token.delim&&u===a.token.delim,S=_||m||u==="."||u===","||u===";"||u===")";if(S?(yield*p(a.token),a.token=null):(a.token.value&&(u==="="?["<",">"].includes(a.token.value)||d():u==="_"?/\d$/.test(a.token.value)||d():/\d/.test(u)||d()),a.token.value+=u),!S||_){s.next();continue}}if(m){let _=a.token?.type==="string_literal",S=a.token?.type==="identifier"&&a.token.delim,g=a.token?.type==="block_comment",E=a.token?.type==="line_comment";if(_||S||g||E&&!(u==="\r"||u===`
`))a.token.value+=u;else{let C=s.buffer[s.cursor-1];!Na.has(C)&&a.token&&(yield*p(a.token),a.token=null),r.spaces&&(a.nextTokenSpaceBefore+=u)}u===`
`||u==="\r"?s.next(1,!0):s.next();continue}if(u==="\\"){if(f)break;let _=s.buffer[s.cursor+1],S=a.token?.type==="string_literal"&&(r.dialect==="mysql"?!r.mysqlNoBackslashEscapes:a.token.modifier==="E"),g=_===a.token?.delim||_==="\\"||_==="0"||_==="b"||_==="f"||_==="n"||_==="r"||_==="t"||_==="v"||_==="Z";if(S&&g){_={"\\":"\\",0:"\0",b:"\b",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",Z:""}[_]||_,a.token.value+=_,s.next(2);continue}s.nextTokenEscape=1,s.next();continue}if(a.token?.type==="block_comment"||a.token?.type==="line_comment"||a.token?.type==="string_literal"||a.token?.type==="identifier"&&a.token.delim||a.token?.type==="user_var"&&a.token.delim){let _;if(a.token.type==="block_comment"){if(u==="*"){if(f)break;_=s.buffer[s.cursor+1]==="/"?2:0}}else if(u===a.token.delim){if(a.token.type==="identifier"||a.token.type==="string_literal"&&(r.dialect==="mysql"?r.mysqlNoBackslashEscapes:a.token.modifier!=="E")){if(f)break;if(s.buffer[s.cursor+1]===u){a.token.value+=u,s.next(2);continue}}_=1}else if(a.token.type==="string_literal"&&a.token.delim.startsWith("$")&&u==="$"){let S=s.cursor+1;s.buffer.slice(S-a.token.delim.length,S)===a.token.delim&&(a.token.value=a.token.value.slice(0,-a.token.delim.length+1),_=1)}if(_){yield*p(a.token),a.token=null,s.next(_);continue}a.token.value+=u,s.next();continue}if(s.nestingContext.length&&u==={"{":"}","[":"]","(":")"}[s.nestingContext[0]]){if(yield*p(a.token,!0),s.nestingContext.shift(),r.structured){s.next(),a.nestingEndTagSeen=!0;return}a.token=null}let y,N=0,x=0;if(r.dialect==="postgres"){if(a.token?.type==="pg_possible_dollar_delim"||u==="$"){if(a.token?.type==="pg_possible_dollar_delim"){if(u==="$"){let{type:S,value:g,delim:E,...C}=a.token;a.token={type:"string_literal",value:"",delim:`$${g}$`,...C}}else a.token.value+=u;s.next();continue}if(f)break;let _=s.buffer[s.cursor+1];/[0-9]/.test(_)?y={type:"bind_var"}:y={type:"pg_possible_dollar_delim",delim:u}}}else r.dialect==="mysql"&&(u==="?"&&(y={type:"bind_var"}),u==="#"&&(y={type:"line_comment",delim:u}),u==="`"&&(y={type:"identifier",delim:u}));if(u==="'"){let _=new RegExp(`(@)$|^\\W?(${r.dialect==="postgres"?"E|X|B":"N|X"})$`,"i"),S=s.buffer.slice(Math.max(s.cursor-2,0),s.cursor).match(_),g=S?.[1]||S?.[2];if(g==="@"&&a.prevEmittedToken?.type==="identifier"){if(f)break;let E=s.buffer[s.cursor+1];/[\^~=\d<>!]/.test(E)&&(y={type:"version_spec",delim:u},N=1)}if(!y)if(g&&(g!=="@"||r.dialect==="mysql")){let E=/^(E|N)/i.test(g)?"string_literal":g==="@"?"user_var":(g==="X"?"hex_":"bit_")+"literal";y={type:E,...E==="string_literal"?{modifier:g.toUpperCase()}:{},delim:u},N=g==="@"?1:g.length}else y={type:"string_literal",delim:u}}else u==='"'&&(y={type:r.dialect!=="mysql"||r.mysqlAnsiQuotes?"identifier":"string_literal",delim:u});if(u==="@"){if(f)break;let _=s.buffer[s.cursor+1];(a.token||a.prevEmittedToken)?.type==="identifier"&&/[\^~=\d<>!]/.test(_)?y={type:"version_spec"}:r.dialect==="mysql"&&(_==="@"?(y={type:"system_var"},x=1):/[a-zA-Z_$]/.test(_)&&(y={type:"user_var"}))}if(u==="/"||u==="-"){if(f)break;let _=s.buffer[s.cursor+1];u==="/"&&_==="*"?(y={type:"block_comment"},x=1):u==="-"&&_==="-"&&(y={type:"line_comment",delim:u+_},x=1)}if(y){a.token&&!N&&(yield*p(a.token)),a.token={type:y.type,value:"",...y,line:s.line,column:N?s.column-N:s.column},s.next(1+x);continue}if((u==="{"||u==="["||u==="(")&&(yield*p(a.token),a.token=null,s.nestingContext.unshift(u),r.structured)){s.next();let _={type:{"{":"brace_block","[":"bracket_block","(":"paren_block"}[u],value:await this[r.extendedAPI?"create":"createIterator"](n,{state:s,...r}),line:s.line,column:s.column};if(yield*p(_),r.extendedAPI)await _.value.peek(1/0);else for(;!(await _.value.next()).done;);continue}if(/[0-9]/.test(u)){if(a.token?.type!=="identifier"&&a.token?.type!=="bind_var"&&a.token?.type!=="version_spec"&&!a.token?.type.endsWith("_literal")&&!a.token?.type.endsWith("_var")){if(yield*p(a.token),u==="0"){if(f)break;let _=s.buffer[s.cursor+1]?.toUpperCase();if((_==="X"||_==="B")&&r.dialect==="mysql"){a.token={type:(_==="X"?"hex_":"bit_")+"literal",value:"",line:s.line,column:s.column},s.next(2);continue}}a.token={type:"number_literal",value:u,line:s.line,column:s.column},s.next();continue}}else if(/[a-zA-Z_]/.test(u)){if(a.token?.type!=="identifier"&&!a.token?.type.endsWith("_var")&&!(a.token?.type==="number_literal"&&/\d$/.test(a.token.value)&&/E/i.test(u))){a.token?.type==="number_literal"&&d(),yield*p(a.token),a.token={type:"identifier",value:u,line:s.line,column:s.column},s.next();continue}}else{let _="operator";if(u===";"||u===","||u===":"||u==="{"||u==="}"||u==="["||u==="]"||u==="("||u===")"){if(u===":"&&(s.nestingContext[0]!=="{"||s.nextTokenEscape)?_="operator":_="punctuation",r.dialect==="postgres"&&u===":"&&_==="operator"&&a.token?.type!=="operator"){let S=s.buffer[s.cursor-1];if(f)break;let g=s.buffer[s.cursor+1];S!==":"&&/[a-zA-Z_]/.test(g)&&r.PL_SQL!==!1&&(_="user_var",u="")}}else if(u===".")if(a.token?.type==="number_literal")a.token.value.includes(".")&&d(),_="number_literal";else{if(f)break;let S=s.buffer[s.cursor+1];/\d/.test(S)?_="number_literal":(_="punctuation",a.token?.type==="system_var"&&(_="system_var"))}else(u==="+"||u==="-")&&a.token?.type==="number_literal"&&/E$/i.test(a.token.value)&&(/\+|\-/.test(a.token.value)&&d(),_="number_literal");if(a.token?.type!==_||_==="punctuation"||_==="operator"&&!r.operators.classic.has(`${a.token.value}${u}`)){yield*p(a.token),a.token={type:_,value:u,line:s.line,column:s.column},s.next();continue}}a.token.value+=u,s.next()}if(c.done)break;s.buffer=s.buffer.slice(s.cursor),s.cursor=0}while(c=await n.next());if(a.token){if(a.token.type==="operator"&&a.token.value!=="*"||a.token.type==="number_literal"&&/E$/i.test(a.token.value)||a.token.type==="block_comment"||a.token.type==="pg_possible_dollar_delim"||["string_literal","hex_literal","bit_literal","identifier","version_spec","user_var"].includes(a.token.type)&&a.token.delim)throw new SyntaxError(`Unterminated ${a.token.type} at line ${s.line}, column ${s.column}`);yield*p(a.token,!0)}if(s.nestingContext.length&&!a.nestingEndTagSeen)throw new SyntaxError(`Unterminated nesting "${s.nestingContext[0]}" at line ${s.line}, column ${s.column}`)}},Na=new Set([" ","\f",`
`,"\r","	","\v"]);function Ea(o){let e=(t,s,r,n)=>{r.split(" ").reduce((a,p)=>(a=a?`${a} ${p}`:p,t.set(a,n),a),s)};for(let t of["statements","functionNames","aggrFunctionNames","keywords","operators","dataTypes"]){let s=["statements","functionNames","aggrFunctionNames"].includes(t)?"keywords":t,r=o[s]||{classic:new Map,compound:new Map};for(let n of["common",o.dialect==="mysql"?"mysql":"postgres"]){let a=ra[t][n];for(let p of a){let[c,u]=Array.isArray(p)?[p[0],{...p[1],value:p[0]}]:[p,{value:p}];c.includes(" ")?e(r.compound,"",c,u):r.classic.set(c,u)}}o={...o,[s]:r}}return o}function Sa(o,{options:e,state:t,localState:s},r=!1){if(s.nextTokenSpaceBefore){let{type:p,...c}=o;o={type:p,spaceBefore:s.nextTokenSpaceBefore,...c},s.nextTokenSpaceBefore=""}if(o.type==="block_comment"||o.type==="line_comment")return Pa(o,{options:e});let n,a=!1;if(e.dialect==="mysql"&&o.type==="bind_var")n=[{...o,value:`${++t.mysqlBindingIndex}`}];else if(o.type==="operator"){let{line:p,column:c,...u}=o;n=[{...u,...e.operators.classic.get(o.value)||{},line:p,column:c}]}else o.type==="identifier"&&!o.delim&&(n=ja(o,{options:e,state:t,localState:s},r),a=!0);return n||(n=[o]),n?.length?s.prevEmittedToken=n[0]:s.prevEmittedToken=o,!a&&n.length&&s.multiwordBuffer.length?s.multiwordBuffer.splice(0).concat(n):n}function Pa(o,{options:e}){return e.comments?(o.type==="block_comment"?o={...o,value:o.value.split(`
`).map(t=>t.replace(/^[ ]+\*[ ]+?/,"").trim()).join(`
`)}:o={...o,value:o.value.trim()},[o]):[]}function ja(o,{options:e,state:t,localState:s},r=!1){let n,a=s.multiwordBuffer.length,p=(a?s.multiwordBuffer.map(N=>N.value).concat(o.value).join(" "):o.value).toUpperCase(),c=N=>{for(let x of["keywords","operators","dataTypes"]){let _=e[x][N].get(p);if(_)return[x,_]}return[]},u=()=>{let{type:N,spaceBefore:x,line:_,column:S,...g}=o;a&&(x=s.multiwordBuffer[0].spaceBefore,_=s.multiwordBuffer[0].line,S=s.multiwordBuffer[0].column);let E={type:d==="dataTypes"?"data_type":d.replace(/s$/,""),...x?{spaceBefore:x}:{},...g,...y,value:p,line:_,column:S};a?(n=[E],s.multiwordBuffer.splice(0),a=0):n=[E]},f=()=>{let N={...o,type:d==="dataTypes"?"data_type":d.replace(/s$/,"")};s.multiwordBuffer.push(N),n=[]},m=!1,[d,y]=c("compound");if(y?.value===p)u(),m=!0;else if(y){let[N,x]=c("classic");x&&N!==d&&([d,y]=[N,x]),r?u():f(),m=!0}else[d,y]=c("classic"),y&&(u(),m=!0);if(!m&&a){let N=s.multiwordBuffer.splice(0),x=Sa(o,{options:e,state:t,localState:s});return[...N,...x]}if(!n&&/^(TRUE|FALSE|NULL|UNKNOWN)$/i.test(o.value)){let{type:N,...x}=o;n=[{type:/UNKNOWN/.test(o.value)?"unknown_literal":/NULL/i.test(o.value)?"null_literal":"bool_literal",...x,value:o.value.toUpperCase()}]}return n}var l=Object.create(null);var h=class o{static get NODE_NAME(){return ga(this.name)}get NODE_NAME(){return this.constructor.NODE_NAME}#e;get _ast(){return this.#e}#i;get options(){return this.#i||this.#t?.options||{dialect:"postgres"}}#t;get parentNode(){return this.#t}get statementNode(){return this.#t?.statementNode}get rootNode(){return this.#t?.rootNode||this}constructor(e={},t={}){this.#e=e,this.#i=t;for(let s of Object.values(this.#e))this._adoptNodes(...[].concat(s))}_has(e,t=void 0,s=void 0){return e in this.#e?typeof t=="number"?typeof this.#e[e][t]<"u":t?this.#e[e].some(r=>r.identifiesAs?.(t,s)):!0:!1}_get(e,t=void 0,s=void 0){if(!(e in this.#e))return;if(typeof t<"u"&&!Array.isArray(this.#e[e]))throw new Error(`Can't use index in field "${e}"; not an array.`);let r=this.#e[e];return typeof t=="number"?r=r[t]:t&&(r=r.find(n=>n.identifiesAs?.(t,s))),r}_set(e,t,s=void 0,r=void 0){let n=arguments.length>2?t:void 0,a=arguments.length>2?s:t,p=this._get(e,n,r);return p&&this._unadoptNodes(...[].concat(p)),typeof n<"u"?this.#e[e]=p?this.#e[e].reduce((c,u)=>u===p?c.concat(a):c.concat(u),[]):this.#e[e].concat(a):this.#e[e]=a,this._adoptNodes(...[].concat(a)),!0}_delete(e,t=void 0,s=void 0){if(!(e in this.#e))return!1;if(typeof t<"u"&&!Array.isArray(this.#e[e]))throw new Error(`Can't use index in field "${e}"; not an array.`);return typeof t<"u"?this.#e[e]=this.#e[e].reduce((r,n,a)=>(typeof t=="number"?a===t:n.identifiesAs?.(t,s))?(this._unadoptNodes(n),r):r.concat(n),[]):(this._unadoptNodes(...[].concat(this.#e[e])),this.#e[e]=Array.isArray(this.#e[e])?[]:void 0),!0}_add(e,...t){if(!Array.isArray(this.#e[e]))throw new Error(`Can't add on field "${e}"; not an array.`);return this._adoptNodes(...t),this.#e[e]=this.#e[e].concat(t),!0}_adoptNodes(...e){for(let t of e)if(t instanceof o){if(t.#t&&t.#t!==this){let s=`${this.NODE_NAME}`;throw new Error(`[${s}] Illegal node operation`)}t.#t=this}}_unadoptNodes(...e){for(let t of e)if(t instanceof o){if(t.#t!==this){let s=`${this.NODE_NAME}`;throw new Error(`[${s}] Illegal node operation`)}t.#t=null}}climbTree(e){if(this.#t)return e(this.#t,()=>this.#t.climbTree(e))}walkTree(e){let t=(s,r)=>{!(s instanceof o)&&!Array.isArray(s)||e(s,r)!==s||(Array.isArray(s)?s.map(t):s.statementNode!==s&&s.walkTree(e))};for(let[s,r]of Object.entries(this.#e))t(r,s)}containsNode(e){return e?this===e.parentNode||this.containsNode(e.parentNode):!1}identifiesAs(e,t=!1){if(typeof e>"u")return!1;if(typeof e?.jsonfy=="function")return oe(this.jsonfy({nodeNames:!1}),e.jsonfy({nodeNames:!1}),t)}static morphsTo(){return this}clone(e={},t=null,s=null){let r=this.jsonfy(e,t,s);return[this.constructor].concat(this.constructor.morphsTo()).reduce((p,c)=>p||c.fromJSON(r,{dialect:e.toDialect||this.options.dialect}),void 0)}deSugar(e=1,t={},s=null,r=null){return t={...t,deSugar:e},this.clone(t,s,r)}toDialect(e,t={},s=null,r=null){return t={...t,toDialect:e},this.clone(t,s,r)}static get syntaxRules(){return[]}static compileASTSchemaFromSyntaxRules({dialect:e="postgres"}={}){this._astSchemaCompileCache||(this._astSchemaCompileCache=new Map);let t=`${this.NODE_NAME}:${e}`;if(!this._astSchemaCompileCache.has(t)){let s,r=this.syntaxRules,n=[].concat(r);n.length===1&&Array.isArray(n[0].type)&&!n[0].as?s=n[0]:s=this._compileASTSchemaFromSyntaxRules(r,e,{trail:[this.NODE_NAME]}),this._astSchemaCompileCache.set(t,s)}return this._astSchemaCompileCache.get(t)}static _compileASTSchemaFromSyntaxRules(e,t="postgres",{trail:s=[],schemaSet:r=new Set([new Map]),assertionTrail:n={dependencies:new Set,optional:!1,assert:!1}}={}){let a=Array.isArray(e)?e:[e],p=new Set(n.dependencies),c=f=>new Set([...f].map(m=>new Map(m)));for(let[f,m]of a.entries()){if(m.dialect&&m.dialect!==t)continue;let{type:d,as:y,if:N=n.inference,value:x,arity:_,singletons:S,modifier:g,booleanfy:E,optional:C=n.optional,assert:T=n.assert,syntax:I,syntaxes:Y,...j}=m,q=s.concat(`${Array.isArray(e)?f:""}${y?`<${y}>`:""}`||[]),$=q.join("."),B=Aa(j);if(B.length)throw new SyntaxError(`[${$}] Unsupported attributes in rule: "${B.join('", "')}".`);let G=typeof d=="string"&&d[0]===d[0].toLowerCase();if(y){if(!d)throw new SyntaxError(`[${$}] Field rules must have a "type" attribute of type string.`);if(I||Y)throw new SyntaxError(`[${$}] Field rules ("${y}") can not have a "syntax" or "syntaxes" attribute.`);if(y==="."){if(!G)throw new SyntaxError(`[${$}] Terminal Node rules must be token-typed rules.`);if(C)throw new SyntaxError(`[${$}] Terminal Node rules can not be optional.`)}else if(g)throw new SyntaxError(`[${$}] Only Terminal Node rules can have a "modifier" attribute.`);if(G){if(![void 0,null].includes(_))throw new SyntaxError(`[${$}] Token rules can not be item-based.`);if(!st[d])throw new SyntaxError(`[${$}] Unknown token type "${d}".`)}else{if(x)throw new SyntaxError(`[${$}] Only token rules can have a "value" attribute.`);for(let A of[].concat(d))if(!l[A])throw new SyntaxError(`[${$}] Unknown node type "${A}".`);if(![void 0,null].includes(_)){if(fe(_)){let A=Object.keys(_);if(A.some(K=>!["min","max","eager"].includes(K)||typeof _[K]!=(K==="eager"?"boolean":"number")))throw new SyntaxError(`Invalid arity object "{ ${A.join(", ")} }" for field "${y}". Only "min: <number>", "max: <number>" and "eager: <bool>" expected.`)}else if([].concat(_).some(A=>typeof A!="number"))throw new SyntaxError(`[${$}] Invalid arity value "${[].concat(_).join(", ")}" for field "${y}". Number(s) expected.`)}}let v={rulePath:$,type:d};x&&(v.value=x),g&&(v.modifier=g),E&&(v.booleanfy=E),[void 0,null].includes(_)||(v.arity=_),S&&(v.singletons=S),C&&(v.optional=!0),T&&(v.assert=T),N&&(v.if=N),C&&n.dependencies.size&&(v.dependencies=Array.from(n.dependencies));for(let A of r)A.set(y,v);y!=="."&&C&&!m.optional&&p.add(y)}if(I||Y){let v={dependencies:p,optional:C,assert:T,inference:N};if(I){r=this._compileASTSchemaFromSyntaxRules(I,t,{trail:q.concat("syntax"),schemaSet:r,assertionTrail:v});continue}let A=new Set;for(let[K,L]of Y.entries()){let w=c(r),P=this._compileASTSchemaFromSyntaxRules(L,t,{trail:q.concat("syntaxes",K),schemaSet:w,assertionTrail:v});for(let W of P)A.add(W)}r=A}}let u=Array.from(r);for(let f=0;f<u.length;f++){let m=u[f],d=Object.fromEntries(m);if(!m.size){r.delete(m);continue}for(let y=f+1;y<u.length;y++){let N=u[y],x=Object.fromEntries(N);oe(d,x,"cs","rulePath")&&r.delete(N)}}return r}static fromJSON(e,t={},s=null){let r=this.compileASTSchemaFromSyntaxRules(t);if(Array.isArray(r.type)){for(let m of r.type){let y=l[m].fromJSON(e,t,s);if(y)return y}return}if(e instanceof o){if(e instanceof this)return e;e=e.jsonfy()}if(!fe(e))return;let n=null;if("nodeName"in e){if(e.nodeName&&e.nodeName!==this.NODE_NAME)return;({nodeName:n,...e}=e)}let a,p=(m,d=null,y=!1)=>{if(!(!n&&t.assert!==!0&&!(t.assert instanceof RegExp&&t.assert.test(activeTrailStr)))){if(d&&(m=`[${d}] ${m}`),y){a=m;return}throw new Error(m)}},c=(m,d)=>{if(m.value!==void 0){let y=m.booleanfy?[!0,!1]:m.value;return[].concat(y).includes(d.value)}return st[m.type].match?.(d,t)!==!1},u=(m,d)=>{for(let y of[].concat(m.type))if(typeof y=="string"&&y[0]===y[0].toLowerCase()){if(c(m,{value:d})===!0)return d}else{let x=l[y].fromJSON(d,{...t,assert:!1});if(x)return x}},f=(m,d,y,N=!1)=>{if(y.dependencies?.length){for(let _ of y.dependencies)if(!(_ in m))return p(`Missing dependency field "${_}" required by "${d}"`,y.rulePath,N),!1}if(y.if&&!sa(y.if,m,y.rulePath))return!0;if(![void 0,null].includes(y.arity)){if(e[d]===void 0)return y.optional?(m[d]=void 0,!0):(p(`Missing required field "${d}"`,y.rulePath,N),!1);if(!Array.isArray(e[d]))return p(`Field "${d}" must be an array`,y.rulePath,N),!1;if(y.arity!==1/0){let g=e[d].length;if(fe(y.arity)){if("min"in y.arity&&g<y.arity.min)return p(`A minimum of ${y.arity.min} argument(s) expected but got ${g}`,y.rulePath,N),!1;if("max"in y.arity&&g>y.arity.max)return p(`A maximum of ${y.arity.max} argument(s) expected but got ${g}`,y.rulePath,N),!1}else if(![].concat(y.arity).includes(g))return p(`Exactly ${[].concat(y.arity).join(" or ")} argument(s) expected but got ${g}`,y.rulePath,N),!1}let _=e[d].map(g=>u(y,g)).filter(g=>g!==void 0),S=_.length;if(e[d].length>S)return S?(p(`Failed to resolve some arguments for "${d}"`,y.rulePath,N),!1):(p(`Failed to resolve any argument for "${d}"`,y.rulePath,N),!1);if(y.singletons){let g=_.find((E,C)=>_.slice(C+1).some(T=>y.singletons==="BY_KEY"?T.identifiesAs?.(E):T instanceof E.constructor));if(g)return p(`Duplicate entry of type "${g.constructor.name}"`,y.rulePath,N),!1}return m[d]=_,!0}if(e[d]===void 0)return y.optional?(m[d]=y.booleanfy?!1:void 0,!0):(p(`Missing required field "${d}"`,y.rulePath,N),!1);let x=u(y,e[d]);return x===void 0?(p(`Failed to resolve field "${d}"`,y.rulePath,N),!1):(m[d]=x,!0)};e:for(let m of r instanceof Map?[r]:r){let d=Object.create(null),y=new Map(m),N=e;if(y.has(".")){let x=y.get("."),_=st[x.type];if([void 0,null].includes(N.value))continue e;({value:d.value,...N}=N);for(let S of Object.keys(_))typeof _[S]!="function"&&S in N&&({[S]:d[S],...N}=N);if(c(x,d)===!1)continue e;y.delete(".")}for(let x of new Set(Object.keys(N).concat(...y.keys()))){if(!y.has(x)){if(e[x]===void 0)continue;continue e}let _=y.get(x);if(f(d,x,_,!0)===!1)continue e}return typeof s=="function"?s(d,t):new this(d,t)}p(`Failed to match any schema${a?`. ${a}`:""}`,this.NODE_NAME)}toJSON(){return this.jsonfy()}jsonfy(e={},t=null,s=null){let r=(n,a,p)=>{let c=(f=e,m=p)=>Array.isArray(a)?a.reduce((d,y,N)=>{let x=r(N,y,m);return x===void 0?d:d.concat(x)},[]):a instanceof o?a.jsonfy(f,m,s):a;if(a===void 0)return;let u=p?p.transform(a,c,n,e):c();if(u instanceof o)throw new Error('"jsonfy" transforms must return plain JSON objects.');return u};return{...e.nodeNames!==!1?{nodeName:this.NODE_NAME}:{},...Object.fromEntries(Object.entries(this.#e).reduce((n,[a,p])=>{let c=r(a,p,t);return c===void 0?n:[...n,[a,c]]},[]))}}static async toStream(e,t={}){let s=e instanceof nt?e:await nt.create(e,{structured:!0,spaces:!0,...t});return!s.current()&&!s.done&&await s.next(),s}static async parse(e,{left:t=void 0,minPrecedence:s=0,trail:r=[],...n}={}){let a=await this.toStream(e,n),p=a.savepoint(),c=this.syntaxRules,u,f;if((f=[].concat(c)).length===1&&Array.isArray(f[0].type)&&!f[0].as)f[0].expression?u=await this._parseAsExpression(a,f[0].type,{left:t,minPrecedence:s,trail:r.concat(this.NODE_NAME),...n}):u=await this._parseFromTypes(a,f[0].type,{left:t,minPrecedence:s,trail:r.concat(this.NODE_NAME),...n});else{let m=await this._parseFromRules(a,c,{left:t,minPrecedence:s,trail:r.concat(this.NODE_NAME),...n});m&&(u=new this(m,{...n,dialect:a.options.dialect}))}return u||a.restore(p),u}static async _parseAsExpression(e,t,{left:s=void 0,minPrecedence:r,trail:n,...a}){if(s)throw new Error("TODO");for(s=await this._parseFromTypes(e,t,{minPrecedence:r,trail:n,...a});s;){let p=await e.match("operator");if(!p||p.prec<r)break;let c=s,u=await this._parseFromTypes(e,t,{left:s,minPrecedence:r,trail:n,...a});if(!u)return s;s=u}return s}static async _parseFromRules(e,t,{left:s,minPrecedence:r,trail:n,...a},p={}){let c=Array.isArray(t)?t:[t],u=0,f=r;for(let[m,d]of c.entries()){if(d.dialect&&d.dialect!==e.options.dialect){u++;continue}let{requiredSpacing:y,peek:N,type:x,value:_,syntax:S,syntaxes:g,as:E,if:C,arity:T,optionalParens:I,singletons:Y,itemSeparator:j,optional:q=!1,assert:$=!1,booleanfy:B,...G}=d,v=n.concat(`${Array.isArray(t)?m:""}${E?`<${E}>`:""}`||[]),A=v.join("."),K=Aa(G);if(K.length)throw new SyntaxError(`[${A}] Unsupported attributes in rule: "${K.join('", "')}".`);let L=typeof x=="string"&&x[0]===x[0].toLowerCase(),w=E&&!L&&c[m+1]?.type==="operator"||c[m+1]?.type==="punctuation"&&c[m+1]?.value===".",P=async()=>{if(!(Array.isArray(N)&&!await H(-1))){for(let R of[].concat(x))if(s instanceof l[R])return p[E]=s,!0;return!1}},W=()=>{let R=e.current();return y===!1&&!R?.spaceBefore||y===!0&&R?.spaceBefore||y===`
`&&/\n/.test(R?.spaceBefore)},H=async(R=0)=>R?await e.match(N[0]+R,...N.slice(1)):await e.match(...N),k=async()=>{let R;if((R=await e.match("operator"))&&R.prec<r)return;let D=await e.eat(x,x.endsWith("_block")?void 0:_);return D?.type==="operator"&&(f=D.prec+(D.assoc==="right"?0:1)),D},M=async(R,D)=>{if(Array.isArray(x))return await this._parseFromTypes(R,x,{minPrecedence:D,trail:v,...a});let ue=l[x];if(!ue)throw new SyntaxError(`[${A}] Unknown node type <${x}>.`);return await ue.parse(R,{minPrecedence:D,trail:v,...a})},F=(R,D,ue=!1,se=!1)=>{if(!(!$&&!se&&a.assert!==!0&&!(a.assert instanceof RegExp&&a.assert.test(A)))){if(ue){let le=R.current()||R.previous(),_e=R.current()?ue===1?":":" near":" by";D+=le?`${_e}${typeof le.value=="string"?` "${le.value}"`:""} (${le.type}) at <line ${le.line}, column ${le.column}>`:`${_e} end of stream`}throw new SyntaxError(`[${A}] ${D}.`)}};if(x){if(s){if(!w||!await P())return;s=null;continue}else if(s===!1&&w){if(q){s=null;continue}return}}if(C&&!sa(C,p,A))continue;if(y!==void 0&&!W()){F(e,"Required spacing mismatch",!0);return}if(Array.isArray(N)&&!await H()){F(e,"Peek failure",!0);return}if(E==="."){if(!x||!L)throw new SyntaxError(`[${A}] Terminal node rules must be token-typed rules.`);let R=await k();if(!R){F(e,`Token of type "${x}"${_?` and value "${_}"`:""} expected but got "${e.current()?.type}"`,!0);return}let D,ue,se,le,_e,Xs,ge,Ae;({type:D,line:ue,column:se,spaceBefore:le,prec:_e,assoc:Xs,resultType:ge,...Ae}=R),Object.assign(p,Ae);continue}let O=e;if(typeof x=="string"&&x.endsWith("_block")){if(!(O=(await k())?.value)){if(q)continue;F(e,`Token of type "${x}" expected but got "${e.current()?.type}"`,!0);return}f=0,!O.current()&&!O.done&&await O.next()}if(![void 0,null].includes(T)){if(!E)throw new SyntaxError(`[${A}] Multi-argument field rules must have a "as" attribute.`);if(!x)throw new SyntaxError(`[${A}] Multi-argument field rules must have a "type" attribute.`);if(L)throw new SyntaxError(`[${A}] Multi-argument field rules must be node-typed rules.`);let R,D=[],ue=f;if(j?.type==="operator"){let se=j.value&&(O.options.operators?.classic.get(j.value)||O.options.operators?.compound.get(j.value));se?.prec&&(ue=se?.prec+1)}for(;R=await M(O,ue);){if(Y&&(Y==="BY_KEY"?D.some(le=>le.identifiesAs?.(R)):D.some(le=>le instanceof R.constructor))){F(O,`Duplicate entry of type "${R.constructor.name}"`,!0,!0);return}if(D.push(R),fe(T)&&T.eager===!1&&D.length===T.max||j&&!await O.eat(j.type,j.value))break}if(T!==1/0){let se=D.length;if(!se&&q)continue;let le=O.current(),_e=le?`. Unexpected ${le.type}${typeof le.value=="string"?` "${le.value}"`:""}`:"";if(fe(T)){if("min"in T&&se<T.min){F(O,`A minimum of ${T.min} argument(s) expected but got ${se}${_e}`,!0);return}if("max"in T&&se>T.max){F(O,`A maximum of ${T.max} argument(s) expected but got ${se}${_e}`,!0);return}}else if(![].concat(T).includes(se)){F(O,`Exactly ${[].concat(T).join(" or ")} argument(s) expected but got ${se}${_e}`,!0);return}}p[E]=D;continue}let J;if(S){let R=O.savepoint();J=await this._parseFromRules(O,S,{left:s,minPrecedence:f,trail:v.concat("syntax"),...a}),J===void 0?O.restore(R):s&&(s=null)}else if(g){for(let[R,D]of g.entries()){let ue=O.savepoint();if(J=await this._parseFromRules(O,D,{left:s,minPrecedence:f,trail:v.concat("syntaxes",R),...a}),J===void 0)O.restore(ue);else break}J!==void 0&&s&&(s=null)}else if(!(typeof x=="string"&&x.endsWith("_block")))J=L?(await k())?.value:await M(O,f);else if(!x)throw new SyntaxError(`[${A}] Rules must have a "type", "syntax" or "syntaxes" attribute.`);if(J===void 0&&!q){F(O,x?"Unexpected token":null,1);return}if(typeof x=="string"&&x.endsWith("_block")&&!O.done&&O.current())return;E?(B&&(J=J!==void 0),p[E]=J):(S||g)&&Object.assign(p,J)}if(u!==c.length)return p}static async _parseFromTypes(e,t,{left:s,minPrecedence:r,trail:n,...a}){for(let p of t)if(typeof p=="string"&&p[0]===p[0].toLowerCase()){if(await e.match(p))return await e.eat()}else{let u=l[p];if(!u)throw new SyntaxError(`[${this.NODE_NAME}] Unknown node type "${p}".`);let f=await u.parse(e,{left:s,minPrecedence:r,trail:n,...a});if(f!==void 0)return f}}toString(){return this.stringify()}stringify(e={}){return this._stringifyFromRules(this.constructor.syntaxRules,{trail:[this.NODE_NAME],...e})}_stringifyFromRules(e,{trail:t=[],startingIndentLevel:s=0,autoLineBreakThreshold:r=60,...n},a=null){let p=()=>" ",c=d=>`
${(n.tabSpaces===4?"	":" ".repeat(n.tabSpaces||2)).repeat(d)}`,u=[],f=[].concat(e),m=0;for(let[d,y]of f.entries()){if(y.dialect&&y.dialect!==this.options.dialect)continue;let{requiredSpacing:N,type:x,value:_,booleanfy:S,syntax:g,syntaxes:E,as:C,if:T,arity:I,itemSeparator:Y,optional:j=!1,autoSpacing:q=N,optionalParens:$,autoIndent:B=!1,autoIndentAdjust:G=0}=y,v=t.concat(`${Array.isArray(e)?d:""}${C?`<${C}>`:""}`||[]),A=v.join("."),K=B;if(T&&!sa(T,this.#e,this.NODE_NAME))continue;let L={startingIndentLevel:s+(B?1:0)+G,autoLineBreakThreshold:r,...n},w;if([void 0,null].includes(I))if(g)w=this._stringifyFromRules(g,{trail:v.concat("syntax"),...L},a);else if(E){let k=-1;for(let[M,F]of E.entries()){let O={score:0},J=this._stringifyFromRules(F,{trail:v.concat("syntaxes",M),...L},O);typeof J=="string"&&O.score>k&&(w=J,k=O.score)}a&&(a.score+=k)}else if(C){let k=this._get(C==="."?"value":C),M=_!=null;if(M&&S&&k===!0&&(k=_),M&&([].concat(_).includes(k)?a&&a.score++:k=void 0),k!==void 0){k instanceof o&&(k=k.stringify(L));let F=C==="."?{...y,...this.#e}:{...y,value:k};w=this._stringifyTerminal(F,L)}}else w=this._stringifyTerminal(y,L);else{let k=!1,M=this._get(C),F=M?.length||0;if(typeof B=="number"&&F<B&&(L.startingIndentLevel-=1),M&&((k=I===1/0)||(fe(I)?k=(!("min"in I)||F>=I.min)&&(!("max"in I)||F<=I.max):k=[].concat(I).includes(F))),k){let O=M.map(ue=>ue.stringify(L));K=B===!0||typeof B=="number"&&M.length>=B||q===`
`;let J=O.join(" "),R=L.prettyPrint&&K&&(J.length>r||J.includes(`
`))?c(L.startingIndentLevel):p(),D=Y?this._stringifyTerminal(Y,L):"";/^\w+$/.test(D)?D=`${R}${D}${R}`:D===";"&&L.prettyPrint?D=`${D}
${R}`:D=`${D}${R}`,w=O.join(D)}}if(x==="paren_block"&&$&&!w?.trim()){if($===!0||n.pruneOptionalParens){a&&a.score++,m++;continue}w=""}if(w===void 0){if(j){m++;continue}return}C&&a&&a.score++;let P=!1,W=w.length>r||w.includes(`
`);if(typeof x=="string"&&x.endsWith("_block")){let k=L.prettyPrint&&B&&W,M={brace_block:"{}",bracket_block:"[]",paren_block:"()"}[x];w=[M[0],k&&!/^\s/.test(w)?c(s+1):M[0]==="{"?p():"",w,k||/^\s/.test(w)?c(s):M[1]==="}"?p():"",M[1]].join("")}else L.prettyPrint&&K&&(u.length||W)&&w!==""&&(w=[c(s+(q===`
`?0:1)),w].join(""),P=!0);let H=u[u.length-1];w!==""&&!P&&u.length&&!/\s$/.test(H)&&(Array.isArray(q)?q.includes(H):q!==!1)&&(q===`
`&&L.prettyPrint?u.push(c(s)):u.push(p())),u.push(w)}if(u.length||m===f.length)return u.join("")}_stringifyTerminal(e,t={}){switch(e.type){case"data_type":return this._stringifyDataType(e,t);case"identifier":return this._stringifyIdentifier(e,t);case"keyword":return this._stringifyKeyword(e,t);case"operator":return this._stringifyOperator(e,t);case"punctuation":return this._stringifyPunctuation(e,t);case"bind_var":return this._stringifyBindVar(e,t);case"version_spec":return`@${e.value}`}if(!Array.isArray(e.type)){if(e.type.endsWith("_literal"))return this._stringifyLiteral(e,t);if(e.type.endsWith("_var"))return this._stringifyVariable(e,t);if(e.type.endsWith("_comment"))return this._stringifyComment(e,t)}return String(e.value)}_stringifyIdentifier(e){let{value:t}=e,s=['"'];this.options.dialect==="mysql"&&(this.options.mysqlAnsiQuotes?s.push("`"):s.fill("`"));let r=s.includes(e.delim)?e.delim:s[0];return e.delim||/^\d/.test(t)||!/^(\*|[\w]+)$/.test(t)?`${r}${String(t||"").replace(new RegExp(r,"g"),r.repeat(2))}${r}`:t}_stringifyKeyword(e){return String(e.value)}_stringifyOperator(e){return e.value===":"&&this.#t?.isProperty?"\\:":String(e.value)}_stringifyPunctuation(e){return String(e.value)}_stringifyDataType(e){return String(e.value)}_stringifyLiteral(e,t){let{value:s}=e;switch(e.type){case"bit_literal":return this._stringifyBitLiteral(e,t);case"hex_literal":return this._stringifyHexLiteral(e,t);case"number_literal":return this._stringifyNumberLiteral(e,t);case"string_literal":return this._stringifyStringLiteral(e,t);case"bool_literal":return/^true$/i.test(s+"")?"TRUE":"FALSE";case"null_literal":return"NULL"}return String(s)}_stringifyBindVar(e){let{value:t}=e;return this.options.dialect==="mysql"?"?":`$${t}`}_stringifyBitLiteral(e){let{value:t}=e;return this.options.dialect==="mysql"?`0b${t}`:`B'${t}'`}_stringifyHexLiteral(e){let{value:t}=e;return this.options.dialect==="mysql"?`0x${t}`:`X'${t}'`}_stringifyNumberLiteral(e){let{value:t}=e;return String(t)}_stringifyStringLiteral(e){let{value:t}=e,s=["'"],r=null;this.options.dialect==="postgres"&&e.delim?.startsWith("$")?s.fill(e.delim):this.options.dialect==="mysql"&&!this.options.mysqlAnsiQuotes&&s.push('"');let n=s.includes(e.delim)?e.delim:s[0];if((this.options.dialect==="mysql"&&!this.options.mysqlNoBackslashEscapes||this.options.dialect==="postgres"&&e.modifier==="E")&&(r="\\"),n.length>1)return`${n}${t}${n}`;if(!r)r=n;else if(r==="\\"){let a={"\\":"\\\\","\0":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","":"\\Z"};t=t.replace(/[\\\0\b\r\n\t\x1A]/g,p=>a[p])}return t=`${n}${(t||"").replace(new RegExp(n,"g"),`${r}${n}`)}${n}`,e.modifier?`${e.modifier}${t}`:t}_stringifyVariable(e){let{type:t,value:s}=e;return this.options.dialect==="mysql"?`${t==="system_var"?"@@":"@"}${s}`:`${this.#t?.isProperty?"\\:":":"}${s}`}_stringifyComment(e,t={}){let{value:s}=e;if(e.type==="block_comment"){let a="  ".repeat(t.startingIndentLevel||0),p=s.trim().split(`
`).map(u=>u.trim());return[`${a}/**`,...p.map(u=>`${a} * ${u}`),`${a} */`].join(`
`)}let r=["--"];return this.options.dialect==="mysql"&&r.push("#"),`${r.includes(e.delim)?e.delim:r[0]} ${s}`}},Aa=o=>Object.keys(o).filter(e=>!Ua.has(e)),Ua=new Set(["dialect","autoSpacing","optionalParens","autoIndent","autoIndentAdjust","type","value","delim","modifier","syntax","syntaxes","as","booleanfy","if","arity","itemSeparator","singletons","keyed","requiredSpacing","peek","optional","assert"]),sa=(o,e,t)=>[].concat(o).some(s=>{if(fe(s))return Object.entries(s).every(([n,a])=>{let p=!0;return n.startsWith("!")&&(n=n.slice(1),p=!1),(Array.isArray(a)?a.includes(e[n]):e[n]===a)===p});if(typeof s!="string")throw new SyntaxError(`[${t}] A specifier of type string or object expected in inferenceMatch but got ${s===null?"null":`type ${typeof s}`}`);let r=!0;return s.startsWith("!")&&(s=s.slice(1),r=!1),![void 0,null,!1].includes(e[s])===r});var ft=class extends h{static get syntaxRules(){return{dialect:"postgres",syntax:[{type:"keyword",value:"CYCLE"},{assert:!0,syntax:[{type:"ColumnRef1",as:"column_names",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2},{type:"keyword",value:"SET"},{type:"ColumnRef1",as:"mark_col_name"},{optional:!0,syntax:[{type:"keyword",value:"TO"},{type:"Expr",as:"mark_value"},{type:"keyword",value:"DEFAULT"},{type:"Expr",as:"mark_default"}]},{type:"keyword",value:"USING"},{type:"ColumnRef1",as:"path_col_name"}]}]}}breadthOrDepthFirst(){return this._get("breadth_or_depth_first")}columnNames(){return this._get("column_names")}markColName(){return this._get("mark_col_name")}markValue(){return this._get("mark_value")}markDefault(){return this._get("mark_default")}pathColName(){return this._get("path_col_name")}};var yt=class extends h{static get syntaxRules(){return{dialect:"postgres",syntax:[{type:"keyword",value:"SEARCH"},{assert:!0,syntax:[{type:"keyword",as:"breadth_or_depth_first",value:["BREADTH","DEPTH"]},{type:"keyword",value:"FIRST"},{type:"keyword",value:"BY"},{type:"ColumnRef1",as:"column_names",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2},{type:"keyword",value:"SET"},{type:"ColumnRef1",as:"seq_col_name"}]}]}}breadthOrDepthFirst(){return this._get("breadth_or_depth_first")}columnNames(){return this._get("column_names")}seqColName(){return this._get("seq_col_name")}};var Z=o=>class extends o{#e;resultSchema(){return this.#e}static fromJSON(e,t={},s=null){if(e instanceof h)return super.fromJSON(e,t,s);let{result_schema:r,...n}=e,a=super.fromJSON(n,t,s);if(a&&r){if(!(r instanceof h))throw new Error("Invalid Schema object passed at inputJson.result_schema");a.#e=r}return a}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);return this.#e&&(r={...r,result_schema:this.#e}),r}};var Ce=class extends h{get statementNode(){return this}#e;get uuid(){return this.#e||(this.#e=`$query${(0|Math.random()*9e6).toString(36)}`),this.#e}static fromJSON(e,t={},s=null){if(e instanceof h)return super.fromJSON(e,t,s);let{uuid:r,...n}=e,a=super.fromJSON(n,t,s);return a&&(a.#e=r),a}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);return this.#e&&(r={uuid:this.#e,...r}),r}};var me=class extends Z(Ce){renderBindings(e){if(!Array.isArray(e))throw new Error("Values must be an array");let t=[...this.queryBindings()];for(let s=0;s<e.length;s++){let r=t.filter(n=>n.offset()===s+1);if(!r.length)throw new Error(`No bindings exists at offset #${s}`);r.forEach(n=>n.value(e[s]))}}normalizeBindings(e=!1){let t=[...this.queryBindings()];if(!e)return t.forEach((n,a)=>n.offset(a+1)),t;let s=new Map,r=1;for(let n of t)if(n.offset()===0||!s.has(n.offset())){let a=r++;s.set(n.offset(),a),n.offset(a)}else n.offset(s.get(n.offset())).withDetail("redundant",!0);return t.filter(n=>!n.getDetail("redundant"))}};var ne=class o{#e;get cb(){return this.#e}#i=new Map;#t=new Map;#n;get parentTransformer(){return this.#n}#o;get statementNode(){return this.#o}get statementContext(){return this.#r?this:this.#n.statementContext}get rootContext(){return this.#n?.rootContext||this}#r;get isStatementContext(){return this.#r}#s=new Map([["outputSchemas",new Set],["tableSchemas",new Set],["selectorDimensions",new Map],["payloadDimensions",new Set]]);get artifacts(){return this.#s}constructor(e,t=null,s=null){this.#e=e,this.#n=t,this.#o=s,this.#r=!t||s!==t.statementNode}rand(e,{asSalt:t=!1,rands:s=this.#i}={}){return s.set(e,s.has(e)?s.get(e)+1:0),`${t?"~":"$"}${e}~${s.get(e)}`}hash(e,t,{hashes:s=this.#t}={}){return s.has(e)||s.set(e,this.rand(t)),s.get(e)}transform(e,t,s,r,n=this){let a=(p=r,c=n)=>(typeof p=="function"&&(c=new o(p,c,this.#o),p=r),n.statementNode!==this.#o?t(p,c):this.#e(e,(u=p)=>(typeof u=="function"&&(c=new o(u,c,this.#o),u=p),t(u,c)),s,p));return this.#n?this.#n.transform(e,a,s,r,n):a()}};var mt=class extends me{static get _bodyTypes(){return["SelectStmt","TableStmt","InsertStmt","UpsertStmt","UpdateStmt","DeleteStmt","ValuesConstructor"]}static get syntaxRules(){return[{type:"keyword",value:"WITH"},{type:"keyword",as:"recursive",value:"RECURSIVE",booleanfy:!0,optional:!0},{type:"CTEItem",as:"declarations",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2},{type:this._bodyTypes,as:"body",assert:!0,autoSpacing:`
`}]}recursive(){return this._get("recursive")}declarations(){return this._get("declarations")}body(){return this._get("body")}jsonfy(e={},t=null,s=null){if(!e.deSugar)return super.jsonfy(e,t,s);let r;return t=new ne((a,p,c)=>{if(c==="body"&&a.parentNode===this){let u=p();return r=u.result_schema,u}return p()},t,this),{...super.jsonfy(e,t,s),result_schema:r}}};var dt=class extends me{static get syntaxRules(){return[{type:"CTEItemAlias",as:"alias",assert:!0},{type:"keyword",value:"AS"},{optional:!0,dialect:"postgres",syntaxes:[[{type:"operator",as:"not_materialized_kw",value:"NOT",booleanfy:!0},{type:"keyword",value:"MATERIALIZED",assert:!0}],{type:"keyword",as:"materialized",value:"MATERIALIZED",booleanfy:!0}]},{type:"paren_block",syntax:{type:["SelectStmt","InsertStmt","UpsertStmt","UpdateStmt","DeleteStmt","TableStmt","ValuesConstructor"],as:"expr",autoIndent:!0}},{type:"PGSearchClause",as:"search_clause",optional:!0},{type:"PGCycleClause",as:"cycle_clause",optional:!0}]}alias(){return this._get("alias")}notMaterializedKW(){return this._get("not_materialized_kw")}materialized(){return this._get("materialized")}expr(){return this._get("expr")}searchClause(){return this._get("search_clause")}cycleClause(){return this._get("cycle_clause")}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);if(e.deSugar){let n={nodeName:l.Identifier.NODE_NAME,value:r.alias.value,delim:r.alias.delim},a=r.expr.result_schema;if(a instanceof l.TableSchema?a=a.clone({renameTo:n}):a=l.TableSchema.fromJSON({name:n,entries:a?.entries().map(p=>p.jsonfy())||[]}),r.alias.columns?.length){if(r.alias.columns.length!==a.length)throw new SyntaxError(`[${this}] Number of column aliases must match number of result columns.`);a=a.clone({},new ne((p,c,u)=>typeof u=="number"&&p.parentNode===a?p instanceof l.ColumnSchema?p.jsonfy({renameTo:r.alias.columns[u]}):{...p.jsonfy(),nodeName:l.ColumnSchema.NODE_NAME,name:r.alias.columns[u]}:c()))}t.statementContext.artifacts.get("tableSchemas").add({type:"CTEItem",resultSchema:a}),r={...r,result_schema:a}}return r}};var ie=class o extends h{static get syntaxRules(){return{type:"identifier",as:"."}}static get syntaxPriority(){return-1}value(){return this._get("value")}identifiesAs(e,t=void 0){return e instanceof o?oe(this.value(),e.value(),t===void 0?this._has("delim")||e._has("delim"):t):typeof e=="string"?oe(this._get("value"),e,t===void 0?this._has("delim"):t):super.identifiesAs(e,t)}};var _t=class extends ie{static get syntaxRules(){let e={type:"punctuation",value:","};return[{...[].concat(super.syntaxRules)[0]},{type:"paren_block",syntax:{type:"Identifier",as:"columns",arity:{min:1},itemSeparator:e,assert:!0},if:"value",optional:!0,optionalParens:!0}]}columns(){return this._get("columns")}};var na={};ve(na,{CheckConstraint:()=>Ct,ColumnDefaultConstraint:()=>bt,ColumnDiff:()=>ht,ColumnExpressionConstraint:()=>wt,ColumnFKConstraint:()=>kt,ColumnIdent:()=>Ir,ColumnIdentityConstraint:()=>Fe,ColumnNullConstraint:()=>It,ColumnPKConstraint:()=>Dt,ColumnSchema:()=>xt,ColumnUKConstraint:()=>Lt,ConstraintSchema:()=>X,CreateTableStmt:()=>qr,FKDeleteRule:()=>Nt,FKMatchRule:()=>gt,FKUpdateRule:()=>Et,IndexDiff:()=>Mr,IndexSchema:()=>Pr,MYColumnAutoIncrementModifier:()=>qe,MYColumnCommentModifier:()=>Mt,MYColumnOnUpdateModifier:()=>Pt,MYColumnVisibilityModifier:()=>jt,PGIndexParamInclude:()=>At,PGIndexParamUsing:()=>Tt,PGIndexParamWith:()=>Ot,PGIndexParameters:()=>St,PGTableEXConstraint:()=>Ut,PGTableEXConstraintItem:()=>Rt,ReferentialAction:()=>vt,SchemaDiff:()=>jr,SchemaIdent:()=>Dr,SchemaSchema:()=>Ur,TableDiff:()=>$r,TableFKConstraint:()=>$t,TableIdent:()=>Lr,TablePKConstraint:()=>Bt,TableSchema:()=>Br,TableUKConstraint:()=>Jt});var b=class extends h{static get syntaxRules(){return[]}get length(){return(this._get("entries")||[]).length}[Symbol.iterator](){return(this._get("entries")||[])[Symbol.iterator]()}entries(){return(this._get("entries")||[]).slice(0)}get(e){return this._get("entries",e)}set(e,t){return this._set("entries",e,t)}has(e){return this._has("entries",e)}add(...e){return this._add("entries",...e)}};var Ne=class extends b{};var ht=class extends Ne{};var he=class o extends b{name(){return this._get("name")}identifiesAs(e,...t){return this.name()?.identifiesAs(e instanceof o?e.name():e,...t)}static fromJSON(e,t={},s=null){if(e instanceof h)return super.fromJSON(e,t,s);let{ddl_name:r,...n}=e,a=super.fromJSON(n,t,s);if(r&&a){let p=[l.SchemaIdent,l.TableIdent,l.ColumnIdent].reduce((c,u)=>c||u.fromJSON(r),null);a._set("ddl_name",p)}return a}jsonfy({renameTo:e,...t}={},s=null,r=null){let n=super.jsonfy(t,s,r);if(e){if(e instanceof h)throw new Error("options.renameTo must be a JSON value.");return n.name?.value&&!n.ddl_name&&(n={...n,ddl_name:n.name}),{...n,name:e}}return n}};var xt=class extends he{static get syntaxRules(){return[{type:["ColumnIdent","Identifier"],as:"name"},{type:"DataType",as:"data_type",assert:!0},{type:["CheckConstraint","ColumnDefaultConstraint","ColumnExpressionConstraint","ColumnFKConstraint","ColumnIdentityConstraint","ColumnNullConstraint","ColumnPKConstraint","ColumnUKConstraint","MYColumnAutoIncrementModifier","MYColumnCommentModifier","MYColumnOnUpdateModifier","MYColumnVisibilityModifier"],as:"entries",arity:1/0,singletons:!0,optional:!0}]}dataType(){return this._get("data_type")}defaultConstraint(){for(let e of this)if(e instanceof l.ColumnDefaultConstraint)return e}expressionConstraint(){for(let e of this)if(e instanceof l.ColumnExpressionConstraint)return e}identityConstraint(){for(let e of this)if(e instanceof l.ColumnIdentityConstraint)return e}nullConstraint(){for(let e of this)if(e instanceof l.ColumnNullConstraint)return e}pkConstraint(e=!1){for(let t of this)if(t instanceof l.ColumnPKConstraint)return t;if(e&&this.parentNode instanceof l.TableSchema){let t=this.parentNode.pkConstraint(!1),s=t?.columns()||[];if(s.length===1&&s[0].identifiesAs(this.name())){let{nodeName:r,columns:n,...a}=t.jsonfy(),p=l.ColumnPKConstraint.fromJSON(a);return this._adoptNodes(p),p}}}fkConstraint(e=!1){for(let t of this)if(t instanceof l.ColumnFKConstraint)return t;if(e&&this.parentNode instanceof l.TableSchema){let{nodeName:t,columns:s,...r}=this.parentNode.fkConstraints(!1).find(n=>{let a=n.columns();return a.length===1&&a[0].identifiesAs(this.name())})?.jsonfy()||{};if(t){let n=l.ColumnFKConstraint.fromJSON(r);return this._adoptNodes(n),n}}}ukConstraint(e=!1){for(let t of this)if(t instanceof l.ColumnUKConstraint)return t;if(e&&this.parentNode instanceof l.TableSchema){let{nodeName:t,columns:s,...r}=this.parentNode.ukConstraints(!1).find(n=>{let a=n.columns();return a.length===1&&a[0].identifiesAs(this.name())})?.jsonfy()||{};if(t){let n=l.ColumnUKConstraint.fromJSON(r);return this._adoptNodes(n),n}}}ckConstraint(e=!1){for(let t of this)if(t instanceof l.CheckConstraint)return t;if(e&&this.parentNode instanceof l.TableSchema){let t=this.parentNode.ckConstraints(!1).find(s=>{let r=s.columns();return r.length===1&&r[0].identifiesAs(this.name())});if(t=t?.clone())return this._adoptNodes(t),t}}jsonfy({normalized:e=!1,...t}={},s=null,r=null){let n=super.jsonfy(t,s,r);if(e){let a=[];for(let p of["pk","fk","uk","ck"]){let c=`${p}Constraint`;this[c]()||a.push(this[c](!0)?.jsonfy())}if((a=a.filter(p=>p)).length)return{...n,entries:n.entries.concat(a)}}return n}};var gt=class extends h{static get syntaxRules(){return[{type:"keyword",value:"MATCH"},{type:"keyword",as:"value",value:["FULL","PARTIAL","SIMPLE"],assert:!0}]}value(){return this._get("value")}};var Nt=class extends h{static get syntaxRules(){return[{type:"keyword",value:"ON"},{type:"keyword",value:"DELETE"},{type:"ReferentialAction",as:"action",assert:!0}]}action(){return this._get("action")}};var Et=class extends h{static get syntaxRules(){return[{type:"keyword",value:"ON"},{type:"keyword",value:"UPDATE"},{type:"ReferentialAction",as:"action",assert:!0}]}action(){return this._get("action")}};var St=class extends b{static get syntaxRules(){return[{type:["PGIndexParamInclude","PGIndexParamUsing","PGIndexParamWith"],as:"entries",arity:1/0,singletons:!0}]}};var At=class extends b{static get syntaxRules(){return[{type:"keyword",value:"INCLUDE"},{type:"paren_block",syntax:{type:"ColumnRef2",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","}}}]}};var Tt=class extends h{static get syntaxRules(){return[{type:"keyword",value:"USING"},{type:"keyword",value:"INDEX"},{type:"keyword",value:"TABLESPACE"},{type:"identifier",as:"."}]}};var Ot=class extends b{static get syntaxRules(){return[{type:"keyword",value:"WITH"},{type:"paren_block",syntax:{type:"ConfigAssignmentExprAlt2",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","}}}]}};var X=class extends he{static buildSyntaxRules(e){return[{optional:!0,syntax:[{type:"keyword",value:"CONSTRAINT"},{type:"Identifier",as:"name",assert:!0}]},...e,{optional:!0,dialect:"postgres",syntaxes:[[{type:"operator",as:"pg_deferrable",value:"NOT"},{type:"keyword",value:"DEFERRABLE"}],{type:"keyword",as:"pg_deferrable",value:"DEFERRABLE"}]},{optional:!0,dialect:"postgres",syntax:[{type:"keyword",value:"INITIALLY"},{type:"keyword",as:"pg_deferred",value:["DEFERRED","IMMEDIATE"]}]}]}static get syntaxRules(){return{type:["TableFKConstraint","TablePKConstraint","TableUKConstraint","CheckConstraint","ColumnDefaultConstraint","ColumnExpressionConstraint","ColumnFKConstraint","ColumnIdentityConstraint","ColumnNullConstraint","ColumnPKConstraint","ColumnUKConstraint"]}}get isColumnLevel(){return this.parentNode instanceof l.ColumnSchema}pgDeferrable(){return this._get("pg_deferrable")}pgDeferred(){return this._get("pg_deferred")}};var Rt=class extends X{static get syntaxRules(){return[{syntaxes:[{type:"ColumnRef2",as:"expr"},{type:"ParenExpr",as:"expr"}]},{optional:!0,syntax:[{type:"operator",value:"COLLATE"},{type:"string_literal",as:"collation",assert:!0}]},{optional:!0,syntax:[{type:"Identifier",as:"opclass"},{optional:!0,type:"paren_block",syntax:{type:"ConfigAssignmentExpr",as:"opclass_parameters",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0}}]},{type:"keyword",value:["ASC","DESC"],as:"dir",optional:!0},{optional:!0,syntax:[{type:"keyword",value:"NULLS"},{type:"keyword",as:"nulls_spec",value:["FIRST","LAST"],assert:!0}]},{type:"keyword",value:"WITH"},{type:"operator",as:"operator"}]}expr(){return this._get("expr")}collation(){return this._get("collation")}opclass(){return this._get("opclass")}opclassParameters(){return this._get("opclass_parameters")}dir(){return this._get("dir")}nullsSpec(){return this._get("nulls_spec")}operator(){return this._get("operator")}};var vt=class extends h{static get syntaxRules(){return{syntaxes:[{type:"keyword",as:"value",value:["NO ACTION","RESTRICT","CASCADE"]},[{type:"keyword",as:"value",value:["SET NULL","SET DEFAULT"]},{optional:!0,dialect:"postgres",type:"paren_block",syntax:{type:"Identifier",as:"columns",arity:{min:1},itemSeparator:{type:"punctuation",value:","}}}]]}}value(){return this._get("value")}columns(){return this._get("columns")}};var Ct=class extends X{static get syntaxRules(){return this.buildSyntaxRules([{type:"keyword",value:"CHECK"},{type:"paren_block",syntax:{type:"Expr",as:"expr",assert:!0},assert:!0},{type:"keyword",as:"no_inherit_kw",value:"NO INHERIT",optional:!0}])}expr(){return this._get("expr")}noInheritKW(){return this._get("no_inherit_kw")}columns(){let e=[];return this.expr()?.walkTree(t=>{if(t instanceof l.ColumnRef1)e.push(l.ColumnRef2.fromJSON({value:t.value()}));else return t}),e}};var bt=class extends X{static get syntaxRules(){return this.buildSyntaxRules([{type:"keyword",value:"DEFAULT"},{type:"Expr",as:"expr",assert:!0,dialect:"postgres"},{type:["NumberLiteral","StringLiteral","NullLiteral","BoolLiteral","CallExpr","RowConstructor"],as:"expr",assert:!0,dialect:"mysql"}])}expr(){return this._get("expr")}};var wt=class extends X{static get syntaxRules(){return this.buildSyntaxRules([{dialect:"postgres",syntax:[{type:"keyword",value:"GENERATED"},{type:"keyword",value:"ALWAYS"},{type:"keyword",value:"AS"},{type:"paren_block",syntax:{type:"Expr",as:"expr",assert:!0}},{type:"keyword",as:"stored",value:"STORED",assert:!0}]},{dialect:"mysql",syntax:[{optional:!0,syntax:[{type:"keyword",as:"my_generated_kw",value:"GENERATED",booleanfy:!0},{type:"keyword",value:"ALWAYS"}]},{type:"keyword",value:"AS"},{type:"paren_block",syntax:{type:"Expr",as:"expr",assert:!0}},{type:"keyword",as:"stored",value:["STORED","VIRTUAL"],optional:!0}]}])}myGeneratedKW(){return this._get("my_generated_kw")}expr(){return this._get("expr")}stored(){return this._get("stored")}};var{ColumnSchema:$a,ColumnRef2:Ba}=l,kt=class extends X{static get syntaxRules(){let e={type:"punctuation",value:","};return this.buildSyntaxRules([{type:"keyword",value:"REFERENCES"},{type:"TableRef2",as:"target_table",assert:!0},{dialect:"postgres",optional:!0,type:"paren_block",syntax:{type:"Identifier",as:"target_columns",arity:1,itemSeparator:e,singletons:"BY_KEY",assert:!0}},{dialect:"mysql",type:"paren_block",syntax:{type:"Identifier",as:"target_columns",arity:1,itemSeparator:e,singletons:"BY_KEY",assert:!0}},{type:["FKMatchRule","FKDeleteRule","FKUpdateRule"],as:"referential_rules",arity:1/0,singletons:!0}])}targetTable(){return this._get("target_table")}targetColumns(){return this._get("target_columns")}referentialRules(){return this._get("referential_rules")}columns(){return this.parentNode instanceof $a?[Ba.fromJSON({value:this.parentNode.name().value()})]:[]}};var qe=class extends h{static get syntaxRules(){return{dialect:"mysql",syntax:{type:"keyword",as:".",value:"AUTO_INCREMENT"}}}jsonfy(e={},t=null,s=null){return(e.toDialect||this.options.dialect)==="postgres"?new Fe().jsonfy(e,t,s):super.jsonfy(e,t,s)}};var Fe=class extends X{static get syntaxRules(){return this.buildSyntaxRules([{type:"keyword",value:"GENERATED"},{syntaxes:[{type:"keyword",as:"always_kw",value:"ALWAYS",booleanfy:!0},{syntax:[{type:"keyword",as:"by_default_kw",value:"BY",booleanfy:!0},{type:"keyword",value:"DEFAULT",assert:!0}]}]},{optional:!0,syntax:[{type:"keyword",as:"as_identity_kw",value:"AS",booleanfy:!0},{type:"keyword",value:"IDENTITY",assert:!0}]}])}alwaysKW(){return this._get("always_kw")}byDefaultKW(){return this._get("by_default_kw")}asIdentityKW(){return this._get("as_identity_kw")}jsonfy(e={},t=null,s=null){return(e.toDialect||this.options.dialect)==="mysql"?new qe().jsonfy(e,t,s):super.jsonfy(e,t,s)}};var It=class extends X{static get syntaxRules(){return this.buildSyntaxRules([{syntaxes:[[{type:"operator",as:".",value:"NOT"},{type:"null_literal",value:"NULL"}],{type:"null_literal",as:".",value:"NULL"}]}])}value(){return this._get("value")}};var Dt=class extends X{static get syntaxRules(){return this.buildSyntaxRules([{type:"keyword",value:"PRIMARY"},{type:"keyword",value:"KEY",assert:!0},{type:"PGIndexParameters",as:"pg_index_parameters",optional:!0,dialect:"postgres"}])}primaryKW(){return this._get("primary_kw")}pgIndexParameters(){return this._get("pg_index_parameters")}columns(){return this.parentNode instanceof l.ColumnSchema?[l.ColumnRef2.fromJSON({value:this.parentNode.name().value()})]:[]}};var Lt=class extends X{static get syntaxRules(){return this.buildSyntaxRules([{type:"keyword",value:"UNIQUE"},{type:"keyword",as:"my_key_kw",value:["KEY","INDEX"],optional:!0,dialect:"mysql"},{optional:!0,dialect:"postgres",syntaxes:[[{type:"keyword",value:"NULLS"},{type:"operator",as:"pg_nulls_distinct",value:"NOT"},{type:"keyword",value:"DISTINCT",assert:!0}],[{type:"keyword",value:"NULLS"},{type:"keyword",as:"pg_nulls_distinct",value:"DISTINCT",assert:!0}]]},{type:"PGIndexParameters",as:"pg_index_parameters",optional:!0,dialect:"postgres"}])}myKeyKW(){return this._get("my_key_kw")}pgNullsDistinct(){return this._get("pg_nulls_distinct")}pgIndexParameters(){return this._get("pg_index_parameters")}columns(){let{ColumnSchema:e,ColumnRef2:t}=l;return this.parentNode instanceof e?[t.fromJSON({value:this.parentNode.name().value()})]:[]}};var Mt=class extends h{static get syntaxRules(){return{dialect:"mysql",syntax:[{type:"keyword",value:"COMMENT"},{type:"string_literal",as:"."}]}}};var Pt=class extends h{static get syntaxRules(){return{dialect:"mysql",syntax:[{type:"keyword",value:"ON"},{type:"keyword",value:"UPDATE"},{type:"keyword",as:"."}]}}};var jt=class extends h{static get syntaxRules(){return{dialect:"mysql",syntaxes:[{type:"keyword",as:".",value:"VISIBLE"},{type:"keyword",as:".",value:"INVISIBLE"}]}}};var Ut=class extends X{static get syntaxRules(){let e={type:"punctuation",value:","};return{dialect:"postgres",syntax:this.buildSyntaxRules([{type:"keyword",value:"EXCLUDE"},{optional:!0,syntax:[{type:"keyword",value:"USING"},{type:"keyword",as:"index_method",assert:!0}]},{type:"paren_block",syntax:{type:"PGTableEXConstraintItem",as:"entries",arity:{min:1},itemSeparator:e,assert:!0},assert:!0},{type:"PGIndexParameters",as:"pg_index_parameters",optional:!0},{optional:!0,syntax:[{type:"keyword",value:"WHERE"},{type:"paren_block",syntax:{type:"Expr",as:"where_predicate",assert:!0},assert:!0}]}])}}indexMethod(){return this._get("index_method")}entries(){return this._get("entries")}pgIndexParameters(){return this._get("pg_index_parameters")}wherePredicate(){return this._get("where_predicate")}};var $t=class extends X{static get syntaxRules(){let e={type:"punctuation",value:","};return this.buildSyntaxRules([{type:"keyword",value:"FOREIGN"},{type:"keyword",value:"KEY",assert:!0},{type:"paren_block",syntax:{type:"ColumnRef2",as:"columns",arity:{min:1},itemSeparator:e,assert:!0,singletons:"BY_KEY"}},{type:"keyword",value:"REFERENCES"},{type:"TableRef2",as:"target_table",assert:!0},{dialect:"postgres",optional:!0,type:"paren_block",syntax:{type:"Identifier",as:"target_columns",arity:{min:1},itemSeparator:e,singletons:"BY_KEY",assert:!0}},{dialect:"mysql",type:"paren_block",syntax:{type:"Identifier",as:"target_columns",arity:{min:1},itemSeparator:e,singletons:"BY_KEY",assert:!0}},{type:["FKMatchRule","FKDeleteRule","FKUpdateRule"],as:"referential_rules",arity:1/0,assert:!0,singletons:!0}])}columns(){return this._get("columns")}targetTable(){return this._get("target_table")}targetColumns(){return this._get("target_columns")}referentialRules(){return this._get("referential_rules")}};var Bt=class extends X{static get syntaxRules(){let e={type:"punctuation",value:","};return this.buildSyntaxRules([{type:"keyword",value:"PRIMARY"},{type:"keyword",value:"KEY",assert:!0},{type:"paren_block",syntax:{type:"ColumnRef2",as:"columns",arity:{min:1},itemSeparator:e,singletons:"BY_KEY",assert:!0},assert:!0},{type:"PGIndexParameters",as:"pg_index_parameters",optional:!0,dialect:"postgres"}])}columns(){return this._get("columns")}pgIndexParameters(){return this._get("pg_index_parameters")}};var Jt=class extends X{static get syntaxRules(){let e={type:"punctuation",value:","};return this.buildSyntaxRules([{type:"keyword",value:"UNIQUE"},{type:"keyword",as:"my_key_kw",value:["KEY","INDEX"],optional:!0,dialect:"mysql"},{optional:!0,dialect:"postgres",syntaxes:[[{type:"keyword",value:"NULLS"},{type:"operator",as:"pg_nulls_distinct",value:"NOT"},{type:"keyword",value:"DISTINCT",assert:!0}],[{type:"keyword",value:"NULLS"},{type:"keyword",as:"pg_nulls_distinct",value:"DISTINCT",assert:!0}]]},{type:"paren_block",syntax:{type:"ColumnRef2",as:"columns",arity:{min:1},itemSeparator:e,singletons:"BY_KEY",assert:!0},assert:!0},{type:"PGIndexParameters",as:"pg_index_parameters",optional:!0,dialect:"postgres"}])}myKeyKW(){return this._get("my_key_kw")}pgNullsDistinct(){return this._get("pg_nulls_distinct")}columns(){return this._get("columns")}pgIndexParameters(){return this._get("pg_index_parameters")}};var be=o=>class extends o{static get _qualifierType(){return"Identifier"}static buildSyntaxRules(e=null){return[{optional:!0,syntax:[{type:this._qualifierType,as:"qualifier"},{type:"punctuation",value:".",autoSpacing:!1}]},e||{...[].concat(super.syntaxRules)[0],autoSpacing:!1}]}static get syntaxRules(){return this.buildSyntaxRules()}static get syntaxPriority(){return-1}qualifier(){return this._get("qualifier")}identifiesAs(e,t=void 0){let s=super.identifiesAs(e,t);return s&&this.qualifier()&&e.qualifier?.()?this.qualifier().identifiesAs(e.qualifier(),t):s}static async _parseFromRules(e,t,{left:s=void 0,minPrecedence:r=0,trail:n,...a},p={}){if(s)return super._parseFromRules(e,t,{left:s,minPrecedence:r,trail:n,...a},p);let c=[];for(;;){if(await e.match(1,"punctuation","."))c.push(await e.eat());else if(await e.match(1,"version_spec")&&await e.match(2,"punctuation","."))c.push(await e.eat()),c.push(await e.eat());else break;(await e.match(2,"punctuation",".")||await e.match(2,"version_spec")&&await e.match(3,"punctuation","."))&&c.push(await e.eat())}let u="qualifier";if(c.length){let f=[].concat(this._qualifierType),m=await this.toStream(c,a),d={minPrecedence:r,trail:n.concat(this.NODE_NAME,`<${u}>`),...a};s=await this._parseFromTypes(m,f,d)}else s=!1;return await super._parseFromRules(e,t,{left:s,minPrecedence:r,trail:n,...a},p)}};var xe={};ve(xe,{AggrCallExpr:()=>Gt,AtTimeZoneExpr:()=>mr,BetweenExpr:()=>dr,BinaryExpr:()=>ee,BindVar:()=>br,BitLiteral:()=>Xt,BoolLiteral:()=>zt,CallExpr:()=>We,CaseBranch:()=>Yt,CaseExpr:()=>Wt,CastExpr:()=>Kt,ColumnRef0:()=>Nr,ColumnRef1:()=>Ve,ColumnRef2:()=>Ue,DefaultLiteral:()=>Zt,DistinctFromExpr:()=>_r,Expr:()=>ut,ExtractExpr:()=>Ht,HexLiteral:()=>er,Identifier:()=>ie,InExpr:()=>hr,LQArrayLiteral:()=>pr,LQBackBackRef:()=>De,LQBackRef:()=>Er,LQBackRefAbstraction:()=>lt,LQBackRefEndpoint:()=>Sr,LQDeepDeepRef1:()=>Oe,LQDeepDeepRef2:()=>Ar,LQDeepRef1:()=>Qe,LQDeepRef2:()=>Tr,LQObjectLiteral:()=>cr,LQObjectProperty:()=>fr,NullLiteral:()=>tr,NumberLiteral:()=>rr,PGCastExpr2:()=>xr,PGFilterClause:()=>qt,PGTypedArrayLiteral:()=>yr,PGWithinGroupClause:()=>Ft,ParenExpr:()=>we,PredicateExpr:()=>Vt,QuantitativeExpr:()=>Qt,RowConstructor:()=>je,ScalarSubquery:()=>ot,SchemaRef:()=>Or,StringLiteral:()=>sr,SystemVar:()=>wr,TableRef0:()=>Rr,TableRef1:()=>Le,TableRef2:()=>vr,TypedDateLiteral:()=>ar,TypedIntervalLiteral:()=>nr,TypedLiteral:()=>de,TypedRowConstructor:()=>it,TypedTimeLiteral:()=>or,TypedTimeZoneLiteral:()=>lr,TypedTimestampLiteral:()=>ir,UnaryExpr:()=>gr,UnknownLiteral:()=>ur,UserVar:()=>kr,WindowRef:()=>Cr});var Ee=o=>class extends o{dataType(){return l.DataType.fromJSON({value:"TEXT"})}};var re=class extends Ee(h){};var we=class o extends re{static get syntaxRules(){return{type:"paren_block",syntax:{type:"Expr",as:"expr"},autoIndent:!0}}static get syntaxPriority(){return-1}expr(){return this._get("expr")}exprUnwrapped(){let e=this._get("expr");return e instanceof o?e.exprUnwrapped():e}dataType(){return this.expr()?.dataType()}};var je=class o extends Z(Ee(b)){static get syntaxRules(){return{syntax:[{type:"paren_block",syntax:{type:["DerivedQuery","ValuesTableLiteral","Expr"],as:"entries",arity:1/0,itemSeparator:{type:"punctuation",value:","},autoIndent:10}}]}}static get syntaxPriority(){return 49}exprUnwrapped(){return this._get("entries")?.length===1&&this._get("entries")[0]instanceof o?this._get("entries")[0].exprUnwrapped():this}dataType(){return l.DataType.fromJSON({value:"SET"})}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);if(Number(e.deSugar||0)>5||e.forceDeSugar){let n=this.entries()||[],p=(r.entries||[]).map((c,u)=>{let f={nodeName:l.Identifier.NODE_NAME,value:u};return c.result_schema instanceof l.ColumnSchema?c.result_schema.clone({renameTo:f}):l.ColumnSchema.fromJSON({name:f,data_type:n[u].dataType().jsonfy()})});r={...r,result_schema:l.JSONSchema.fromJSON({entries:p},{assert:!0})}}return r}};var Ge=class extends Z(we){static get syntaxRules(){return{type:"paren_block",syntax:{type:["SelectStmt","TableStmt","CTE"],as:"expr",autoIndent:!0}}}static get syntaxPriority(){return-1}dataType(){return this.expr()?.dataType()}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);if(e.deSugar){let n=r.expr?.result_schema;r={...r,result_schema:n}}return r}};var ot=class extends Ge{static get syntaxRules(){return{type:"paren_block",syntax:{type:["SelectStmt","CTE"],as:"expr"},autoIndent:!0}}static get syntaxPriority(){return 48}dataType(){return this.resultSchema()?this.resultSchema().dataType():l.DataType.fromJSON({value:"TEXT"})}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);if(e.deSugar){let n=r.expr?.result_schema;if(n?.length!==1)throw new Error("Scalar subqueries must return a scalar value.");n=n.entries()[0],r={...r,result_schema:n}}return r}};var it=class extends je{static get syntaxRules(){return[{type:"keyword",value:"ROW"},...[].concat(super.syntaxRules)]}static get syntaxPriority(){return 52}};var qt=class extends h{static get syntaxRules(){return{dialect:"postgres",syntax:[{type:"keyword",value:"FILTER"},{type:"paren_block",syntax:{type:"WhereClause",as:"where_clause"},assert:!0,autoIndent:!0}]}}static get syntaxPriority(){return-1}whereClause(){return this._get("where_clause")}};var Ft=class extends h{static get syntaxRules(){return{dialect:"postgres",syntax:[{type:"keyword",value:"WITHIN"},{type:"keyword",value:"GROUP"},{type:"paren_block",syntax:{type:"OrderByClause",as:"order_by_clause"},assert:!0,autoIndent:!0}]}}static get syntaxPriority(){return-1}orderByClause(){return this._get("order_by_clause")}};var We=class extends Z(re){static get syntaxRules(){let e={type:"punctuation",value:","};return{syntaxes:[{peek:[0,"keyword",["NOW","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","IF","NULLIF","IFNULL","COALESCE","GREATEST","LEAST","CONCAT","CONCAT_WS","FORMAT","MD5","SHA1","TO_JSON","TO_JSONB","JSON_TYPEOF","JSONB_TYPEOF","JSON_BUILD_ARRAY","JSONB_BUILD_ARRAY","JSON_BUILD_OBJECT","JSONB_BUILD_OBJECT","JSON_POPULATE_RECORD","JSONB_POPULATE_RECORD","JSON_PATH_QUERY","JSON_PATH_EXISTS","JSON_ARRAY","JSON_OBJECT","JSON_EXTRACT","JSON_UNQUOTE","JSON_SET","JSON_INSERT","JSON_REPLACE","JSON_REMOVE","JSON_SEARCH","JSON_CONTAINS","JSON_CONTAINS_PATH","JSON_KEYS","JSON_ARRAY_APPEND","JSON_ARRAY_INSERT","JSON_DEPTH","JSON_LENGTH","JSON_MERGE_PRESERVE","JSON_MERGE_PATCH","JSON_PRETTY","JSON_STORAGE_FREE","ST_ASTEXT","ST_ASGEOJSON","ST_GEOMFROMTEXT","ST_WITHIN","ST_CONTAINS","ST_INTERSECTS","ST_DISTANCE","ST_BUFFER","MAKE_DATE","MAKE_TIME","MAKE_TIMESTAMP","ARRAY","CURDATE","CURTIME","SYSDATE","STR_TO_DATE","MAKEDATE","MAKETIME"]],syntaxes:[[{type:"keyword",as:"name",value:["CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:0,itemSeparator:e,assert:!0},optional:!0,optionalParens:!0,autoSpacing:!1}],[{type:"keyword",as:"name",value:["NOW"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:0,itemSeparator:e,assert:!0},optional:!0,autoSpacing:!1}],[{type:"keyword",as:"name",value:["IF","NULLIF","IFNULL"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:{min:2,max:3},itemSeparator:e,assert:!0},autoSpacing:!1}],[{type:"keyword",as:"name",value:["COALESCE","GREATEST","LEAST","CONCAT"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:{min:1},itemSeparator:e,assert:!0},autoSpacing:!1}],[{type:"keyword",as:"name",value:["CONCAT_WS","FORMAT"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:{min:2},itemSeparator:e,assert:!0},autoSpacing:!1}],[{type:"keyword",as:"name",value:["MD5","SHA1"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:1,itemSeparator:e,assert:!0},autoSpacing:!1}],[{type:"keyword",as:"name",value:["ST_ASTEXT","ST_ASGEOJSON","ST_GEOMFROMTEXT"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:1,itemSeparator:e,assert:!0},autoSpacing:!1}],[{type:"keyword",as:"name",value:["ST_WITHIN","ST_CONTAINS","ST_INTERSECTS","ST_DISTANCE","ST_BUFFER"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:2,itemSeparator:e,assert:!0},autoSpacing:!1}],{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:["TO_JSON","TO_JSONB","JSON_TYPEOF","JSONB_TYPEOF"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:1,itemSeparator:e,assert:!0},autoSpacing:!1}]},{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:["JSON_BUILD_ARRAY","JSONB_BUILD_ARRAY","JSON_BUILD_OBJECT","JSONB_BUILD_OBJECT"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:{min:0},itemSeparator:e,assert:!0},autoSpacing:!1}]},{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:["JSON_POPULATE_RECORD","JSONB_POPULATE_RECORD","JSON_PATH_QUERY","JSON_PATH_EXISTS"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:2,itemSeparator:e,assert:!0},autoSpacing:!1}]},{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:["ARRAY"]},{type:"paren_block",syntax:{type:"SelectStmt",as:"arguments",arity:1,itemSeparator:e,assert:!0},autoIndent:!0,autoSpacing:!0}]},{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:["MAKE_DATE","MAKE_TIME","MAKE_TIMESTAMP"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:1/0,itemSeparator:e,assert:!0},autoSpacing:!1}]},{dialect:"mysql",syntax:[{type:"keyword",as:"name",value:["JSON_ARRAY","JSON_OBJECT","JSON_EXTRACT","JSON_UNQUOTE","JSON_SET","JSON_INSERT","JSON_REPLACE","JSON_REMOVE","JSON_SEARCH","JSON_CONTAINS","JSON_CONTAINS_PATH","JSON_KEYS","JSON_ARRAY_APPEND","JSON_ARRAY_INSERT","JSON_DEPTH","JSON_LENGTH","JSON_MERGE_PRESERVE","JSON_MERGE_PATCH","JSON_PRETTY","JSON_STORAGE_FREE"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:{min:1},itemSeparator:e,assert:!0},autoSpacing:!1}]},{dialect:"mysql",syntax:[{type:"keyword",as:"name",value:["CURDATE","CURTIME","SYSDATE"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:0,itemSeparator:e,optional:!0,assert:!0},autoSpacing:!1}]},{dialect:"mysql",syntax:[{type:"keyword",as:"name",value:"STR_TO_DATE"},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:2,itemSeparator:e,assert:!0},autoSpacing:!1}]},{dialect:"mysql",syntax:[{type:"keyword",as:"name",value:["MAKEDATE","MAKETIME"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:2,itemSeparator:e,assert:!0},autoSpacing:!1}]}]},[{type:"keyword",as:"name"},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:1/0,itemSeparator:e},autoSpacing:!1}],[{type:"identifier",as:"name"},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:1/0,itemSeparator:e},autoSpacing:!1}]]}}static get syntaxPriority(){return 51}name(){return this._get("name")}arguments(){return this._get("arguments")}};var Gt=class extends We{static get syntaxRules(){let e={type:"punctuation",value:","},t={type:"keyword",as:"distinct",value:"DISTINCT",booleanfy:!0,optional:!0},s={optional:!0,syntax:[{type:"keyword",value:"SEPARATOR"},{type:"Expr",as:"separator",assert:!0}]},r={type:"OrderByClause",as:"order_by_clause",optional:!0},n={type:"PGFilterClause",as:"pg_filter_clause",optional:!0,dialect:"postgres"},a={type:"PGWithinGroupClause",as:"pg_within_group_clause",optional:!0,dialect:"postgres"},p={optional:!0,syntax:[{type:"keyword",as:"null_handling",value:["IGNORE","RESPECT"]},{type:"keyword",value:"NULLS",assert:!0}]},c={optional:!0,syntax:[{type:"keyword",value:"OVER"},{type:["WindowRef","WindowSpec"],as:"over_clause",assert:!0}]};return{peek:[0,"keyword",["COUNT","SUM","AVG","MIN","MAX","ARRAY_AGG","STRING_AGG","GROUP_CONCAT","REGR_SLOPE","COVAR_POP","COVAR_SAMP","CORR","PERCENTILE_CONT","PERCENTILE_DISC","MODE","RANK","DENSE_RANK","ROW_NUMBER","EVERY","BOOL_AND","BOOL_OR","BIT_AND","BIT_OR","BIT_XOR","JSON_AGG","JSON_ARRAYAGG","JSON_OBJECT_AGG","JSONB_OBJECT_AGG","JSON_OBJECTAGG","STDDEV_POP","STDDEV_SAMP","VAR_POP","VAR_SAMP","VARIANCE","STD","XMLAGG","LEAD","LAG","NTILE","FIRST_VALUE","LAST_VALUE"]],syntaxes:[[{type:"keyword",as:"name",value:"COUNT"},{type:"paren_block",syntax:[{dialect:"postgres",type:"ColumnRef0",as:"arguments",arity:1,assert:!1,itemSeparator:e},{dialect:"mysql",type:"ColumnRef0",as:"arguments",arity:1/0,assert:!1,itemSeparator:e,optional:!0}],autoSpacing:!1},{...n},{...c}],[{type:"keyword",as:"name",value:["COUNT","SUM","AVG","MIN","MAX"]},{type:"paren_block",syntax:[{...t},{type:"Expr",as:"arguments",arity:1,itemSeparator:e,assert:!0}],autoSpacing:!1},{...n},{...c}],{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:"ARRAY_AGG"},{type:"paren_block",syntax:[{...t},{type:"Expr",as:"arguments",arity:{min:1},itemSeparator:e,assert:!0},{...r}],autoSpacing:!1},{...n},{...c}]},{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:"STRING_AGG"},{type:"paren_block",syntax:[{...t},{type:"Expr",as:"arguments",arity:2,itemSeparator:e,assert:!0},{...r},{...s}],autoSpacing:!1},{...n},{...c}]},{dialect:"mysql",syntax:[{type:"keyword",as:"name",value:"GROUP_CONCAT"},{type:"paren_block",syntax:[{...t},{type:"Expr",as:"arguments",arity:{min:1},itemSeparator:e,assert:!0},{...r},{...s}],autoSpacing:!1},{...c}]},{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:"REGR_SLOPE"},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:2,itemSeparator:e,assert:!0},autoSpacing:!1},{...n},{...c}]},[{type:"keyword",as:"name",value:["COVAR_POP","COVAR_SAMP","CORR"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:2,itemSeparator:e,assert:!0},autoSpacing:!1},{...n},{...c}],{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:["PERCENTILE_CONT","PERCENTILE_DISC"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:1,itemSeparator:e,assert:!0},autoSpacing:!1},{...n},{...a,optional:!1}]},{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:"MODE"},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:0,itemSeparator:e,assert:!0},autoSpacing:!1},{...n},{...a,optional:!1}]},{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:["RANK","DENSE_RANK"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:0,itemSeparator:e,assert:!0},autoSpacing:!1},{...n},{...c,optional:!1}]},[{type:"keyword",as:"name",value:"ROW_NUMBER"},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:0,itemSeparator:e,assert:!0},autoSpacing:!1},{...c,optional:!1}],{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:["EVERY","BOOL_AND","BOOL_OR"]},{type:"paren_block",syntax:[{...t},{type:"Expr",as:"arguments",arity:1,itemSeparator:e,assert:!0}],autoSpacing:!1},{...n},{...c}]},{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:"JSON_AGG"},{type:"paren_block",syntax:[{...t},{type:"Expr",as:"arguments",arity:{min:1},itemSeparator:e,assert:!0}],autoSpacing:!1},{...n},{...c}]},{dialect:"mysql",syntax:[{type:"keyword",as:"name",value:"JSON_ARRAYAGG"},{type:"paren_block",syntax:[{...t},{type:"Expr",as:"arguments",arity:{min:1},itemSeparator:e,assert:!0}],autoSpacing:!1},{...c}]},{dialect:"mysql",syntax:[{type:"keyword",as:"name",value:"BIT_XOR"},{type:"paren_block",syntax:[{...t},{type:"Expr",as:"arguments",arity:1,itemSeparator:e,assert:!0}],autoSpacing:!1},{...c}]},[{type:"keyword",as:"name",value:["BIT_AND","BIT_OR"]},{type:"paren_block",syntax:[{...t},{type:"Expr",as:"arguments",arity:1,itemSeparator:e,assert:!0}],autoSpacing:!1},{...n},{...c}],{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:["JSON_OBJECT_AGG","JSONB_OBJECT_AGG"]},{type:"paren_block",syntax:[{...t},{type:"Expr",as:"arguments",arity:2,itemSeparator:e,assert:!0}],autoSpacing:!1},{...n},{...c}]},{dialect:"mysql",syntax:[{type:"keyword",as:"name",value:"JSON_OBJECTAGG"},{type:"paren_block",syntax:[{...t},{type:"Expr",as:"arguments",arity:2,itemSeparator:e,assert:!0}],autoSpacing:!1},{...c}]},[{type:"keyword",as:"name",value:["STDDEV_POP","STDDEV_SAMP","VAR_POP","VAR_SAMP","VARIANCE","STD"]},{type:"paren_block",syntax:[{...t},{type:"Expr",as:"arguments",arity:1,itemSeparator:e,assert:!0}],autoSpacing:!1},{...n},{...c}],{dialect:"postgres",syntax:[{type:"keyword",as:"name",value:"XMLAGG"},{type:"paren_block",syntax:[{type:"Expr",as:"arguments",arity:1,itemSeparator:e,assert:!0},{...r}],autoSpacing:!1},{...n},{...c}]},[{type:"keyword",as:"name",value:["LEAD","LAG"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:{max:3},itemSeparator:e,optional:!0,assert:!0},autoSpacing:!1},{...p},{...c}],[{type:"keyword",as:"name",value:["NTILE","FIRST_VALUE","LAST_VALUE"]},{type:"paren_block",syntax:{type:"Expr",as:"arguments",arity:1,itemSeparator:e,assert:!0},autoSpacing:!1},{...c,optional:!1}]]}}distinct(){return this._get("distinct")}orderByClause(){return this._get("order_by_clause")}separator(){return this._get("separator")}overClause(){return this._get("over_clause")}pgFilterClause(){return this._get("pg_filter_clause")}pgWithinGroupClause(){return this._get("pg_within_group_clause")}};var Wt=class extends Ee(b){static get syntaxRules(){return[{type:"keyword",value:"CASE"},{type:"Expr",as:"subject",optional:!0},{type:"CaseBranch",as:"entries",arity:{min:1},assert:!0,autoIndent:2},{optional:!0,syntax:[{type:"keyword",value:"ELSE"},{type:"Expr",as:"alternate",autoIndent:!0}],autoSpacing:`
`},{type:"keyword",value:"END",autoSpacing:`
`}]}subject(){return this._get("subject")}branches(){return this.entries()}alternate(){return this._get("alternate")}};var Yt=class extends h{static get syntaxRules(){return[{type:"keyword",value:"WHEN"},{type:"Expr",as:"condition"},{type:"keyword",value:"THEN"},{type:"Expr",as:"consequent"}]}static get syntaxPriority(){return-1}condition(){return this._get("condition")}consequent(){return this._get("consequent")}};var Kt=class extends re{static get syntaxRules(){return[{type:"keyword",value:"CAST"},{type:"paren_block",syntax:[{type:"Expr",as:"expr"},{type:"keyword",value:"AS"},{type:"DataType",as:"data_type",assert:!0}],assert:!0,autoSpacing:!1}]}expr(){return this._get("expr")}dataType(){return this._get("data_type")}};var ee=class extends re{static get syntaxRules(){return[{type:"Expr",as:"left",peek:[1,"operator",["NOT",void 0]]},{type:"operator",as:"negation",value:"NOT",booleanfy:!0,optional:!0},{type:"operator",as:"operator"},{type:"Expr",as:"right"}]}static get syntaxPriority(){return 0}left(){return this._get("left")}negation(){return this._get("negation")}operator(){return this._get("operator")}right(){return this._get("right")}dataType(){let e=this.operator();if(!e)return this.left()?.dataType();let t=this.options.dialect,r=new Map(ct.common.concat(ct[t])).get(e)?.resultType;if(r)return r===":right"?this.right()?.dataType():r===":left"?this.left()?.dataType():l.DataType.fromJSON({value:r.toUpperCase()})}};var Ht=class extends ee{static get syntaxRules(){return[{type:"keyword",value:"EXTRACT"},{type:"paren_block",syntax:[{type:"Expr",as:"left"},{type:"keyword",value:"FROM"},{type:"Expr",as:"right",assert:!0}],autoSpacing:!1}]}left(){return this._get("left")}right(){return this._get("right")}};var Vt=class extends re{static get syntaxRules(){return[{type:"keyword",as:"predicate",value:["EXISTS"]},{type:"ScalarSubquery",as:"expr"}]}predicate(){return this._get("predicate")}expr(){return this._get("expr")}dataType(){return l.DataType.fromJSON({value:"BOOLEAN"})}};var Qt=class extends h{static get syntaxRules(){return[{type:"keyword",as:"quantifier",value:["ALL","ANY","SOME"]},{type:["DerivedQuery","RowConstructor","TypedRowConstructor"],as:"expr"}]}quantifier(){return this._get("quantifier")}expr(){return this._get("expr")}};var ce=class extends re{static get syntaxPriority(){return 49}value(){return this._get("value")}};var Xt=class extends ce{static get syntaxRules(){return{type:"bit_literal",as:"."}}dataType(){return l.DataType.fromJSON({value:"BINARY"})}};var zt=class extends ce{static get syntaxRules(){return{type:"bool_literal",as:"."}}dataType(){return l.DataType.fromJSON({value:"BOOLEAN"})}};var Zt=class extends ce{static get syntaxRules(){return{type:"keyword",as:".",value:"DEFAULT"}}};var er=class extends ce{static get syntaxRules(){return{type:"hex_literal",as:"."}}dataType(){return l.DataType.fromJSON({value:"BINARY"})}};var tr=class extends ce{static get syntaxRules(){return{type:"null_literal",as:"."}}};var rr=class extends ce{static get syntaxRules(){return{type:"number_literal",as:"."}}dataType(){return l.DataType.fromJSON({value:"INT"})}};var sr=class extends ce{static get syntaxRules(){return{type:"string_literal",as:"."}}qualifier(){return this._get("qualifier")}dataType(){return l.DataType.fromJSON({value:"TEXT"})}};var de=class extends re{static get syntaxRules(){return[{type:"data_type",as:"data_type"},{type:"string_literal",as:"value"}]}static get syntaxPriority(){return 50}dataType(){return l.DataType.fromJSON({value:this._get("data_type")})}value(){return this._get("value")}};var ar=class extends de{static get syntaxRules(){return[{type:"data_type",as:"data_type",value:"DATE"},{type:"string_literal",as:"value"}]}};var nr=class extends de{static get syntaxRules(){return[{type:"data_type",as:"data_type",value:"INTERVAL"},{syntaxes:[{type:"string_literal",as:"value"},{type:"number_literal",as:"value",dialect:"mysql"}]},{optional:!0,syntax:[{type:"keyword",as:"unit",value:["YEAR","MONTH","DAY","HOUR","MINUTE","SECOND"]},{optional:!0,syntax:[{type:"keyword",value:"TO"},{type:"keyword",as:"to_unit",value:["YEAR","MONTH","DAY","HOUR","MINUTE","SECOND"],assert:!0}]}]}]}unit(){return this._get("unit")}toUnit(){return this._get("to_unit")}};var or=class extends de{static get syntaxRules(){return[{type:"data_type",as:"data_type",value:"TIME"},{type:"string_literal",as:"value"},{optional:!0,dialect:"postgres",syntax:[{type:"keyword",as:"pg_with_tz",value:["WITH","WITHOUT"]},{type:"keyword",value:"TIME ZONE",assert:!0}]}]}pgWithTZ(){return this._get("pg_with_tz")}};var ir=class extends de{static get syntaxRules(){return[{type:"data_type",as:"data_type",value:"TIMESTAMP",dialect:"postgres"},{type:"data_type",as:"data_type",value:["TIMESTAMP","DATETIME"],dialect:"mysql"},{type:"string_literal",as:"value"},{optional:!0,dialect:"postgres",syntax:[{type:"keyword",as:"pg_with_tz",value:["WITH","WITHOUT"]},{type:"keyword",value:"TIME ZONE",assert:!0}]}]}pgWithTZ(){return this._get("pg_with_tz")}};var lr=class extends de{static get syntaxRules(){return[{type:"keyword",value:"TIME ZONE"},{type:"Expr",as:"value"}]}};var ur=class extends ce{static get syntaxRules(){return{type:"unknown_literal",as:"."}}};var Ye=o=>class extends o{get isSugar(){return!0}};var Ke=class extends Ye(Ee(b)){dataType(){return l.DataType.fromJSON({value:"JSON"})}};var pr=class extends Ke{static get syntaxRules(){return{syntax:[{type:"bracket_block",syntax:{type:"Expr",as:"entries",arity:1/0,itemSeparator:{type:"punctuation",value:","},autoIndent:2}}]}}static morphsTo(){return l.CallExpr}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);if(e.deSugar){let n=[];r={nodeName:l.CallExpr.NODE_NAME,name:(e.toDialect||this.options.dialect)==="mysql"?"JSON_ARRAY":"JSON_BUILD_ARRAY",arguments:r.entries.map((a,p)=>{let c=a.result_schema,u={value:p,nodeName:l.Identifier.NODE_NAME};return c instanceof l.ColumnSchema?c=c.clone({renameTo:u}):c=l.ColumnSchema.fromJSON({name:u,data_type:this.entries()[p].dataType().jsonfy()}),n.push(c),a}),result_schema:l.JSONSchema.fromJSON({entries:n},{assert:!0})}}return r}};var cr=class extends Ke{static get syntaxRules(){return{syntax:[{type:"brace_block",syntax:{type:"LQObjectProperty",as:"entries",arity:1/0,itemSeparator:{type:"punctuation",value:","},autoIndent:3}}]}}static morphsTo(){return l.CallExpr}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);if(e.deSugar){let n=r.entries.reduce((p,c)=>{if(c.star_ref){for(let u of c.star_ref.result_schema){let f={key:{value:u.value(),delim:u._get("delim")},value:u.jsonfy()};p=p.reduce((m,d)=>oe(f.key.value,d.key.value,f.key.delim||d.key.delim)?m:m.concat(d),[]),p=p.concat(f)}return p}return p.concat(c)},[]),a=[];r={nodeName:l.CallExpr.NODE_NAME,name:(e.toDialect||this.options.dialect)==="mysql"?"JSON_OBJECT":"JSON_BUILD_OBJECT",arguments:n.reduce((p,c,u)=>{let f=c.value.result_schema,m={...c.key,nodeName:l.Identifier.NODE_NAME};return f instanceof l.ColumnSchema?f=f.clone({renameTo:m}):f=l.ColumnSchema.fromJSON({name:m,data_type:this.entries()[u].value()?.dataType().jsonfy()||{nodeName:l.DataType.NODE_NAME,value:"TEXT"}}),a.push(f),p.concat({...c.key,nodeName:l.StringLiteral.NODE_NAME},{...c.value})},[]),result_schema:l.JSONSchema.fromJSON({entries:a},{assert:!0})}}return r}};var fr=class o extends h{static get syntaxRules(){return{syntaxes:[{type:"ColumnRef0",as:"star_ref"},[{type:"SelectItemAlias",as:"key"},{optional:!0,syntax:[{type:"punctuation",value:":"},{type:"Expr",as:"value",assert:!0}],autoSpacing:!1}]]}}static get syntaxPriority(){return-1}get isProperty(){return!0}starRef(){return this._get("star_ref")}key(){return this._get("key")}value(){return this._get("value")}jsonfy(e={},t=null,s=null){if(e.deSugar&&!this.starRef()){let r=this.key(),n,a=t?t.transform(r,(f=e)=>r.jsonfy(f),"key",e):r.jsonfy(e);a.is_aggr&&({is_aggr:n,...a}=a);let p=this.value();p||(p=l.ColumnRef1.fromJSON({...a,nodeName:void 0}),this._adoptNodes(p));let c;n&&!(p instanceof l.LQDeepRef1)?c=(f=e,m=t)=>({nodeName:l.AggrCallExpr.NODE_NAME,name:(e.toDialect||this.options.dialect)==="mysql"?"JSON_ARRAYAGG":"JSON_AGG",arguments:[p.jsonfy(f,m,s)]}):c=(f=e,m=t)=>p.jsonfy(f,m,s);let u=t?t.transform(p,c,"value",{...e,asAggr:n}):c();return{nodeName:o.NODE_NAME,key:a,value:u}}return super.jsonfy(e,t,s)}};var yr=class extends b{static get syntaxRules(){return{dialect:"postgres",syntax:[{type:"keyword",value:"ARRAY"},{type:"bracket_block",syntax:{type:"Expr",as:"entries",arity:1/0,itemSeparator:{type:"punctuation",value:","},autoIndent:2},autoSpacing:!1}]}}static morphsTo(){return l.CallExpr}dataType(){return l.DataType.fromJSON({value:"JSON"})}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);return(e.toDialect||this.options.dialect)==="mysql"&&(r={nodeName:l.CallExpr.NODE_NAME,name:"JSON_ARRAY",arguments:r.entries}),r}};var mr=class extends ee{static get syntaxRules(){return[{type:"Expr",as:"left",peek:[1,"operator","AT"]},{type:"operator",as:"operator",value:"AT"},{syntaxes:[{type:"TypedTimeZoneLiteral",as:"right"},{type:"keyword",as:"right",value:"LOCAL"}]}]}static get syntaxPriority(){return 0}left(){return this._get("left")}right(){return this._get("right")}dataType(){return l.DataType.fromJSON({value:"TIME ZONE"})}};var dr=class extends ee{static get syntaxRules(){return[{type:"Expr",as:"left",peek:[1,"operator",["NOT","BETWEEN"]]},{type:"operator",as:"negation",value:"NOT",booleanfy:!0,optional:!0},{type:"operator",as:"operator",value:"BETWEEN"},{type:"Expr",as:"right",arity:{min:2,max:2,eager:!1},itemSeparator:{type:"operator",value:"AND"},assert:!0}]}};var _r=class extends ee{static get syntaxRules(){return[{type:"Expr",as:"left",peek:[1,"operator",["IS","IS NOT"]]},{type:"operator",as:"logic",value:["IS","IS NOT"]},{type:"operator",as:"operator",value:"DISTINCT FROM"},{type:"Expr",as:"right",assert:!0}]}logic(){return this._get("logic")}};var hr=class extends ee{static get syntaxRules(){return[{type:"Expr",as:"left",peek:[1,"operator",["NOT","IN"]]},{type:"operator",as:"negation",value:"NOT",booleanfy:!0,optional:!0},{type:"operator",as:"operator",value:"IN"},{type:["DerivedQuery","RowConstructor","TypedRowConstructor"],as:"right",assert:!0}]}};var xr=class extends ee{static get syntaxRules(){return{dialect:"postgres",syntax:[{type:"Expr",as:"left",peek:[1,"operator","::"]},{type:"operator",as:"operator",value:"::",autoSpacing:!1},{type:"DataType",as:"right",assert:!0,autoSpacing:!1}]}}expr(){return this.left()}dataType(){return this.right()}};var gr=class extends re{static get syntaxRules(){return[{type:"operator",as:"operator",value:["-","+","NOT"]},{type:"Expr",as:"operand",autoSpacing:["NOT"]}]}static get syntaxPriority(){return 1}operator(){return this._get("operator")}operand(){return this._get("operand")}dataType(){let e=this.operator();return e?l.DataType.fromJSON({value:e==="NOT"?"BOOLEAN":"NUMBER"}):super.dataType()}};var Te=class extends Error{};var He=class extends Error{};var Se=class extends Z(Ee(ie)){lookup(e,t){return[]}resolve(e,t){let s=this.lookup(null,e,t)||[],r=this.constructor.name.match(/schema/i)?"Schema":this.constructor.name.match(/table/i)?"Table":"Column";if(s.length>1)throw new He(`[${this.parentNode?.parentNode||this.parentNode||this}] ${r} ${this} is ambiguous. (Is it ${s.join(" or ")}?)`);if(!s.length)throw new Te(`[${this.parentNode?.parentNode||this.parentNode||this}] ${r} ${this} does not exist.`);return s[0]}};var Ve=class o extends be(Se){static get _qualifierType(){return["TableRef1","LQBackRefAbstraction"]}static get syntaxRules(){return this.buildSyntaxRules({type:"identifier",as:".",autoSpacing:!1})}static get syntaxPriority(){return 51}static morphsTo(){return l.ColumnRef2}dataType(){return this.resultSchema()?.dataType()||super.dataType()}canReferenceOutputColumns(){return this.climbTree((e,t)=>e instanceof l.SelectStmt?!1:e instanceof l.GroupByClause||e instanceof l.HavingClause||e instanceof l.OrderByClause?e:t())}lookup(e=null,t=null,s=null){if(!t&&!s)return[];let r=this._get("value"),n=(!r||r==="*")&&!e,a=[],p=(c,u=void 0)=>{if(!(c instanceof l.ColumnSchema)||r&&r!=="*"&&!c.identifiesAs(this))return!1;let f;if(e&&!(f=e(c,u)))return!1;if(f instanceof h||Array.isArray(f))return f;let m=c.clone({normalized:!0});c.parentNode._adoptNodes(m);let d=o.fromJSON({...c.name().jsonfy({nodeNames:!1}),result_schema:m,qualifier:u});return this.parentNode._adoptNodes(d),d};if(this.canReferenceOutputColumns()&&t){let c=t.statementContext;for(let u of c.artifacts.get("outputSchemas"))if(a=a.concat(p(u)||[]),!n&&a.length)break}if((n||!a.length)&&(a=a.concat(new l.TableRef1(this.qualifier()?.jsonfy()||{}).lookup((c,u=void 0)=>c._get("entries").reduce((f,m)=>{if(c instanceof l.JSONSchema)return f.concat(p(m)||[]);let d={...c.name().jsonfy({nodeNames:!1}),result_schema:c,qualifier:u};return f.concat(p(m,d)||[])},[]),t,s))),r==="*"){let c=l.ColumnRef0.fromJSON({value:this.value(),result_schema:l.JSONSchema.fromJSON({entries:a.map(u=>u.clone())},{assert:!0})});this.parentNode._adoptNodes(c),a=[c]}return a}jsonfy({toKind:e=1,...t}={},s=null,r=null){if(t.deSugar&&this.qualifier()?.identifiesAs((t.toDialect||this.options.dialect)==="mysql"?"VALUES":"EXCLUDED")&&(t={...t,deSugar:0}),t.deSugar&&(!this.qualifier()&&Number(t.deSugar)>1||!this.resultSchema())&&(s||r)){let a=this.resolve(s,r).jsonfy();return Number(t.deSugar)<2&&!this.qualifier()?{...a,qualifier:void 0}:a}let n=super.jsonfy(t,s,r);return e===2&&(n={...n,nodeName:l.ColumnRef2.NODE_NAME},delete n.qualifier),n}};var Nr=class extends Ve{static get _qualifierType(){return["TableRef1"]}static get syntaxRules(){return this.buildSyntaxRules({type:"operator",as:".",value:"*",autoSpacing:!1})}static get syntaxPriority(){return-1}dataType(){return l.DataType.fromJSON({value:"SET"})}};var ke=class extends Error{constructor(e){super(e),this.name="ErrorFKInvalid"}};var Ie=class extends Ye(ee){rhsTable(e,t){let r=(this.operand()?.resolve(e,t)).resultSchema()?.fkConstraint(!0);if(!r)throw new ke(`[${this.parentNode||this}] Column ${this.operand()} is not a foreign key.`);return r.targetTable()?.resolve(null,t)}rhsSchema(e,t){return this.rhsTable(e,t)?.resultSchema()}};var Ue=class o extends Se{static get syntaxPriority(){return-1}static morphsTo(){return l.ColumnRef1}dataType(){return this.resultSchema()?.dataType()||super.dataType()}lookup(e,t=null,s=null){if(!t&&!s)return[];let r=this._get("value"),n=!r&&!e,a=[],p=u=>{if(!(u instanceof l.ColumnSchema)||r&&!u.identifiesAs(this))return!1;let f;if(e&&!(f=e(u)))return!1;if(f instanceof h||Array.isArray(f))return f;let m=u.clone({normalized:!0});u.parentNode._adoptNodes(m);let d=o.fromJSON({...u.name().jsonfy({nodeNames:!1}),result_schema:m});return this.parentNode._adoptNodes(d),d},c;this.parentNode instanceof Ie?this===this.parentNode.operand()?c=[this.parentNode.parentNode.rhsSchema(t,s)]:c=[this.parentNode.rhsSchema(t,s)]:c=this.climbTree((u,f)=>{if(u instanceof l.InsertStmt||u instanceof l.UpdateStmt){let m=[...t.statementContext.artifacts.get("tableSchemas")].map(d=>d.resultSchema);return this.options.dialect!=="mysql"&&(m=m.slice(0,1)),m}return u instanceof l.TableSchema?[u]:f()});e:for(let u of c||[])for(let f of u)if(a=a.concat(p(f)||[]),!n&&a.length)break e;return a}jsonfy({toKind:e=2,...t}={},s=null,r=null){if(t.deSugar&&!this.resultSchema()&&(s||r))return this.resolve(s,r).jsonfy();let n=super.jsonfy(t,s,r);return e===1&&(n={...n,nodeName:l.ColumnRef1.NODE_NAME},delete n.qualifier),n}};var De=class o extends Ie{static get _leftType(){return["LQBackRefEndpoint","LQBackBackRef"]}static get syntaxRules(){return[{type:this._leftType,as:"left",peek:[1,"operator","<~"]},{type:"operator",value:"<~"},{type:"ColumnRef2",as:"right",peek:[1,"operator","<~"]}]}static get syntaxPriority(){return 1}static morphsTo(){return[l.LQDeepRef1,l.LQDeepRef2,l.LQDeepDeepRef1,l.LQDeepDeepRef2]}operand(){return this.right()}endpoint(){return this.left()instanceof o?this.left().endpoint():this.left()}jsonfy({reverseRef:e=!1,toKind:t=1,...s}={},r=null,n=null){return e?{nodeName:t===2?e===1/0?l.LQDeepDeepRef2.NODE_NAME:l.LQDeepRef2.NODE_NAME:e===1/0?l.LQDeepDeepRef1.NODE_NAME:l.LQDeepRef1.NODE_NAME,left:this.right().jsonfy({toKind:e!==1/0?1:2,...s}),right:this.left()instanceof l.LQBackRefEndpoint?{nodeName:l.ColumnRef2.NODE_NAME,value:this.left().value(),delim:this.left()._get("delim")}:this.left().jsonfy({reverseRef:1/0,toKind:t,...s})}:super.jsonfy(s,r,n)}};var Er=class extends De{static get syntaxRules(){return[{type:this._leftType,as:"left",peek:[1,"operator","<~"]},{type:"operator",value:"<~"},{type:"TableRef2",as:"right"}]}static get syntaxPriority(){return 0}rhsTable(e,t){if(!t)return;let s=this.right()?.lookup(null,null,t)||[];if(!s.length)throw new Te(`[${this.parentNode||this}] Implied RHS table ${this.right()} does not exist.`);return s[0]}resolve(e,t,s=1){if(!e||!t)return;let r=this.left(),n=r instanceof De?r.endpoint():r,a=n.qualifier(),p=l.ColumnRef2.fromJSON({...n.jsonfy({nodeNames:!1}),qualifier:void 0}),u=n.resolve(e,t).resultSchema().fkConstraint(!0);if(!u)throw new ke(`[${this.parentNode||this}] Endpoint column ${p} is not a foreign key.`);let f=u.targetTable(),m,d=(_,S)=>{let g=S.pkConstraint(!0)?.columns()[0]?.resolve(e,t);if(!g)throw new ke(`[${this.parentNode||this}] The referenced LHS table ${_} does not have a primary key.`);let E=l.ColumnRef1.fromJSON({qualifier:{...S.name().jsonfy({nodeNames:!1}),result_schema:S},value:g.value(),delim:g._get("delim"),result_schema:g.resultSchema()});if(m)throw new He(`[${this.parentNode||this}]: The referenced endpoint for foreign key ${p} is ambiguous. (Is it ${m} or ${E}?)`);m=E},y=e.statementContext;e:do for(let{type:_,resultSchema:S}of y.artifacts.get("tableSchemas")){if(_==="CTEItem")continue;let g=S._get("ddl_name")||S.name();if(a){if(!S.identifiesAs(a))continue;if(!f.identifiesAs(g))throw new ke(`[${this.parentNode||this}] The endpoint table implied by ${a} (${g}) is not the actual target (${f}) of the foreign key column ${p}.`);d(g,S);break e}else f.identifiesAs(g)&&d(g,S)}while(!m&&(y=y.parentTransformer?.statementContext));if(!m)throw new Te(`[${this.parentNode||this}] Ref does not correlate with current query.`);let N=this.rhsTable(e,t),x=r instanceof De?r.clone({reverseRef:!0,toKind:s}):p.constructor.fromJSON({...p.jsonfy(),result_schema:N.resultSchema()._get("entries",p)});return{lhsOperand:m,rhsOperand:x.clone({toKind:s}),rhsTable:N}}};var lt=class extends we{static get syntaxRules(){return{type:"paren_block",syntaxes:[{type:"Expr",as:"expr",peek:[1,"operator","<~"]},{type:"Expr",as:"expr",peek:[2,"operator","<~"]}]}}static get syntaxPriority(){return 51}expr(){return this._get("expr")}};var Sr=class extends Ue{static get syntaxRules(){return[{optional:!0,type:"paren_block",syntax:{type:"Identifier",as:"qualifier"}},{...[].concat(super.syntaxRules)[0],peek:[1,"operator","<~"]}]}static get syntaxPriority(){return 52}static morphsTo(){return Ue}qualifier(){return this._get("qualifier")}};var Oe=class o extends Ie{static get _rightType(){return["LQDeepDeepRef1","LQObjectLiteral","LQArrayLiteral","RowConstructor","ColumnRef2"]}static get syntaxRules(){return[{type:["ColumnRef2","LQBackRefAbstraction"],as:"left",peek:[1,"operator","~>"]},{type:"operator",value:"~>"},{type:this._rightType,as:"right"}]}static get syntaxPriority(){return-1}static morphsTo(){return[l.LQDeepRef1,l.LQDeepRef2,l.LQDeepDeepRef1,l.LQDeepDeepRef2]}operand(){return this.left()}endpoint(){return this.right()instanceof o?this.right().endpoint():this.right()}jsonfy({toDeepRef:e=!1,toKind:t=1,...s}={},r=null,n=null){if(e||t===1||t===2){let a=[l.LQDeepRef1.NODE_NAME,l.LQDeepRef2.NODE_NAME,l.LQDeepDeepRef1.NODE_NAME,l.LQDeepDeepRef2.NODE_NAME],p=a.indexOf(this.NODE_NAME);return e&&p>1&&(p-=2),{nodeName:a[(p+1)%2===t%2?p:t%2?p-1:p+1],left:this.left().jsonfy({toKind:p>1?2:1}),right:this.right().jsonfy({toKind:this.right()instanceof o?t:void 0})}}return super.jsonfy(s,r,n)}};var Ar=class extends Oe{static get _rightType(){return["LQDeepDeepRef2","ColumnRef2","ColumnsConstructor"]}jsonfy({toDeepRef:e=!1,toKind:t=2,...s}={},r=null,n=null){return super.jsonfy({toDeepRef:e,toKind:t,...s},r=null,n)}};var Qe=class o extends Oe{static get syntaxRules(){return[{syntaxes:[[{type:["ColumnRef1","LQBackRefAbstraction"],as:"left",peek:[1,"operator","~>"]},{type:"operator",value:"~>"}],[{type:"ColumnRef1",as:"left",peek:[3,"operator","~>"]},{type:"operator",value:"~>"}]]},{type:this._rightType,as:"right"}]}static get syntaxPriority(){return 1}rhsTable(e,t){return this.left()?.qualifier?.()instanceof l.LQBackRefAbstraction?this._normalize().rhsTable(e,t):this.left()instanceof l.LQBackRefAbstraction?this.left().expr().rhsTable(e,t):super.rhsTable(e,t)}_normalize(){let e=this.left(),t=this.right(),s=e.qualifier().jsonfy(),r={...e.jsonfy(),qualifier:void 0,nodeName:l.ColumnRef2.NODE_NAME},n=o.fromJSON({left:s,right:{nodeName:Oe.NODE_NAME,left:r,right:t.jsonfy()}});return this._adoptNodes(n),n}resolve(e,t,s=1){if(!e||!t)return;if(this.left()?.qualifier?.()instanceof l.LQBackRefAbstraction)return this._normalize().resolve(e,t,s);let r;if(this.right()instanceof l.ColumnRef2?r=this.right().clone({toKind:s}):this.right()instanceof l.LQDeepDeepRef1?r=this.right().clone({toDeepRef:!0,toKind:s}):r=this.right(),this.left()instanceof l.LQBackRefAbstraction)return{...this.left().expr().resolve(e,t,s),detail:r};let n=this.left().resolve(e,t),a=this.rhsTable(e,t),p=a.resultSchema().pkConstraint(!0)?.columns()[0]?.resolve(e,t);if(!p)throw new Error(`[${this.parentNode||this}] The referenced RHS table ${a} does not have a primary key.`);return{lhsOperand:n,rhsOperand:p.clone({toKind:s}),rhsTable:a,detail:r}}};var Tr=class extends Qe{static get _rightType(){return["LQDeepDeepRef2","ColumnRef2","ColumnsConstructor"]}static get syntaxPriority(){return-1}resolve(e,t,s=2){return super.resolve(e,t,s)}jsonfy({toDeepRef:e=!1,toKind:t=2,...s}={},r=null,n=null){return super.jsonfy({toDeepRef:e,toKind:t,...s},r,n)}};var Or=class extends Se{static get syntaxRules(){return[{type:"identifier",as:"."},{type:"LQVersionSpec",as:"version_spec",optional:!0,autoSpacing:!1}]}static get syntaxPriority(){return-1}versionSpec(){return this._get("version_spec")}lookup(e=null,t=null,s=null){if(!s)return[];let r=this._get("value"),n=!r&&!e,a=[],p=c=>{if(!(c instanceof l.SchemaSchema)||r&&!c.identifiesAs(this))return!1;let u;if(e&&!(u=e(c)))return!1;if(u instanceof h||Array.isArray(u))return u;let f=ColumnRef2.fromJSON({...c.name().jsonfy({nodeNames:!1}),ddl_schema:c});return this.parentNode._adoptNodes(f),f};for(let c of s.catalog)if(a=a.concat(p(c)||[]),!n&&a.length)break;return a}jsonfy(e={},t=null,s=null){let r;return e.deSugar&&!this.resultSchema()&&s?r=this.resolve(t,s).jsonfy():r=super.jsonfy(e,t,s),e.deSugar&&r.version_spec&&(r={...r,version_spec:void 0}),r}};var Le=class extends be(Se){static get _qualifierType(){return"SchemaRef"}static get syntaxRules(){return this.buildSyntaxRules({syntax:[{type:"identifier",as:"."},{type:"LQVersionSpec",as:"version_spec",optional:!0,autoSpacing:!1}],autoSpacing:!1})}versionSpec(){return this._get("version_spec")}dataType(){return l.DataType.fromJSON({value:"SET"})}canReferenceInlineTables(){return!0}lookup(e=null,t=null,s=null){if(!t&&!s)return[];let r=this._get("value"),n=(!r||r==="*")&&!e,a=[],p=(c,u=void 0)=>{if(c instanceof l.JSONSchema&&(!r||r==="*")&&e)return e(c,u);if(!(c instanceof l.TableSchema)||r&&r!=="*"&&!c.identifiesAs(this))return!1;let f;if(e&&!(f=e(c,u)))return!1;if(f instanceof h||Array.isArray(f))return f;let m=this.constructor.fromJSON({...c.name().jsonfy({nodeNames:!1}),result_schema:c,qualifier:u});return this.parentNode?._adoptNodes(m),m};if(this.canReferenceInlineTables()&&t){let c=t.statementContext,u;do for(let{type:f,resultSchema:m}of c.artifacts.get("tableSchemas"))if(!(u&&u!=="dml"&&f==="dml")&&(u||(u=f),!(f==="CTEItem"&&e)&&(a=a.concat(p(m)||[]),!n&&a.length)))break;while((n||!a.length)&&(c=c.parentTransformer?.statementContext))}if(!e&&(n||!a.length)&&(a=a.concat(new l.SchemaRef(this.qualifier()?.jsonfy()||{}).lookup(c=>c._get("entries").reduce((u,f)=>{let m={...c.name().jsonfy({nodeNames:!1}),result_schema:c};return u.concat(p(f,m)||[])},[]),t,s))),r==="*"){let c=l.TableRef0.fromJSON({value:this.value(),result_schema:l.JSONSchema.fromJSON({entries:a.map(u=>u.clone())},{assert:!0})});this.parentNode._adoptNodes(c),a=[c]}return a}jsonfy(e={},t=null,s=null){let r;return e.deSugar&&(!this.qualifier()&&Number(e.deSugar)>1||!this.resultSchema())&&(t||s)?(r=this.resolve(t,s).jsonfy(),Number(e.deSugar)<2&&!this.qualifier()&&(r={...r,qualifier:void 0})):r=super.jsonfy(e,t,s),e.deSugar&&r.version_spec&&(r={...r,version_spec:void 0}),r}};var Rr=class extends Le{static get _qualifierType(){return["SchemaRef"]}static get syntaxRules(){return this.buildSyntaxRules({type:"operator",as:".",value:"*",autoSpacing:!1})}static get syntaxPriority(){return-1}dataType(){return l.DataType.fromJSON({value:"SET"})}};var vr=class extends Le{canReferenceInlineTables(){return!1}};var Cr=class extends ie{static get syntaxPriority(){return-1}};var br=class extends re{static get syntaxRules(){return{type:"bind_var",as:"."}}value(){return this._get("value")}};var wr=class extends re{static get syntaxRules(){return{type:"system_var",as:"."}}value(){return this._get("value")}};var kr=class extends re{static get syntaxRules(){return{type:"user_var",as:"."}}value(){return this._get("value")}};var ut=class extends re{static get syntaxRules(){return{type:qa,expression:!0}}static[Symbol.hasInstance](e){return e instanceof re||e.constructor.name in xe}},Ja=Object.keys(xe),qa=Ja.filter(o=>xe[o]!==ut&&xe[o].syntaxPriority!==-1).sort((o,e)=>{let t=(xe[e].syntaxPriority??100)-(xe[o].syntaxPriority??100);return t===0?xe[e].prototype.isPrototypeOf(xe[o].prototype)?-1:1:t});var Ir=class extends be(ie){static get _qualifierType(){return"TableRef2"}};var Dr=class extends ie{};var Lr=class extends be(ie){static get _qualifierType(){return"SchemaRef"}};var Mr=class extends Ne{};var Pr=class extends he{static get syntaxRules(){return[{type:"Identifier",as:"name",assert:!0}]}};var jr=class extends Ne{};var Ur=class extends he{static get syntaxRules(){return[{type:"SchemaIdent",as:"name",assert:!0},{type:"paren_block",syntax:{type:"TableSchema",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},singletons:"BY_KEY",autoIndent:!0}}]}tables(){let e=[];for(let t of this)t instanceof l.TableSchema&&e.push(t);return e}};var $r=class extends Ne{};var Br=class extends he{static get syntaxRules(){let e={type:"punctuation",value:","},t=["TablePKConstraint","TableFKConstraint","TableUKConstraint","PGTableEXConstraint","CheckConstraint","ColumnSchema","IndexSchema"];return[{type:["TableIdent","Identifier"],as:"name"},{type:"paren_block",syntaxes:[{type:t,as:"entries",arity:1/0,itemSeparator:e,singletons:"BY_KEY",optional:!0,dialect:"postgres",autoIndent:!0},{type:t,as:"entries",arity:{min:1},itemSeparator:e,singletons:"BY_KEY",dialect:"mysql",autoIndent:!0}]}]}columns(){let e=[];for(let t of this)t instanceof l.ColumnSchema&&e.push(t);return e}pkConstraint(e=!1){for(let t of this){if(t instanceof l.TablePKConstraint)return t;let s;if(e&&t instanceof l.ColumnSchema&&(s=t.pkConstraint())){let r=l.TablePKConstraint.fromJSON({...s.jsonfy(),nodeName:void 0,columns:[l.ColumnRef2.fromJSON({value:t.name().value()})]});return this._adoptNodes(r),r}}}fkConstraints(e=!1){let t=[];for(let s of this){s instanceof l.TableFKConstraint&&t.push(s);let r;if(e&&s instanceof l.ColumnSchema&&(r=s.fkConstraint())){let n=l.TableFKConstraint.fromJSON({...r.jsonfy(),nodeName:void 0,columns:[l.ColumnRef2.fromJSON({value:s.name().value()})]});this._adoptNodes(n),t.push(n)}}return t}ukConstraints(e=!1){let t=[];for(let s of this){s instanceof l.TableUKConstraint&&t.push(s);let r;if(e&&s instanceof l.ColumnSchema&&(r=s.ukConstraint())){let n=l.TableUKConstraint.fromJSON({...r.jsonfy(),nodeName:void 0,columns:[l.ColumnRef2.fromJSON({value:s.name().value()})]});this._adoptNodes(n),t.push(n)}}return t}ckConstraints(e=!1){let t=[];for(let s of this){s instanceof l.CheckConstraint&&t.push(s);let r;e&&s instanceof l.ColumnSchema&&(r=s.ckConstraint()?.clone())&&(this._adoptNodes(r),t.push(r))}return t}jsonfy({normalized:e=!1,...t}={},s=null,r=null){let n=[],a={[l.ColumnPKConstraint.NODE_NAME]:l.TablePKConstraint.NODE_NAME,[l.ColumnFKConstraint.NODE_NAME]:l.TableFKConstraint.NODE_NAME,[l.ColumnUKConstraint.NODE_NAME]:l.TableUKConstraint.NODE_NAME,[l.CheckConstraint.NODE_NAME]:l.CheckConstraint.NODE_NAME};e&&(s=new ne((c,u)=>{if(c?.NODE_NAME in a&&c.parentNode instanceof l.ColumnSchema){n.push({...c.jsonfy(),nodeName:a[c.NODE_NAME],...c instanceof l.CheckConstraint?{}:{columns:[l.ColumnRef2.fromJSON({value:c.parentNode.name().value()})]}});return}return u()},s));let p=super.jsonfy(t,s,r);return e&&(p={...p,entries:p.entries.concat(n)}),p}};var Jr=class extends Ce{};var qr=class extends Jr{static get syntaxRules(){return[{type:"keyword",value:"CREATE"},{optional:!0,syntaxes:[{type:"keyword",as:"temporary_kw",value:"TEMPORARY",booleanfy:!0},{type:"keyword",as:"temporary_kw",value:"TEMP",booleanfy:!0,dialect:"postgres"}]},{type:"keyword",value:"TABLE"},{optional:!0,syntax:[{type:"keyword",as:"if_not_exists",value:"IF",booleanfy:!0},{type:"operator",value:"NOT"},{type:"keyword",value:"EXISTS"}]},{type:"TableSchema",as:"argument"},{type:["ConfigAssignmentExprAlt1","ConfigAssignmentExprAlt2"],as:"my_create_options",arity:1/0,dialect:"mysql"}]}temporaryKW(){return this._get("temporary_kw")}ifNotExists(){return this._get("if_not_exists")}argument(){return this._get("argument")}myCreateOptions(){return this._get("my_create_options")}};var oa={};ve(oa,{AssignmentExpr:()=>es,ColumnsConstructor:()=>Zr,ConfigAssignmentExpr:()=>ts,ConfigAssignmentExprAlt1:()=>rs,ConfigAssignmentExprAlt2:()=>ss,DeleteStmt:()=>is,InsertStmt:()=>Me,MYOnDuplicateKeyUpdateClause:()=>Fr,MYPartitionClause:()=>Gr,MYSetStmt:()=>us,MYVarAssignmentExpr:()=>as,PGConflictTarget:()=>Wr,PGConflictTargetIndexSpec:()=>Yr,PGDefaultValuesClause:()=>Kr,PGOnConflictClause:()=>Hr,PGWhereCurrentClause:()=>Qr,ReturningClause:()=>Vr,SetClause:()=>Xr,TableAbstraction1:()=>os,TableAbstraction2:()=>ns,UpdateStmt:()=>ps,UpsertStmt:()=>cs,UsingFromClause:()=>zr,ValuesConstructor:()=>ze});var Fr=class extends b{static get syntaxRules(){return{dialect:"mysql",syntax:[{type:"keyword",value:"ON"},{type:"keyword",value:"DUPLICATE"},{type:"keyword",value:"KEY"},{type:"keyword",value:"UPDATE"},{type:"AssignmentExpr",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2}]}}};var Gr=class extends b{static get syntaxRules(){return{dialect:"mysql",syntax:[{type:"keyword",value:"PARTITION"},{type:"Identifier",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0}]}}};var Wr=class extends h{static get syntaxRules(){return{syntaxes:[[{type:"keyword",value:"ON"},{type:"keyword",value:"CONSTRAINT"},{type:"Identifier",as:"constraint_name",assert:!0}],[{type:"paren_block",syntax:{type:"PGConflictTargetIndexSpec",as:"index_list",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0},autoIndent:!0},{type:"WhereClause",as:"where_clause",optional:!0,autoIndent:!0}]]}}constraintName(){return this._get("constraint_name")}indexList(){return this._get("index_list")}whereClause(){return this._get("where_clause")}};var Yr=class extends h{static get syntaxRules(){return[{syntaxes:[{type:"ColumnRef2",as:"column_name"},{type:"paren_block",syntax:{type:"Expr",as:"expr",assert:!0},autoIndent:!0},{type:"CallExpr",as:"expr"}]},{optional:!0,syntax:[{type:"operator",value:"COLLATE"},{type:"string_literal",as:"collation",assert:!0}]},{type:"Identifier",as:"opclass",optional:!0}]}columnName(){return this._get("column_name")}expr(){return this._get("expr")}collation(){return this._get("collation")}opclass(){return this._get("opclass")}};var Kr=class extends h{static get syntaxRules(){return{dialect:"postgres",syntax:[{type:"keyword",as:".",value:"DEFAULT"},{type:"keyword",value:"VALUES"}]}}};var Hr=class extends b{static get syntaxRules(){return{dialect:"postgres",syntax:[{type:"keyword",value:"ON"},{type:"keyword",value:"CONFLICT"},{syntaxes:[[{type:"PGConflictTarget",as:"conflict_target",optional:!0},{type:"keyword",as:"do_nothing",value:"DO"},{type:"keyword",value:"NOTHING"}],[{type:"PGConflictTarget",as:"conflict_target"},{type:"keyword",value:"DO"},{type:"keyword",value:"UPDATE"},{type:"keyword",value:"SET"},{type:"AssignmentExpr",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2},{type:"WhereClause",as:"where_clause",optional:!0,autoIndent:!0}]]}]}}conflictTarget(){return this._get("conflict_target")}doNothing(){return this._get("do_nothing")}whereClause(){return this._get("where_clause")}};var Xe=class extends Z(b){static get syntaxRules(){return{type:"SelectItem",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2}}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);if(!e.deSugar)return r;let n=[],a=Number(e.deSugar)>2,p=!1,c=u=>{p&&(n=n.reduce((f,m)=>u.alias&&m.alias&&oe(u.alias.value,m.alias.value,u.alias.delim||m.alias.delim)?f:f.concat(m),[])),n=n.concat(u)};for(let[u,f]of r.entries.entries())if(f.expr.value==="*")for(let m of f.result_schema){let d=m.jsonfy(),y={nodeName:l.SelectItemAlias.NODE_NAME,as_kw:!0,value:d.value,delim:d.delim};c({nodeName:l.SelectItem.NODE_NAME,expr:d,alias:y,result_schema:d.result_schema.clone(),_originalStarJson:f})}else if(a&&this.entries()[u].expr()instanceof l.LQObjectLiteral&&!this.entries()[u].alias()){let[m]=f.expr.arguments.reduce(([y,N],x)=>N?[[...y,[N,x]]]:[y,x],[[]]),d=f.expr.result_schema.entries();for(let y=0;y<m.length;y++)c({nodeName:l.SelectItem.NODE_NAME,expr:m[y][1],alias:{...m[y][0],nodeName:l.SelectItemAlias.NODE_NAME,as_kw:!0},result_schema:d[y]})}else c(f);return{...r,entries:n}}finalizeJSON(e,t,s,r){let n=Number(r.deSugar)>2,a,[p,c]=e.entries.reduce(([u,f],{_originalStarJson:m,...d})=>{if(m&&(a=!0),m&&!n)return m.result_schema||(m.result_schema=l.JSONSchema.fromJSON({entries:[]},{assert:!0})),m.result_schema._add("entries",d.result_schema),[u.concat(m),f.concat(d.result_schema.clone())];if(!d.result_schema){let y=l.SelectItem.fromJSON(d,this.options);this._adoptNodes(y),d=y.jsonfy(r,t,s)}return[u.concat(d),f.concat(d.result_schema.clone())]},[[],[]]);return e={...e,entries:a&&!n?[...new Set(p)]:p,result_schema:l.JSONSchema.fromJSON({entries:c},{assert:!0})},t.statementContext.artifacts.set("outputSchemas",new Set(c)),e}};var Vr=class extends Xe{static get syntaxRules(){return[{type:"keyword",value:"RETURNING"},...[].concat(super.syntaxRules)]}};var Qr=class extends h{static get syntaxRules(){return{dialect:"postgres",syntax:[{type:"keyword",value:"WHERE"},{type:"keyword",value:"CURRENT OF"},{type:"identifier",as:"cursor_name",assert:!0}]}}cursorName(){return this._get("cursor_name")}};var Xr=class extends b{static get syntaxRules(){return[{type:"keyword",value:"SET"},{type:"AssignmentExpr",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2}]}};var zr=class extends b{static get syntaxRules(){return[{type:"keyword",value:"USING"},{type:"FromItem",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0}]}};var Zr=class extends b{static get syntaxRules(){return{syntax:[{type:"paren_block",syntax:{type:["LQDeepRef2","ColumnRef2"],as:"entries",arity:1/0,itemSeparator:{type:"punctuation",value:","},autoIndent:10}}]}}static get syntaxPriority(){return-1}};var ze=class extends Z(b){static get syntaxRules(){let e={type:"punctuation",value:","};return{syntaxes:[[{type:"keyword",value:"VALUES"},{type:["TypedRowConstructor","RowConstructor"],as:"entries",arity:{min:1},itemSeparator:e,assert:!0,autoIndent:2}],{dialect:"mysql",syntax:[{type:"keyword",value:["VALUES","VALUE"]},{type:["TypedRowConstructor","RowConstructor"],as:"entries",arity:{min:1},itemSeparator:e,assert:!0,autoIndent:2}]}]}}static get syntaxPriority(){return-1}jsonfy(e={},t=null,s=null){let r=super.jsonfy({...e,forceDeSugar:e.deSugar},t,s);if(e.deSugar){let n=r.entries?.[0]?.result_schema;r={...r,result_schema:n?.clone()}}return r}};var es=class extends ee{static get syntaxRules(){return[{type:["LQDeepRef1","ColumnsConstructor","ColumnRef2"],as:"left",dialect:"postgres"},{type:["LQDeepRef1","ColumnRef1"],as:"left",dialect:"mysql"},{type:"operator",as:"operator",value:"="},{type:["ValuesTableLiteral","DerivedQuery","Expr"],as:"right"}]}};var ts=class extends ee{static get syntaxRules(){return[{type:"keyword",as:"my_default_kw",value:"DEFAULT",booleanfy:!0,dialect:"mysql",optional:!0},{syntaxes:[{type:"keyword",as:"left"},{type:"identifier",as:"left"}]},{type:"operator",as:"operator",value:"="},{syntaxes:[{type:"Expr",as:"right"},{type:"keyword",as:"right"}]}]}myDefaultKW(){return this._get("my_default_kw")}};var rs=class extends ee{static get syntaxRules(){return[{type:"keyword",as:"my_default_kw",value:"DEFAULT",booleanfy:!0,dialect:"mysql",optional:!0},{syntaxes:[{type:"keyword",as:"left"},{type:"identifier",as:"left"}]},{type:"operator",as:"operator",value:"=",optional:!0},{syntaxes:[{type:"Expr",as:"right"},{type:"keyword",as:"right"}]}]}myDefaultKW(){return this._get("my_default_kw")}};var ss=class extends ee{static get syntaxRules(){return[{type:"keyword",as:"default_kw",value:"DEFAULT",booleanfy:!0,optional:!0},{syntaxes:[{type:"keyword",as:"left"},{type:"identifier",as:"left"}]},{optional:!0,syntax:[{type:"operator",as:"operator",value:"="},{syntaxes:[{type:"Expr",as:"right"},{type:"keyword",as:"right"}]}]}]}myDefaultKW(){return this._get("my_default_kw")}};var as=class extends ee{static get syntaxRules(){return{dialect:"mysql",syntax:[{type:["UserVar","SystemVar"],as:"left"},{type:"operator",as:"operator",value:["=",":="]},{type:"Expr",as:"right"}]}}};var ns=class extends Z(h){static get syntaxRules(){return[{type:"keyword",as:"pg_only_kw",value:"ONLY",optional:!0,dialect:"postgres"},{type:"TableRef1",as:"table_ref",assert:!0},{type:"operator",as:"pg_star_ref",value:"*",booleanfy:!0,optional:!0,dialect:"postgres"},{type:"SelectItemAlias",as:"alias",optional:!0}]}tableRef(){return this._get("table_ref")}alias(){return this._get("alias")}pgOnlyKW(){return this._get("pg_only_kw")}pgStarRef(){return this._get("pg_star_ref")}deriveAlias(){let e;return this.alias()?e=this.alias():e=l.SelectItemAlias.fromJSON({as_kw:!0,value:this.tableRef().value(),delim:this.tableRef()._get("delim")}),e}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);if(e.deSugar){let n=r.alias||this.deriveAlias().jsonfy(),a={nodeName:l.Identifier.NODE_NAME,value:n.value,delim:n.delim},p=r.table_ref.result_schema.clone({renameTo:a});r.alias&&(p=p.clone({renameTo:{nodeName:l.Identifier.NODE_NAME,value:r.alias.value,delim:r.alias.delim}})),t.statementContext.artifacts.get("tableSchemas").add({resultSchema:p});let c=Number(e.deSugar)>1&&n||r.alias;r={...r,alias:c,result_schema:p}}return r}};var os=class extends h{static get syntaxRules(){return[{type:"TableRef1",as:"table_ref"},{optional:!0,dialect:"mysql",syntax:[{type:"punctuation",value:".",autoSpacing:!1},{type:"operator",as:"my_star_ref",value:"*",booleanfy:!0,autoSpacing:!1}]}]}tableRef(){return this._get("table_ref")}myStarRef(){return this._get("my_star_ref")}};var Ze=o=>class extends o{get isSelectorStmt(){return!0}jsonfy(e={},t=null,s=null){if(!e.deSugar)return super.jsonfy(e,t,s);let{ColumnRef1:r,ColumnRef2:n,AggrCallExpr:a,LQBackRefAbstraction:p,LQDeepRef1:c,LQBackRef:u}=l;return t=new ne((f,m,d,{deSugar:y,asAggr:N,...x})=>{let _=E=>E instanceof r&&E.qualifier()instanceof p,S=E=>{let C=E.qualifier().jsonfy(),T={...E.jsonfy(),qualifier:void 0,nodeName:n.NODE_NAME},I=c.fromJSON({left:C,right:T});return E.parentNode._adoptNodes(I),I},g=E=>({nodeName:a.NODE_NAME,name:(x.toDialect||this.options.dialect)==="mysql"?"JSON_ARRAYAGG":"JSON_AGG",arguments:[E]});if(_(f)&&(f=S(f)),f instanceof c){let{select:E,detail:C}=this.createSelectorDimension(f,t,s,{...x,asAggr:N}),T=N?g(C.jsonfy()):C.jsonfy();return E(T)}if(f instanceof u||f instanceof p){f instanceof p&&(f=f.expr());let{alias:E}=this.createSelectorDimension(f,t,s,x);return E()}return m()},t,this),super.jsonfy(e,t,s)}createSelectorDimension(e,t,s,{asAggr:r=!1,...n}={}){let{lhsOperand:a,rhsOperand:p,rhsTable:c,detail:u}=e.resolve(t,s),f=t.statementContext.artifacts.get("selectorDimensions"),{CompleteSelectStmt:m,DerivedQuery:d,FromClause:y,JoinClause:N,OnClause:x,GroupByClause:_,GroupingElement:S,FromItem:g,SelectList:E,SelectItem:C,FromItemAlias:T,SelectItemAlias:I,TableRef1:Y,ColumnRef1:j,BinaryExpr:q}=l,$=`dimension${r?"/g":""}|${[a,p,c].join("|")}`,B=t.statementContext.hash($,"join");if(f?.has(B))return{...f.get(B),detail:u};let G=new Map,v=t.rand("key",G),A=p.jsonfy(),K={nodeName:C.NODE_NAME,expr:A,alias:{nodeName:I.NODE_NAME,as_kw:!0,value:v}},L={nodeName:N.NODE_NAME,join_type:"LEFT",expr:{nodeName:d.NODE_NAME,expr:{nodeName:m.NODE_NAME,select_list:{nodeName:E.NODE_NAME,entries:[K]},from_clause:{nodeName:y.NODE_NAME,entries:[{nodeName:g.NODE_NAME,expr:c.jsonfy({...n,deSugar:0})}]},group_by_clause:r?{nodeName:_.NODE_NAME,entries:[{nodeName:S.NODE_NAME,expr:{nodeName:j.NODE_NAME,value:v}}]}:void 0}},alias:{nodeName:T.NODE_NAME,as_kw:!0,value:B},condition_clause:{nodeName:x.NODE_NAME,expr:{nodeName:q.NODE_NAME,operator:"=",left:a.jsonfy({...n,deSugar:0},t,s),right:{nodeName:j.NODE_NAME,qualifier:{nodeName:Y.NODE_NAME,value:B},value:v}}}},W={id:B,type:"join",query:L,alias:()=>({nodeName:Y.NODE_NAME,value:B}),select:H=>{let k=t.rand("ref",G);return L.expr.expr.select_list.entries.push({nodeName:C.NODE_NAME,expr:H,alias:{nodeName:I.NODE_NAME,as_kw:!0,value:k}}),{nodeName:j.NODE_NAME,qualifier:{nodeName:Y.NODE_NAME,value:B},value:k}},detail:u};return f.set(B,W),W}finalizeSelectorJSON(e,t,s,r){let n=t.statementContext.artifacts.get("selectorDimensions");e={...e,join_clauses:e.join_clauses?.slice(0)||[]};for(let[,{query:a}]of n){let p=l.JoinClause.fromJSON(a,this.options);this._adoptNodes(p);let c=t.transform(p,(u=r,f=t)=>p.jsonfy({...u,deSugar:2},f,s),null,r);e.join_clauses.push(c)}return e}};var is=class extends Ze(me){static get syntaxRules(){let e={type:"punctuation",value:","};return[{type:"keyword",value:"DELETE"},{assert:!0,syntaxes:[{dialect:"postgres",syntax:[{type:"keyword",value:"FROM"},{type:"TableAbstraction2",as:"table_expr"},{type:"UsingFromClause",as:"using_clause",optional:!0,autoIndent:!0},{type:"JoinClause",as:"join_clauses",arity:1/0,optional:!0,autoIndent:!0},{type:["PGWhereCurrentClause","WhereClause"],as:"where_clause",optional:!0,autoIndent:!0},{type:"ReturningClause",as:"returning_clause",optional:!0,autoIndent:!0}]},{dialect:"mysql",syntax:[{type:"TableAbstraction1",as:"my_delete_list",arity:{min:1},itemSeparator:e},{type:"FromClause",as:"my_from_clause",autoIndent:!0},{type:"JoinClause",as:"join_clauses",arity:1/0,optional:!0,autoIndent:!0},{type:"WhereClause",as:"where_clause",optional:!0,autoIndent:!0}]},{dialect:"mysql",syntax:[{type:"keyword",value:"FROM"},{type:"TableAbstraction1",as:"my_delete_list",arity:{min:1},itemSeparator:e},{type:"UsingFromClause",as:"using_clause",autoIndent:!0},{type:"JoinClause",as:"join_clauses",arity:1/0,optional:!0,autoIndent:!0},{type:"WhereClause",as:"where_clause",optional:!0,autoIndent:!0}]},{dialect:"mysql",syntax:[{type:"keyword",value:"FROM"},{type:"TableAbstraction2",as:"table_expr"},{type:"MYPartitionClause",as:"my_partition_clause",optional:!0,autoIndent:!0},{type:"WhereClause",as:"where_clause",optional:!0,autoIndent:!0},{type:"OrderByClause",as:"my_order_by_clause",optional:!0,dialect:"mysql",autoIndent:!0},{type:"LimitClause",as:"my_limit_clause",optional:!0,dialect:"mysql",autoIndent:!0}]}]}]}tableExpr(){return this._get("table_expr")}usingClause(){return this._get("using_clause")}joinClauses(){return this._get("join_clauses")}whereClause(){return this._get("where_clause")}returningClause(){return this._get("returning_clause")}myPartitionClause(){return this._get("my_partition_clause")}myDeleteList(){return this._get("my_delete_list")}myFromClause(){return this._get("my_from_clause")}myOrderByClause(){return this._get("my_order_by_clause")}myLimitClause(){return this._get("my_limit_clause")}querySchemas(){inheritedQuerySchemas=new Set(inheritedQuerySchemas||[]);let e=new Set,t=(s,r)=>{let n=l.Identifier.fromJSON({value:s}),a=r.resultSchema(transformer).clone({renameTo:n});inheritedQuerySchemas.add(a),e.add(a)};if(this.tableExpr()){let s=this.tableExpr(),r=s.tableRef();t(s.alias()?.value()||r.value(),r)}else if(this.myDeleteList()?.length)for(let s of this.myDeleteList()){let r=s.tableRef();t(r.value(),r)}if(this.usingClause())for(let s of this.usingClause()){let r=s.expr();t(s.alias()?.value()||r.value(),r)}else if(this.myFromClause())for(let s of this.myFromClause()){let r=s.expr();t(s.alias()?.value()||r.value(),r)}if(this.joinClauses())for(let s of this.joinClauses()){let r=s.expr();t(s.alias()?.value()||r.value(),r)}return e}jsonfy(e={},t=null,s=null){if(e.deSugar){let r=e.rands||new Map;e={...e,rands:r,hashes:new Map}}return super.jsonfy(e,t,s)}finalizeSelectorJSON(e,t,s,r){if(this.options.dialect!=="postgres")return super.finalizeSelectorJSON(e,t,s,r);let{FromItem:n,TableAbstraction2:a,SelectItemAlias:p,FromItemAlias:c,TableRef2:u,TableRef1:f,ColumnRef1:m,SelectItem:d,FromClause:y,CompleteSelectStmt:N,DerivedQuery:x,BinaryExpr:_}=l;if(e.where_clause?.cursor_name)throw new Error('Deep/Back Refs are currently not supported with a "WHERE CURRENT OF..." statement');let S=this._rand("rand"),g=e.table_expr.name.value,E=e.table_expr.alias?e.table_expr.alias.value:e.table_expr.name.value,C=`${S}::${E}`,T=e.where_clause,I=this.table().resultSchema(t,!0).pkConstraint(!0)?.columns()[0];if(!I)throw new Error("");return e={...e,table_expr:{nodeName:a.NODE_NAME,name:{nodeName:u.NODE_NAME,value:g},alias:{nodeName:p.NODE_NAME,value:C}},where_clause:{nodeName:_.NODE_NAME,left:{nodeName:m.NODE_NAME,qualifier:{nodeName:f.NODE_NAME,value:C},value:I},operator:"IN",right:{nodeName:x.NODE_NAME,expr:{nodeName:N.NODE_NAME,select_list:{nodeName:SelectList.NODE_NAME,entries:[{nodeName:d.NODE_NAME,expr:{nodeName:m.NODE_NAME,value:I}}]},from_clause:{nodeName:y.NODE_NAME,entries:[{nodeName:n.NODE_NAME,expr:{nodeName:u.NODE_NAME,value:g},alias:{nodeName:c.NODE_NAME,value:E}}]},where_clause:T,join_clauses:[...selectorDimensions].map(Y=>Y.query)}}}},e}};var ls=o=>class extends o{get isPayloadStmt(){return!0}static morphsTo(){return l.CTE}jsonfy(e={},t=null,s=null){if(!e.deSugar)return super.jsonfy(e,t,s);let{LQDeepRef2:r,AssignmentExpr:n,DerivedQuery:a,ColumnsConstructor:p,ValuesConstructor:c,TypedRowConstructor:u,RowConstructor:f}=l,m=["column_list","pg_default_values_clause","values_clause","select_clause"].map(E=>this._get(E)),[d,y,N,x]=m,_=d?.entries().some(E=>E instanceof r),S=_?new Set(m):new Set;t=new ne((E,C,T,{deSugar:I,...Y})=>{if(S.has(E))return;if(!(E instanceof n))return C();let j=!!this._get("on_conflict_clause")?.containsNode(E),q={...Y,onConflictClauseContext:j};if(E.left()instanceof r){let[[$],[[B]]]=this.deSugarPayload(new p({entries:[E.left()]}),[[E.right()]],t,s,q);return $?{nodeName:n.NODE_NAME,operator:"=",left:$.entries,right:B}:void 0}if(E.left()instanceof p&&E.left().entries().some($=>$ instanceof r)){let $=E.left(),B,G;return E.right()instanceof f?([B,[G]]=this.deSugarPayload($,[E.right().entries()],t,s,q),G={nodeName:u.NODE_NAME,entries:G}):E.right()instanceof a?([B,G]=this.deSugarPayload($,E.right().expr(),t,s,q),G={nodeName:a.NODE_NAME,expr:G}):[B,[G]]=this.deSugarPayload($,[[E.right()]],t,s,q),B.length?{nodeName:n.NODE_NAME,operator:"=",left:{nodeName:p.NODE_NAME,entries:B},right:G}:void 0}return C()},t,this);let g=super.jsonfy(e,t,s);if(_){let[E,C]=this.deSugarPayload(d,y||N?.entries().map(T=>T.entries())||x,t,s,e);if(g={...g,column_list:{nodeName:p.NODE_NAME,entries:E}},y&&Array.isArray(C)||N){let T=C.map(I=>({nodeName:u.NODE_NAME,entries:I}));g={...g,values_clause:{nodeName:c.NODE_NAME,entries:T}}}else y?g={...g,pg_default_values_clause:C}:g={...g,select_clause:C}}return g}deSugarPayload(e,t,s,r,{onConflictClauseContext:n=!1,deSugar:a,...p}={}){let c=s.statementContext.artifacts.get("payloadDimensions"),{LQDeepRef2:u,TableRef1:f,ColumnRef1:m,SelectItemAlias:d,ColumnRef2:y,ColumnsConstructor:N,TypedRowConstructor:x,RowConstructor:_,DefaultLiteral:S,SelectStmt:g,CompleteSelectStmt:E,PGDefaultValuesClause:C,SelectList:T,SelectItem:I,FromClause:Y,FromItem:j}=l,q=(w,P=a)=>w.jsonfy({deSugar:P,...p},s,r),$=(w,P)=>w.entries().reduce((W,H,k)=>{if(H instanceof u){let M=this.createPayloadDimension(H,s,r,{onConflictClauseContext:n,...p});return P.set(k,M),M.refMode==="dependency"&&M.lhsOperandJson?W.concat({nodeName:y.NODE_NAME,value:M.lhsOperandJson.value,delim:M.lhsOperandJson.delim,result_schema:M.lhsOperandJson.result_schema}):W}return W.concat(q(H))},[]),B=(w,P)=>{let W=e.entries().reduce((H,k,M)=>{let F=P.has(M)?P.get(M).offload(w):{nodeName:S.NODE_NAME,value:"DEFAULT"};return F?H.concat(F):H},[]);return e.length-W.length===P.size?w.jsonfy():[W]},G=(w,P)=>w.map((W,H)=>W.reduce((k,M,F)=>{let O;return e.get(F)instanceof u&&M instanceof S?O=P.get(F).offload(C.fromJSON({value:"DEFAULT"},this.options),H):P.has(F)?O=P.get(F).offload(M,H):O=q(M),O?k.concat(O):k},[])),v=(w,P)=>{let W={...q(w,2),result_schema:void 0},H=W.select_list.entries;if(H.length!==e.length)throw new Error(`Select list (${H.length}) does not match columns length (${e.length})`);let k;if(!n&&W.from_clause&&!/^[`"]\$memo~.+[`"]$/.test(w.fromClause().entries()[0].expr()+"")){let O=s.rootContext.rand("memo");k={...W,uuid:O,select_list:{nodeName:T.NODE_NAME,entries:[Oa("$row_number~a")]}},c.add({refMode:"memo",query:k});let J={nodeName:j.NODE_NAME,expr:{nodeName:f.NODE_NAME,value:O}};W={nodeName:E.NODE_NAME,select_list:{nodeName:T.NODE_NAME,entries:[]},from_clause:{nodeName:Y.NODE_NAME,entries:[J]}}}let M=(O,J=!1)=>k?(O.alias&&J?O={...O,alias:{...O.alias,value:O.alias.value+s.rand("rand",{asSalt:!0})}}:O.alias||(O.alias={nodeName:d.NODE_NAME,as_kw:!0,value:s.rand("value")}),k.select_list.entries.push(O),{nodeName:I.NODE_NAME,expr:{nodeName:m.NODE_NAME,value:O.alias.value,delim:O.alias.delim}}):O,F=H.reduce((O,J,R)=>{if(P.has(R)){let D;[x.NODE_NAME,_.NODE_NAME].includes(J.expr.nodeName)?(D=J.expr.entries.map(se=>M({nodeName:I.NODE_NAME,expr:se,alias:J.alias},!0)),e.get(R).right()instanceof N||(D=[{nodeName:I.NODE_NAME,expr:{nodeName:x.NODE_NAME,entries:D.map(se=>se.expr)}}])):D=[M(J)];let ue=g.fromJSON({...W,select_list:{nodeName:T.NODE_NAME,entries:D}},this.options);if(J=P.get(R).offload(ue),J){let se=P.get(R).lhsOperandJson;return O.concat({nodeName:I.NODE_NAME,expr:J,alias:{nodeName:d.NODE_NAME,as_kw:!0,value:se.value,delim:se.delim}})}return O}if(!J.alias){let D=e.get(R);J={...J,alias:{nodeName:d.NODE_NAME,as_kw:!0,value:D.value(),delim:D._get("delim")}}}return O.concat(M(J))},[]);return W={...W,select_list:{nodeName:T.NODE_NAME,entries:F}},W},A=new Map,K=$(e,A),L=t instanceof C?B(t,A):t instanceof g?v(t,A):G(t,A);return A.clear(),[K,L]}createPayloadDimension(e,t,s,{onConflictClauseContext:r=!1,...n}={}){let{lhsOperand:a,rhsOperand:p,rhsTable:c,detail:u}=e.resolve(t,s,2),f=t.statementContext.artifacts.get("payloadDimensions"),{LQDeepRef2:m,LQBackRefAbstraction:d,ReturningClause:y,ColumnRef2:N,ColumnRef1:x,TableRef1:_,SelectList:S,SelectItem:g,SelectItemAlias:E,AssignmentExpr:C,ColumnsConstructor:T,TypedRowConstructor:I,RowConstructor:Y,PGDefaultValuesClause:j,ValuesConstructor:q,ValuesTableLiteral:$,DefaultLiteral:B,SelectStmt:G,WhereClause:v,CompleteSelectStmt:A,ScalarSubquery:K,DerivedQuery:L,FromItem:w,FromClause:P,SetClause:W,BinaryExpr:H,BoolLiteral:k,NumberLiteral:M,UpdateStmt:F,TableAbstraction2:O}=l,J=t.rootContext.hash(this,"main"),R=U=>U.jsonfy(n,t,s),D=R(a),ue=R(p),se=R(c),le=a.jsonfy({toKind:1}),_e=p.jsonfy({toKind:1}),Xs={...se,nodeName:_.NODE_NAME},ge=e.left()instanceof d?"dependent":"dependency",Ae=u instanceof m,Re;if(u instanceof T)Re=R(u);else if(u instanceof N||u instanceof m)Re={nodeName:T.NODE_NAME,entries:[R(u)]};else throw new Error(`Invalid columns spec: ${e}`);let ca=Re.entries.length,Be=(U,Q=null)=>{if(Ae)return U;let ae=1;if(Q?ae=Q.length:U instanceof Y||U instanceof G||U instanceof G?ae=U.length:U instanceof L&&(ae=U.expr().length),ae>ca)throw new Error(`[${U}] Payload has more columns than target columns: ${u}.`);if(ae<ca)throw new Error(`[${U}] Payload has fewer columns than target columns: ${u}.`);return U},pt=(U,Q,ae=null,pe=null)=>{let V,z;typeof ae=="number"?z={nodeName:M.NODE_NAME,value:ae+1}:ae&&(z=ae),z?V={nodeName:H.NODE_NAME,left:{nodeName:x.NODE_NAME,value:"$row_number~b"},operator:"=",right:z}:pe&&(V={nodeName:H.NODE_NAME,left:{nodeName:x.NODE_NAME,value:pe},operator:"IS",right:{nodeName:k.NODE_NAME,value:"TRUE"}});let te={nodeName:w.NODE_NAME,expr:{nodeName:_.NODE_NAME,value:z?`${U}~indices`:U}},tt={nodeName:A.NODE_NAME,select_list:{nodeName:S.NODE_NAME,entries:[{nodeName:g.NODE_NAME,expr:{...Q,qualifier:void 0}}]},from_clause:{nodeName:P.NODE_NAME,entries:[te]},where_clause:V&&{nodeName:v.NODE_NAME,expr:V}};return{nodeName:K.NODE_NAME,expr:tt}};if(this instanceof F||r){let U=r?`${J}_on_conflict_updated_status`:null,Q={nodeName:H.NODE_NAME,left:_e,operator:"IN",right:pt(J,D,null,U)},ae={uuid:t.rootContext.rand(ge),nodeName:F.NODE_NAME,table_expr:{nodeName:O.NODE_NAME,table_ref:Xs},set_clause:{nodeName:W.NODE_NAME,entries:[]},where_clause:{nodeName:v.NODE_NAME,expr:Q}},V={refMode:ge,query:ae,offload:z=>{if(z instanceof $)throw new Error(`Single-row payload structure expected for column structure: ${u}. Recieved ${z.NODE_NAME}.`);if(ae.set_clause.entries.length)throw new Error(`Unexpected multiple offload() call on ${e}`);let te=R(z);if(Ae&&!(z instanceof j)&&(z=I.fromJSON({entries:[te]},this.options),te=R(z)),z instanceof G?(te={nodeName:L.NODE_NAME,expr:te,result_schema:te.result_schema},Be(z,te.result_schema)):z instanceof L?Be(z,te.result_schema):z instanceof Y?Be(z):z instanceof j||(te={nodeName:I.NODE_NAME,entries:[te]}),ae.set_clause.entries.push({nodeName:C.NODE_NAME,left:Re,operator:"=",right:te}),ge==="dependency")return le},lhsOperandJson:D,onConflictClauseContext:r};return f.add(V),V}let ye=[],zs=(U,Q,ae=null)=>{if(Q instanceof j)if(ae){let pe=U.column_list.entries.length-1;U.values_clause.entries.push({nodeName:I.NODE_NAME,entries:U.column_list.entries.map((V,z)=>z===pe?ae:{nodeName:B.NODE_NAME,value:"DEFAULT"})})}else delete U.values_clause,U.pg_default_values_clause=R(Q);else{Be(Q);let pe=R(Q);Q instanceof Y||(pe={nodeName:I.NODE_NAME,entries:[pe]}),ae&&(pe={...pe,entries:pe.entries.concat(ae)}),U.values_clause.entries.push(pe)}};if(ge==="dependent"){let U=()=>({uuid:t.rootContext.rand(ge),nodeName:this.NODE_NAME,table_ref:se,column_list:T.fromJSON({entries:Re.entries.concat(ue)}).jsonfy()}),Q=(V,z)=>{let te={nodeName:g.NODE_NAME,expr:z,alias:p instanceof N?{nodeName:E.NODE_NAME,as_kw:!0,value:p.value(),delim:p._get("delim")}:void 0};return{...V,select_list:{...V.select_list,entries:V.select_list.entries.concat(te)}}},pe={refMode:ge,queries:ye,offload:(V,z=null)=>{ye.length||ye.push(U());let te=ye[ye.length-1];V instanceof G&&(z={nodeName:x.NODE_NAME,value:"$row_number~a"});let tt=pt(J,D,z),ma;if(V instanceof L&&(V=V.expr(),(te.select_clause||te.values_clause)&&(te=U(),ye.push(te)),ma=!0),V instanceof G){let Je=R(V);!ma&&!Ae&&(Je=Ta(Je,Re)),Be(V,Je.result_schema),te.select_clause=Q(Je,tt);return}if(te.select_clause&&(te=U(),ye.push(te)),te.values_clause||(te.values_clause={nodeName:q.NODE_NAME,entries:[]}),Ae&&!(V instanceof j)&&(V=I.fromJSON({entries:[R(V)]})),V instanceof $)for(let Je of V.entries())zs(te,Je,tt);else zs(te,V,tt)},lhsOperandJson:D};return f.add(pe),pe}let fa={nodeName:x.NODE_NAME,value:p.value(),delim:p._get("delim")},Zs=()=>({uuid:t.rootContext.rand(ge),nodeName:this.NODE_NAME,table_ref:se,column_list:Re,returning_clause:{nodeName:y.NODE_NAME,entries:[{nodeName:g.NODE_NAME,expr:_e}]}}),ya={refMode:ge,queries:ye,offload:U=>{if(U instanceof $)throw new Error(`Single-row payload structure expected for column structure: ${e.right()}. Recieved ${U.NODE_NAME}.`);ye.length||ye.push(Zs());let Q=ye[ye.length-1],ae=!1;if(U instanceof L&&(U=U.expr(),(Q.select_clause||Q.values_clause)&&(Q=Zs(),ye.push(Q)),ae=!0),U instanceof G){let V=R(U),z;return ae||(Ae||(V=Ta(V,Re)),z={nodeName:x.NODE_NAME,value:"$row_number~a"}),Be(U,V.result_schema),Q.select_clause=V,pt(Q.uuid,fa,z)}Q.select_clause&&(Q=Zs(),ye.push(Q)),Q.values_clause||(Q.values_clause={nodeName:q.NODE_NAME,entries:[]}),Ae&&!(U instanceof j)&&(U=I.fromJSON({entries:[R(U)]})),zs(Q,U);let pe;return Q.values_clause&&(pe=Q.values_clause.entries.length-1),pt(Q.uuid,fa,pe)},lhsOperandJson:D,rhsOperandJson:_e};return f.add(ya),ya}finalizePayloadJSON(e,t,s,r){if(e.returning_clause){let A=this.returningClause().finalizeJSON(e.returning_clause,t,s,r);e={...e,returning_clause:A,result_schema:A.result_schema}}else e={...e,result_schema:l.JSONSchema.fromJSON({entries:[]},this.options)};let n=t.statementContext.artifacts.get("payloadDimensions");if(!n.size)return e;let{ColumnRef0:a,ColumnRef1:p,TableRef1:c,FromItem:u,FromClause:f,AggrCallExpr:m,ReturningClause:d,SelectList:y,SelectItem:N,SelectItemAlias:x,CTE:_,CTEItem:S,CTEItemAlias:g,CompleteSelectStmt:E,UpdateStmt:C}=l,T=t.rootContext.hash(this,"main"),I={nodeName:_.NODE_NAME,declarations:[],body:null},Y=t,j=(A,K,L=[],w=Y)=>{let P=S.fromJSON({nodeName:S.NODE_NAME,alias:{nodeName:g.NODE_NAME,value:A},expr:K},this.options).jsonfy(r,w,s);if(P.expr?.nodeName===_.NODE_NAME){if(I.declarations.push(...P.expr.declarations),this instanceof C&&P.expr.body.nodeName===E.NODE_NAME)return;P={nodeName:S.NODE_NAME,alias:{nodeName:g.NODE_NAME,value:A},expr:P.expr.body}}I.declarations.push(P),L.length&&I.declarations.push(S.fromJSON({nodeName:S.NODE_NAME,alias:{nodeName:g.NODE_NAME,value:`${A}~indices`},expr:Fa(L,A)},this.options).jsonfy(r,w,s))},q=[],$=[],B=[],G=!1,v=e.returning_clause?.entries||[];for(let{refMode:A,query:K,queries:L,lhsOperandJson:w,rhsOperandJson:P,onConflictClauseContext:W}of n)for(let{uuid:H,...k}of K&&[K]||L)if(A==="dependent"||this instanceof C&&A==="dependency"){if(!B.find(M=>oe(M.expr.value,w.value))){let M={nodeName:N.NODE_NAME,expr:w};v.find(F=>oe((F.alias||F.expr).value,w.value))&&(M.alias={nodeName:x.NODE_NAME,as_kw:!0,value:t.rand("key")}),B.push(M)}W&&(G=!0),q.push({uuid:H,...k})}else if(A==="dependency"){let M=[{nodeName:N.NODE_NAME,expr:P}];e.select_clause?$.push({uuid:H,wherePredicate:M,...k}):k.pg_default_values_clause||k.select_clause?j(H,k):j(H,k,M)}else j(H,k);for(let{uuid:A,wherePredicate:K,...L}of $)j(A,L,K);if(q.length){let A=[];for(let P of v)P.alias?A.push({...P,expr:{nodeName:p.NODE_NAME,value:P.alias.value,delim:P.alias.delim}}):A.push({...P});let K={nodeName:d.NODE_NAME,entries:[...v,...B]};if(G){let P=`${T}_on_conflict_updated_status`}this instanceof C?j(T,{...e,returning_clause:K}):e.pg_default_values_clause?j(T,{...e,returning_clause:K}):j(T,{...e,returning_clause:K},B);for(let{uuid:P,...W}of q)j(P,W);let L=A;L.length||(L=[{nodeName:N.NODE_NAME,expr:{nodeName:m.NODE_NAME,name:"COUNT",arguments:[{nodeName:a.NODE_NAME,value:"*"}]},alias:{nodeName:x.NODE_NAME,as_kw:!0,value:"COUNT"}}]);let w={nodeName:u.NODE_NAME,expr:{nodeName:c.NODE_NAME,value:T}};I.body=E.fromJSON({nodeName:E.NODE_NAME,select_list:{nodeName:y.NODE_NAME,entries:L},from_clause:{nodeName:f.NODE_NAME,entries:[w]}},this.options).jsonfy(r,Y,s)}else{let K=[this.constructor].concat(this.constructor.morphsTo()).reduce((L,w)=>L||w.fromJSON(e,this.options),void 0);I.body=K.jsonfy(r,Y,s)}return{...I,result_schema:I.body.result_schema}}},Ta=(o,e)=>{let t=o.select_list.entries.reduce((s,r,n)=>{if(!r.alias){let a=e.entries[n];r={...r,alias:{nodeName:l.SelectItemAlias.NODE_NAME,as_kw:!0,value:a.value,delim:a.delim}}}return s.concat(r)},[]);return{...o,select_list:{...o.select_list,entries:t}}},Fa=(o,e)=>{let t=Oa("$row_number~b");o=o.map(r=>r.alias?{...r,expr:{...r.expr,value:r.alias.value,delim:r.alias.delim,qualifier:void 0},alias:{...r.alias,value:r.expr.value,delim:r.expr.delim}}:r.expr.nodeName===l.ColumnRef0.NODE_NAME?i:{...r,expr:{...r.expr,qualifier:void 0},alias:{nodeName:l.SelectItemAlias.NODE_NAME,as_kw:!0,value:r.expr.value,delim:r.expr.delim}}).concat(t);let s={nodeName:l.FromItem.NODE_NAME,expr:{nodeName:l.TableRef1.NODE_NAME,value:e}};return{nodeName:l.CompleteSelectStmt.NODE_NAME,select_list:{nodeName:l.SelectList.NODE_NAME,entries:o},from_clause:{nodeName:l.FromClause.NODE_NAME,entries:[s]}}},Oa=o=>({nodeName:l.SelectItem.NODE_NAME,expr:{nodeName:l.AggrCallExpr.NODE_NAME,name:"ROW_NUMBER",arguments:[],over_clause:{nodeName:l.WindowSpec.NODE_NAME}},alias:{nodeName:l.SelectItemAlias.NODE_NAME,as_kw:!0,value:o||3}});var Me=class extends ls(me){static get _clause(){return"INSERT"}static get syntaxRules(){let e={optional:!0,syntax:[{type:"keyword",value:"AS",booleanfy:!0},{type:"Identifier",as:"pg_table_alias",assert:!0}]},t={optional:!0,dialect:"mysql",if:["!select_clause","!my_table_clause"],syntax:[{type:"keyword",value:"AS"},{type:"FromItemAlias",as:"my_row_alias",assert:!0}]};return[{type:"keyword",value:this._clause},{type:"keyword",value:"INTO"},{assert:!0,syntax:[{dialect:"postgres",syntax:[{type:"TableRef2",as:"table_ref"},{...e},{type:"ColumnsConstructor",as:"column_list",optional:!0,autoIndent:!0},{syntaxes:[{type:"PGDefaultValuesClause",as:"pg_default_values_clause"},{type:"ValuesConstructor",as:"values_clause"},{type:"SelectStmt",as:"select_clause"}],autoSpacing:`
`},...this._clause==="INSERT"?[{type:"PGOnConflictClause",as:"conflict_handling_clause",optional:!0,autoSpacing:`
`}]:[],{type:"ReturningClause",as:"returning_clause",optional:!0,autoSpacing:`
`}]},{dialect:"mysql",syntax:[{type:"TableRef2",as:"table_ref"},{type:"MYPartitionClause",as:"my_partition_clause",optional:!0,autoIndent:!0},{syntaxes:[[{type:"ColumnsConstructor",as:"column_list",optional:!0,autoIndent:!0},{syntaxes:[{type:"ValuesConstructor",as:"values_clause"},{type:"SelectStmt",as:"select_clause"},{type:"TableStmt",as:"my_table_clause"}],autoSpacing:`
`}],{type:"SetClause",as:"my_set_clause",autoSpacing:`
`}]},{...t},...this._clause==="INSERT"?[{type:"MYOnDuplicateKeyUpdateClause",as:"conflict_handling_clause",optional:!0,autoSpacing:`
`}]:[]]}]}]}tableRef(){return this._get("table_ref")}columnList(){return this._get("column_list")}valuesClause(){return this._get("values_clause")}selectClause(){return this._get("select_clause")}conflictHandlingClause(){return this._get("conflict_handling_clause")}pgTableAlias(){return this._get("pg_table_alias")}pgDefaultValuesClause(){return this._get("pg_default_values_clause")}returningClause(){return this._get("returning_clause")}myRowAlias(){return this._get("my_row_alias")}myPartitionClause(){return this._get("my_partition_clause")}mySetClause(){return this._get("my_set_clause")}myTableClause(){return this._get("my_table_clause")}jsonfy(e={},t=null,s=null){if(!e.deSugar)return super.jsonfy(e,t,s);t=new ne((a,p)=>{if(a instanceof l.TableRef2){let c=p(),u=c.result_schema;return c.pg_table_alias&&(u=u.clone({renameTo:c.pg_table_alias})),t.statementContext.artifacts.get("tableSchemas").add({type:"dml",resultSchema:u}),c}return p()},t,this);let r=super.jsonfy(e,t,s),n=e.toDialect||this.options.dialect;return n==="mysql"?r={uuid:r.uuid,nodeName:r.nodeName,table_ref:r.table_ref,my_partition_clause:r.my_partition_clause,column_list:r.column_list,values_clause:r.values_clause,select_clause:r.select_clause,my_table_clause:r.my_table_clause,my_set_clause:r.my_set_clause,my_row_alias:r.my_row_alias,conflict_handling_clause:r.conflict_handling_clause}:r={uuid:r.uuid,nodeName:r.nodeName,table_ref:r.table_ref,pg_table_alias:r.pg_table_alias,column_list:r.column_list,pg_default_values_clause:r.pg_default_values_clause,values_clause:r.values_clause,select_clause:r.select_clause,conflict_handling_clause:r.conflict_handling_clause,returning_clause:r.returning_clause,result_schema:r.result_schema},n==="postgres"&&!r.pg_table_alias&&Number(e.deSugar)>2&&(r={...r,pg_table_alias:{nodeName:l.Identifier.NODE_NAME,value:r.table_ref.value,delim:r.table_ref.delim}}),r=this.finalizePayloadJSON(r,t,s,e),r}};var us=class extends b{static get syntaxRules(){return[{type:"keyword",value:"SET"},{type:"MYVarAssignmentExpr",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2}]}};var ps=class extends ls(Ze(me)){static get syntaxRules(){return[{type:"keyword",value:"UPDATE"},{assert:!0,syntaxes:[{dialect:"postgres",syntax:[{type:"TableAbstraction2",as:"table_expr"},{type:"SetClause",as:"set_clause",autoSpacing:`
`},{type:"FromClause",as:"pg_from_clause",optional:!0,dialect:"postgres",autoSpacing:`
`},{type:"JoinClause",as:"join_clauses",arity:1/0,optional:!0,autoSpacing:`
`},{type:["PGWhereCurrentClause","WhereClause"],as:"where_clause",optional:!0,autoSpacing:`
`},{type:"ReturningClause",as:"returning_clause",optional:!0,autoSpacing:`
`}]},{dialect:"mysql",syntax:[{type:"TableAbstraction2",as:"table_expr"},{type:"SetClause",as:"set_clause",autoSpacing:`
`},{type:"WhereClause",as:"where_clause",optional:!0,autoSpacing:`
`},{type:"OrderByClause",as:"my_order_by_clause",optional:!0,autoSpacing:`
`},{type:"LimitClause",as:"my_limit_clause",optional:!0,autoSpacing:`
`}]},{dialect:"mysql",syntax:[{type:"TableAbstraction1",as:"my_update_list",arity:{min:1},itemSeparator:{type:"punctuation",value:","}},{type:"JoinClause",as:"join_clauses",arity:1/0,optional:!0,autoSpacing:`
`},{type:"SetClause",as:"set_clause",autoSpacing:`
`},{type:"WhereClause",as:"where_clause",optional:!0,autoSpacing:`
`}]}]}]}tableExpr(){return this._get("table_expr")}joinClauses(){return this._get("join_clauses")}setClause(){return this._get("set_clause")}whereClause(){return this._get("where_clause")}pgFromClause(){return this._get("pg_from_clause")}returningClause(){return this._get("returning_clause")}myUpdateList(){return this._get("my_update_list")}myOrderByClause(){return this._get("my_order_by_clause")}myLimitClause(){return this._get("my_limit_clause")}jsonfy(e={},t=null,s=null){if(!e.deSugar)return super.jsonfy(e,t,s);t=new ne((n,a)=>a(),t,this);let r=super.jsonfy(e,t,s);if((e.toDialect||this.options.dialect)==="mysql"?r={uuid:r.uuid,nodeName:r.nodeName,table_expr:r.table_expr,my_update_list:r.my_update_list,join_clauses:r.join_clauses,set_clause:r.set_clause,where_clause:r.where_clause,my_order_by_clause:r.my_order_by_clause,my_limit_clause:r.my_limit_clause}:r={uuid:r.uuid,nodeName:r.nodeName,table_expr:r.table_expr,set_clause:r.set_clause,pg_from_clause:r.pg_from_clause,join_clauses:r.join_clauses,where_clause:r.where_clause,returning_clause:r.returning_clause,result_schema:r.result_schema},!r.set_clause?.entries.length){let a=r.table_expr.result_schema.pkConstraint(!0).columns()[0];r={...r,set_clause:{...r.set_clause,entries:[{nodeName:l.AssignmentExpr.NODE_NAME,left:a.jsonfy(),operator:"=",right:a.jsonfy({toKind:1})}]}}}return r=this.finalizeSelectorJSON(r,t,s,e),r=this.finalizePayloadJSON(r,t,s,e),r}finalizeSelectorJSON(e,t,s,r){if(this.options.dialect!=="postgres")return super.finalizeSelectorJSON(e,t,s,r);if(e.where_clause?.cursor_name)throw new Error('Deep/Back Refs are currently not supported with a "WHERE CURRENT OF..." statement');let{DerivedQuery:n,CompleteSelectStmt:a,SelectList:p,SelectItem:c,FromItemAlias:u,FromClause:f,WhereClause:m,JoinClause:d,TableRef1:y,BinaryExpr:N,FromItem:x}=l,_=t.rand("join"),S=t.statementContext.artifacts.get("selectorDimensions"),g=e.table_expr,E=g.alias.value,C=g.alias.delim,T=`${_}:${E}`,Y=g.result_schema.pkConstraint(!0)?.columns()[0].jsonfy({toKind:1}),j,q=v=>({nodeName:N.NODE_NAME,left:{...v,qualifier:{nodeName:y.NODE_NAME,value:E,delim:C}},operator:"=",right:{...v,qualifier:{nodeName:y.NODE_NAME,value:T}}}),$,B=v=>{if(!oe(v.qualifier.value,E,v.qualifier.delim||C))return v;if(!j){let A={nodeName:x.NODE_NAME,expr:{nodeName:n.NODE_NAME,expr:{nodeName:a.NODE_NAME,select_list:{nodeName:p.NODE_NAME,entries:[]},from_clause:{nodeName:f.NODE_NAME,entries:[{nodeName:x.NODE_NAME,expr:g.table_ref,alias:{nodeName:u.NODE_NAME,as_kw:!0,value:T}}]}}},alias:{nodeName:u.NODE_NAME,as_kw:!0,value:T}};$=A.expr.expr.select_list.entries,Y&&(A.expr.expr.select_list.entries.push({nodeName:c.NODE_NAME,expr:{...Y,qualifier:{nodeName:y.NODE_NAME,value:T}}}),A.expr.expr.where_clause={nodeName:m.NODE_NAME,expr:q(Y)}),j=A}if($.find(A=>oe(A.expr.value,v.value,A.expr.delim||v.delim))||$.push({nodeName:c.NODE_NAME,expr:{...v,qualifier:{nodeName:y.NODE_NAME,value:T}}}),!Y){let A=q(v);j.expr.expr.where_clause&&(A={nodeName:N.NODE_NAME,left:j.expr.expr.where_clause.expr,operator:"AND",right:A}),j.expr.expr.where_clause={nodeName:m.NODE_NAME,expr:A}}return{...v,qualifier:{nodeName:y.NODE_NAME,value:T}}},G=[];for(let[,{query:v}]of S)G.push({...v,condition_clause:{...v.condition_clause,expr:{...v.condition_clause.expr,left:B(v.condition_clause.expr.left)}}});j&&(e={...e,pg_from_clause:{nodeName:f.NODE_NAME,entries:(e.pg_from_clause?.entries||[]).concat(x.fromJSON(j,this.options).jsonfy(r,t,s))}});for(let v of G)e={...e,join_clauses:(e.join_clauses||[]).concat(d.fromJSON(v,this.options).jsonfy(r,t,s))};return e}};var cs=class extends Ye(Me){static get _clause(){return"UPSERT"}static morphsTo(){return[Me].concat(super.morphsTo())}finalizePayloadJSON(e,t,s,r){if(e.conflict_handling_clause)throw new Error("An explicit conflict handling clause is forbidden on the UPSERT statement.");let n=[...t.statementContext.artifacts.get("tableSchemas")].map(u=>u.resultSchema)[0],a=r.toDialect||this.options.dialect,p;e.my_set_clause?p=e.my_set_clause.entries.map(u=>({value:u.left.value,delim:u.left.delim})):e.column_list?p=e.column_list.entries.map(u=>({value:u.value,delim:u.delim})):p=n.columns().map(u=>u.name().jsonfy({nodeNames:!1}));let c={nodeName:a==="mysql"?l.MYOnDuplicateKeyUpdateClause.NODE_NAME:l.PGOnConflictClause.NODE_NAME,entries:p.map(u=>({nodeName:l.AssignmentExpr.NODE_NAME,left:{nodeName:a==="mysql"?l.ColumnRef1.NODE_NAME:l.ColumnRef2.NODE_NAME,...u},operator:"=",right:{...u,nodeName:l.ColumnRef1.NODE_NAME,qualifier:{value:a==="mysql"?"VALUES":"EXCLUDED"}}}))};if(a==="postgres"){let u=[].concat(n.pkConstraint(!0)||[]).concat(n.ukConstraints(!0)).map(m=>m.columns().map(d=>d.jsonfy()));if(!u.length)throw new Error(`Table ${this.tableRef()} has no unique keys defined to process an UPSERT operation. You may want to perform a direct INSERT operation.`);let f=u.find(m=>m.find(d=>p.find(y=>oe(d.value,y.value,d.delim||y.delim))))||u[0];c.conflict_target={nodeName:l.PGConflictTarget.NODE_NAME,index_list:f.map(m=>({nodeName:l.PGConflictTargetIndexSpec.NODE_NAME,column_name:m}))}}return super.finalizePayloadJSON({...e,nodeName:Me.NODE_NAME,conflict_handling_clause:c},t,s,r)}};var ia={};ve(ia,{BasicSelectStmt:()=>$e,CompleteSelectStmt:()=>Gs,CompositeSelectStmt:()=>Ws,DerivedQuery:()=>Ge,DistinctClause:()=>fs,ForClause:()=>ys,FromClause:()=>ms,FromItem:()=>et,FromItemAlias:()=>Ls,GroupByClause:()=>ds,GroupingElement:()=>_s,HavingClause:()=>hs,JoinClause:()=>xs,LimitClause:()=>gs,OffsetClause:()=>Ns,OnClause:()=>Es,OrderByClause:()=>Ss,OrderElement:()=>As,PGFetchClause:()=>Os,PGOrderOperator:()=>Rs,PartitionByClause:()=>Ts,SRFExpr1:()=>js,SRFExpr2:()=>Us,SRFExpr3:()=>$s,SRFExpr4:()=>Bs,SRFExprDDL1:()=>Js,SRFExprDDL2:()=>qs,SelectItem:()=>Ms,SelectItemAlias:()=>Ps,SelectList:()=>Xe,SelectStmt:()=>Pe,TableStmt:()=>Ys,UsingClause:()=>vs,ValuesTableLiteral:()=>Fs,WhereClause:()=>Cs,WindowClause:()=>bs,WindowDeclaration:()=>ws,WindowFrameBound:()=>Is,WindowFrameSpec:()=>ks,WindowSpec:()=>Ds});var fs=class extends h{static get syntaxRules(){return{syntaxes:[{dialect:"postgres",syntax:[{type:"keyword",value:"DISTINCT"},{type:"keyword",value:"ON"},{type:"paren_block",syntax:{type:"Expr",as:"pg_distinct_on_list",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0}}]},{type:"keyword",as:"all_or_distinct",value:["ALL","DISTINCT"]}]}}allOrDistinct(){return this._get("all_or_distinct")}pgDistinctOnList(){return this._get("pg_distinct_on_list")}};var ys=class extends h{static get syntaxRules(){return[{type:"keyword",value:"FOR"},{optional:!0,dialect:"postgres",syntaxes:[[{type:"keyword",as:"pg_no_key_kw",value:"NO",booleanfy:!0},{type:"keyword",value:"KEY",if:"pg_no_key_kw",assert:!0}],{type:"keyword",as:"pg_key_kw",value:"KEY",booleanfy:!0}]},{type:"keyword",as:"intent_kw",value:["UPDATE","SHARE"],assert:!0},{optional:!0,syntax:[{type:"keyword",value:"OF"},{type:"TableRef2",as:"table_names",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0}]},{optional:!0,syntaxes:[[{type:"keyword",as:"skip_locked_kw",value:"SKIP",booleanfy:!0},{type:"keyword",value:"LOCKED",assert:!0}],{type:"keyword",as:"nowait_kw",value:"NOWAIT",booleanfy:!0},{dialect:"mysql",syntax:[{type:"keyword",as:"my_lock_in_share_mode",value:"LOCK",booleanfy:!0},{type:"operator",value:"IN",assert:!0},{type:"keyword",value:"SHARE",assert:!0},{type:"keyword",value:"MODE",assert:!0}]}]}]}intentKW(){return this._get("intent_kw")}tableNames(){return this._get("table_names")}skipLockedKW(){return this._get("skip_locked_kw")}nowaitKW(){return this._get("nowait_kw")}pgKeyKW(){return this._get("pg_key_kw")}pgNoKeyKW(){return this._get("pg_no_key_kw")}myLockInShareMode(){return this._get("my_lock_in_share_mode")}};var ms=class extends b{static get syntaxRules(){return[{type:"keyword",value:"FROM"},{type:"FromItem",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0}]}};var ds=class extends b{static get syntaxRules(){return[{type:"keyword",value:"GROUP"},{type:"keyword",value:"BY",assert:!0},{type:"keyword",as:"all_or_distinct",value:["ALL","DISTINCT"],optional:!0},{type:"GroupingElement",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2},{optional:!0,autoIndent:!0,syntax:[{type:"keyword",as:"with_rollup",value:"WITH",booleanfy:!0},{type:"keyword",value:"ROLLUP",assert:!0}]}]}allOrDistinct(){return this._get("all_or_distinct")}withRollup(){return this._get("with_rollup")}};var _s=class extends h{static get syntaxRules(){return{syntaxes:[[{type:"keyword",value:"GROUPING SETS"},{type:"paren_block",syntax:{type:"GroupingElement",as:"grouping_sets",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2},autoIndent:!0}],[{type:"keyword",value:"ROLLUP"},{type:"RowConstructor",as:"rollup_set",assert:!0}],[{type:"keyword",value:"CUBE"},{type:"RowConstructor",as:"cube_set",assert:!0}],{type:["Expr","ParenExpr"],as:"expr"}]}}groupingSets(){return this._get("grouping_sets")}rollupSet(){return this._get("rollup_set")}cubeSet(){return this._get("cube_set")}expr(){return this._get("expr")}};var hs=class extends h{static get syntaxRules(){return[{type:"keyword",value:"HAVING"},{type:"Expr",as:"expr",assert:!0}]}static get syntaxPriority(){return-1}expr(){return this._get("expr")}};var et=class extends Z(h){static get syntaxRules(){let e={type:"punctuation",value:","};return{syntaxes:[[{type:"keyword",as:"lateral_kw",value:"LATERAL",booleanfy:!0,optional:!0},{type:"SRFExpr1",as:"expr"}],[{type:"keyword",as:"lateral_kw",value:"LATERAL",booleanfy:!0,optional:!0},{type:["SRFExpr2","SRFExpr4"],as:"expr"},{type:"FromItemAlias",as:"alias",optional:!0}],[{type:"keyword",as:"lateral_kw",value:"LATERAL",booleanfy:!0,optional:!0},{type:["DerivedQuery","ValuesTableLiteral"],as:"expr",dialect:"postgres"},{type:"DerivedQuery",as:"expr",dialect:"mysql"},{type:"FromItemAlias",as:"alias",optional:!0}],[{type:"keyword",as:"pg_only_kw",value:"ONLY",optional:!0,dialect:"postgres"},{type:["TableRef1","TableRef2"],as:"expr"},{type:"operator",as:"pg_star_ref",value:"*",booleanfy:!0,optional:!0,dialect:"postgres"},{type:"FromItemAlias",as:"alias",optional:!0},{...{optional:!0,dialect:"postgres",syntax:[{type:"keyword",value:"TABLESAMPLE"},{syntaxes:[[{type:"keyword",as:"pg_sampling_method",value:["BERNOULLI","SYSTEM"]},{type:"paren_block",syntax:{type:"Expr",as:"pg_sampling_arguments",arity:1,itemSeparator:e,assert:!0}}],[{type:"identifier",as:"pg_sampling_method"},{type:"paren_block",syntax:{type:"Expr",as:"pg_sampling_arguments",arity:1/0,itemSeparator:e,assert:!0}}]],assert:!0},{optional:!0,syntax:[{type:"keyword",value:"REPEATABLE"},{type:"paren_block",syntax:{type:"Expr",as:"pg_repeatable_seed"},assert:!0}]}]}}]]}}lateralKW(){return this._get("lateral_kw")}expr(){return this._get("expr")}alias(){return this._get("alias")}pgOnlyKW(){return this._get("pg_only_kw")}pgStarRef(){return this._get("pg_star_ref")}pgSamplingMethod(){return this._get("pg_sampling_method")}pgSamplingArguments(){return this._get("pg_sampling_arguments")}pgRepeatableSeed(){return this._get("pg_repeatable_seed")}deriveAlias(){let e;if(this.alias()?.value()?e={as_kw:!0,value:this.alias().value(),delim:this.alias()._get("delim")}:this.expr()instanceof l.TableRef1||this.expr()instanceof l.TableRef2?e={as_kw:!0,value:this.expr().value(),delim:this.expr()._get("delim")}:this.expr()instanceof l.SRFExpr1&&this.expr().qualif()instanceof l.SRFExprDDL2&&(e={as_kw:!0,value:this.expr().qualif().alias().value(),delim:this.expr().qualif().alias()._get("delim")}),e)return l.FromItemAlias.fromJSON(e)}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);if(e.deSugar){let n=r.alias||this.deriveAlias()?.jsonfy(),a=n?.value&&{nodeName:l.Identifier.NODE_NAME,value:n.value,delim:n.delim},p=r.expr.result_schema;if(p instanceof l.TableSchema?p=p.clone({renameTo:a}):a&&(p=l.TableSchema.fromJSON({name:a,entries:p?.entries().map(u=>u.jsonfy())||[]})),r.alias?.columns?.length){if(r.alias.columns.length!==p.length)throw new SyntaxError(`[${this}] Number of column aliases must match number of result columns.`);p=p.clone({},new ne((u,f,m)=>typeof m=="number"&&u.parentNode===p?u instanceof l.ColumnSchema?u.jsonfy({renameTo:r.alias.columns[m]}):{...u.jsonfy(),nodeName:l.ColumnSchema.NODE_NAME,name:r.alias.columns[m]}:f()))}t.statementContext.artifacts.get("tableSchemas").add({type:this.joinType?.()||"dql",lateral:this.lateralKW(),resultSchema:p});let c=!(this.expr()instanceof l.SRFExpr1)&&(Number(e.deSugar)>2||Number(e.deSugar)>1&&(this.parentNode?.length||0)>1)&&n||r.alias;r={...r,alias:c,result_schema:p}}return r}};var xs=class extends et{static get syntaxRules(){return{syntaxes:[[{type:"keyword",as:"join_type",value:"CROSS"},{type:"keyword",value:"JOIN",assert:!0},...[].concat(super.syntaxRules)],[{type:"keyword",as:"natural_kw",value:"NATURAL",booleanfy:!0,optional:!0},{optional:!0,syntaxes:[{type:"keyword",as:"join_type",value:"INNER"},[{type:"keyword",as:"join_type",value:["LEFT","RIGHT","FULL"],dialect:"postgres"},{type:"keyword",as:"join_type",value:["LEFT","RIGHT"],dialect:"mysql"},{type:"keyword",as:"outer_kw",value:"OUTER",booleanfy:!0,optional:!0}]]},{type:"keyword",value:"JOIN"},...[].concat(super.syntaxRules),{type:["OnClause","UsingClause"],as:"condition_clause",if:"!natural_kw",assert:!0,autoIndent:!0}]]}}naturalKW(){return this._get("natural_kw")}joinType(){return this._get("join_type")}outerKW(){return this._get("outer_kw")}conditionClause(){return this._get("condition_clause")}jsonfy(e={},t=null,s=null){let r;e.deSugar&&(t=new ne((a,p,c)=>{if(c==="condition_clause")r=p;else return p()},t,this.statementNode));let n=super.jsonfy(e,t,s);return r&&(n={...n,condition_clause:r()}),n}};var gs=class extends h{static get syntaxRules(){return[{type:"keyword",value:"LIMIT"},{dialect:"mysql",syntax:[{optional:!0,syntax:[{type:"Expr",as:"my_offset"},{type:"punctuation",value:",",autoSpacing:!1}]},{type:"Expr",as:"expr",assert:!0}]},{dialect:"postgres",syntaxes:[{type:"keyword",as:"pg_all_kw",value:"ALL"},{type:"Expr",as:"expr",assert:!0}]}]}expr(){return this._get("expr")}pgAllKW(){return this._get("pg_all_kw")}myOffset(){return this._get("my_offset")}};var Ns=class extends h{static get syntaxRules(){return[{type:"keyword",value:"OFFSET"},{type:"Expr",as:"expr",assert:!0},{type:"keyword",as:"pg_row_kw",value:["ROW","ROWS"],optional:!0,dialect:"postgres"}]}expr(){return this._get("expr")}pgRowKW(){return this._get("pg_row_kw")}};var Es=class extends h{static get syntaxRules(){return[{type:"keyword",value:"ON"},{type:"Expr",as:"expr",assert:!0}]}expr(){return this._get("expr")}};var Ss=class extends b{static get syntaxRules(){return[{type:"keyword",value:"ORDER"},{type:"keyword",value:"BY",assert:!0},{type:"OrderElement",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2},{optional:!0,autoIndent:!0,syntax:[{type:"keyword",as:"with_rollup",value:"WITH",booleanfy:!0},{type:"keyword",value:"ROLLUP",assert:!0}]}]}withRollup(){return this._get("with_rollup")}};var As=class extends h{static get syntaxRules(){return[{type:"Expr",as:"expr"},{optional:!0,syntaxes:[{type:"keyword",value:["ASC","DESC"],as:"dir"},{type:"PGOrderOperator",as:"dir"}]},{optional:!0,syntax:[{type:"keyword",value:"NULLS"},{type:"keyword",as:"nulls_spec",value:["FIRST","LAST"],assert:!0}]}]}expr(){return this._get("expr")}dir(){return this._get("dir")}nullsSpec(){return this._get("nulls_spec")}};var Ts=class extends b{static get syntaxRules(){return[{type:"keyword",value:"PARTITION"},{type:"keyword",value:"BY",assert:!0},{type:"Expr",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2}]}};var Os=class extends h{static get syntaxRules(){return{dialect:"postgres",syntax:[{type:"keyword",value:"FETCH"},{type:"keyword",as:"rel_kw",value:["FIRST","NEXT"]},{type:"Expr",as:"expr",optional:!0},{type:"keyword",as:"row_kw",value:["ROW","ROWS"],assert:!0},{syntaxes:[{type:"keyword",value:"ONLY"},[{type:"keyword",as:"with_ties",value:"WITH"},{type:"keyword",value:"TIES",assert:!0}]]}]}}relKW(){return this._get("rel_kw")}expr(){return this._get("expr")}rowKW(){return this._get("row_kw")}withTies(){return this._get("with_ties")}};var Rs=class extends h{static get syntaxRules(){return{dialect:"postgres",syntax:[{type:"keyword",value:"USING"},{type:"operator",as:".",assert:!0}]}}value(){return this._get("value")}};var vs=class extends h{static get syntaxRules(){return[{type:"keyword",value:"USING"},{type:["ColumnRef2","ColumnsConstructor"],as:"column",assert:!0}]}column(){return this._get("column")}};var Cs=class extends h{static get syntaxRules(){return[{type:"keyword",value:"WHERE"},{type:"Expr",as:"expr",assert:!0}]}expr(){return this._get("expr")}};var bs=class extends b{static get syntaxRules(){return[{type:"keyword",value:"WINDOW"},{type:"WindowDeclaration",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2}]}};var ws=class extends h{static get syntaxRules(){return[{type:"Identifier",as:"name"},{type:"keyword",value:"AS"},{type:"WindowSpec",as:"spec",assert:!0}]}name(){return this._get("name")}spec(){return this._get("spec")}};var ks=class extends h{static get syntaxRules(){let e={type:"operator",value:"AND"};return[{type:"keyword",as:"specifier",value:["ROWS","RANGE","GROUPS"]},{syntaxes:[[{type:"operator",as:"with_between_clause",value:"BETWEEN",booleanfy:!0},{type:"WindowFrameBound",as:"bounds",arity:2,itemSeparator:e,assert:!0}],{type:"WindowFrameBound",as:"bounds",arity:1,itemSeparator:e,assert:!0}]},{optional:!0,syntax:[{type:"keyword",value:"EXCLUDE"},{type:"keyword",as:"exclusion",value:["CURRENT ROW","GROUP","TIES","NO OTHERS"],assert:!0}]}]}specifier(){return this._get("specifier")}withBetweenClause(){return this._get("with_between_clause")}bounds(){return this._get("bounds")}exclusion(){return this._get("exclusion")}};var Is=class extends h{static get syntaxRules(){return{syntaxes:[{type:"keyword",as:"specifier",value:"CURRENT ROW"},[{type:"keyword",as:"specifier",value:"UNBOUNDED"},{type:"keyword",as:"dir",value:["PRECEDING","FOLLOWING"]}],[{type:"number_literal",as:"specifier"},{type:"keyword",as:"dir",value:["PRECEDING","FOLLOWING"]}],[{type:"Expr",as:"specifier"},{type:"keyword",as:"dir",value:["PRECEDING","FOLLOWING"]}]]}}specifier(){return this._get("specifier")}dir(){return this._get("dir")}};var Ds=class extends h{static get syntaxRules(){return{type:"paren_block",syntax:[{type:"WindowRef",as:"super_window",optional:!0},{type:"PartitionByClause",as:"partition_by_clause",optional:!0,autoIndent:!0},{type:"OrderByClause",as:"order_by_clause",optional:!0,autoIndent:!0},{type:"WindowFrameSpec",as:"frame_spec",optional:!0,autoIndent:!0}],autoIndent:!0,autoIndentAdjust:-1}}superWindow(){return this._get("super_window")}partitionByClause(){return this._get("partition_by_clause")}orderByClause(){return this._get("order_by_clause")}frameSpec(){return this._get("frame_spec")}};var Ls=class extends ie{static get syntaxRules(){let e={type:"punctuation",value:","};return[{syntaxes:[{...[].concat(super.syntaxRules)[0]},[{type:"keyword",as:"as_kw",value:"AS",booleanfy:!0},{...[].concat(super.syntaxRules)[0],assert:!0}]]},{type:"paren_block",syntax:{type:"Identifier",as:"columns",arity:{min:1},itemSeparator:e,assert:!0},if:"value",optional:!0,optionalParens:!0}]}asKW(){return this._get("as_kw")}columns(){return this._get("columns")}};var Ms=class o extends Z(h){static get syntaxRules(){return[{type:["Expr","ColumnRef0","MYVarAssignmentExpr"],as:"expr"},{type:"SelectItemAlias",as:"alias",optional:!0}]}expr(){return this._get("expr")}alias(){return this._get("alias")}deriveAlias(){let e=this.alias()?.jsonfy(),t=this.expr();if(!(t instanceof l.ColumnRef0)){if(t instanceof l.RowConstructor&&(t=t.exprUnwrapped()),(t instanceof l.CastExpr||t instanceof l.PGCastExpr2)&&(t=t.expr()),!e)if(t instanceof l.ColumnRef1)e={as_kw:!0,value:t.value(),delim:t._get("delim")};else if(t instanceof l.LQDeepRef1&&t.endpoint()instanceof l.ColumnRef2){let s=t.endpoint();e={as_kw:!0,value:s.value(),delim:s._get("delim")}}else{let s=this.options.dialect==="postgres";t instanceof l.CallExpr&&s&&(e={as_kw:!0,value:t.name().toLowerCase()})}return l.SelectItemAlias.fromJSON(e)}}jsonfy(e={},t=null,s=null){if(e.deSugar){let r=this.deriveAlias(),n,a=r&&(t?t.transform(r,(y=e)=>r.jsonfy(y),"alias",e):r.jsonfy(e));a?.is_aggr&&({is_aggr:n,...a}=a);let p=this.expr(),c;n&&!(p instanceof l.LQDeepRef1)?c=(y=e,N=t)=>({nodeName:l.AggrCallExpr.NODE_NAME,name:(e.toDialect||this.options.dialect)==="mysql"?"JSON_ARRAYAGG":"JSON_AGG",arguments:[p.jsonfy(y,N,s)]}):c=(y=e,N=t)=>p.jsonfy(y,N,s);let u=t?t.transform(p,c,"expr",{...e,asAggr:n}):c(),f=a&&{nodeName:l.Identifier.NODE_NAME,value:a.value,delim:a.delim}||{nodeName:l.Identifier.NODE_NAME,value:this.options.dialect==="postgres"?"?column?":p.stringify()},m=u.result_schema;if(m instanceof l.ColumnSchema){let y=m.parentNode;m=m.clone({renameTo:f}),y._adoptNodes(m)}else!(p instanceof l.LQDeepRef1)&&!(p instanceof l.ColumnRef0)&&(m=l.ColumnSchema.fromJSON({name:f,data_type:this.expr().dataType().jsonfy()}),p._adoptNodes(m));let d=(n||Number(e.deSugar)>2||Number(e.deSugar)>1&&(this.parentNode?.entries().length||0)>1)&&a||this.alias()?.jsonfy();return{nodeName:o.NODE_NAME,expr:u,alias:d,result_schema:m}}return super.jsonfy(e,t,s)}};var Ps=class extends ie{static get syntaxRules(){return[{syntaxes:[{...[].concat(super.syntaxRules)[0]},[{type:"keyword",as:"as_kw",value:"AS",booleanfy:!0},{...[].concat(super.syntaxRules)[0],assert:!0}]]},{type:"AggrNotation",as:"is_aggr",autoSpacing:!1,optional:!0}]}asKW(){return this._get("as_kw")}isAggr(){return this._get("is_aggr")}};var js=class extends Z(h){static get syntaxRules(){return[{type:"CallExpr",as:"call_expr"},{type:["SRFExprDDL1","SRFExprDDL2"],as:"qualif"}]}callExpr(){return this._get("call_expr")}qualif(){return this._get("qualif")}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);if(e.deSugar){let n=r.qualif?.column_defs||[],a=r.qualif?.alias?l.TableSchema.fromJSON({name:r.qualif.alias,entries:n}):l.JSONSchema.fromJSON({entries:n});r={...r,result_schema:a}}return r}};var Us=class extends Z(h){static get syntaxRules(){return[{type:"CallExpr",as:"call_expr"},{optional:!0,syntax:[{type:"keyword",as:"with_ordinality",value:"WITH",booleanfy:!0},{type:"keyword",value:"ORDINALITY",assert:!0}]}]}callExpr(){return this._get("call_expr")}withOrdinality(){return this._get("with_ordinality")}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);if(e.deSugar){let n,a;r.with_ordinality&&(a=l.ColumnSchema.fromJSON({name:{nodeName:l.Identifier.NODE_NAME,value:"ordinality"},data_type:{nodeName:l.DataType.NODE_NAME,value:"INT"}}));let p={nodeName:l.Identifier.NODE_NAME,value:r.call_expr.name};if(r.call_expr?.result_schema)if(n=r.call_expr.result_schema,n instanceof l.TableSchema||n instanceof l.JSONSchema)if(a){let c=n.jsonfy();n=n.constructor.fromJSON({name:p,...c,entries:[...c.entries,a]})}else n=n.clone();else n=l.JSONSchema.fromJSON({entries:[n.jsonfy()].concat(a||[])});else n=l.JSONSchema.fromJSON({entries:[{nodeName:l.ColumnSchema.NODE_NAME,name:p,data_type:this.callExpr().dataType().jsonfy()}].concat(a||[])});r={...r,result_schema:n}}return r}};var $s=class extends Z(h){static get syntaxRules(){return[{type:"CallExpr",as:"call_expr"},{type:"SRFExprDDL1",as:"qualif",optional:!0}]}callExpr(){return this._get("call_expr")}qualif(){return this._get("qualif")}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);if(e.deSugar){let n;if(r.qualif?.column_defs.length)n=l.JSONSchema.fromJSON({entries:r.qualif.column_defs});else if(r.call_expr?.result_schema){let a=r.call_expr.result_schema;n=a instanceof l.TableSchema||a instanceof l.JSONSchema?a.clone():l.JSONSchema.fromJSON({entries:[a.jsonfy()]})}else{let a={nodeName:l.Identifier.NODE_NAME,value:r.call_expr.name};n=l.JSONSchema.fromJSON({entries:[{nodeName:l.ColumnSchema.NODE_NAME,name:a,data_type:this.callExpr().dataType().jsonfy()}]})}r={...r,result_schema:n}}return r}};var Bs=class extends Z(b){static get syntaxRules(){return[{type:"keyword",value:"ROWS"},{type:"keyword",value:"FROM"},{type:"paren_block",syntax:{type:"SRFExpr3",as:"entries",arity:{min:1},itemSeparator:{type:"punctuation",value:","},assert:!0,autoIndent:2},autoIndent:!0},{optional:!0,syntax:[{type:"keyword",as:"with_ordinality",value:"WITH",booleanfy:!0},{type:"keyword",value:"ORDINALITY",assert:!0}]}]}static get syntaxPriority(){return-1}withOrdinality(){return this._get("with_ordinality")}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);if(e.deSugar){let n;r.with_ordinality&&(n=l.ColumnSchema.fromJSON({name:{nodeName:l.Identifier.NODE_NAME,value:"ordinality"},data_type:{nodeName:l.DataType.NODE_NAME,value:"INT"}}));let a=l.JSONSchema.fromJSON({entries:[...r.entries.reduce((p,c)=>{let u=c.result_schema.jsonfy().entries;return p.concat(u)},[])].concat(n||[])});r={...r,result_schema:a}}return r}};var Js=class extends h{static get syntaxRules(){return[{type:"keyword",value:"AS"},{type:"paren_block",syntax:{type:"ColumnSchema",as:"column_defs",arity:{min:1},itemSeparator:{type:"punctuation",value:","}}}]}asKW(){return this._get("as_kw")}alias(){return this._get("alias")}columnDefs(){return this._get("column_defs")}};var qs=class extends h{static get syntaxRules(){return[{syntaxes:[{type:"Identifier",as:"alias"},[{type:"keyword",value:"AS",as:"as_kw"},{type:"Identifier",as:"alias",assert:!0}]]},{type:"paren_block",syntax:{type:"ColumnSchema",as:"column_defs",arity:{min:1},itemSeparator:{type:"punctuation",value:","}}}]}alias(){return this._get("alias")}columnDefs(){return this._get("column_defs")}};var Fs=class extends ze{static get syntaxRules(){return{type:"paren_block",syntax:super.syntaxRules,autoIndent:!0}}};var Pe=class extends me{static get syntaxRules(){return{type:["CompleteSelectStmt","CompositeSelectStmt"],expression:!0}}static buildSyntaxRules(e=null){let t=(r=[])=>[{type:"keyword",value:"SELECT"},{type:"DistinctClause",as:"distinct_clause",optional:!0},{type:"SelectList",as:"select_list"},{optional:!0,syntax:[{type:"FromClause",as:"from_clause",autoSpacing:`
`},{type:"JoinClause",as:"join_clauses",arity:1/0,optional:!0,autoSpacing:`
`},{type:"MYPartitionClause",as:"my_partition_clause",optional:!0,autoSpacing:`
`},{type:"WhereClause",as:"where_clause",optional:!0,autoSpacing:`
`},{optional:!0,syntax:[{type:"GroupByClause",as:"group_by_clause",autoSpacing:`
`},{type:"HavingClause",as:"having_clause",optional:!0,autoSpacing:`
`}]},{type:"WindowClause",as:"window_clause",optional:!0,autoSpacing:`
`},...r],autoSpacing:`
`}],s=()=>[{type:"OrderByClause",as:"order_by_clause",optional:!0,autoSpacing:`
`},{type:"LimitClause",as:"limit_clause",optional:!0,autoSpacing:`
`},{type:"OffsetClause",as:"offset_clause",optional:!0,autoSpacing:`
`},{type:"PGFetchClause",as:"pg_fetch_clause",optional:!0,dialect:"postgres",autoSpacing:`
`},{type:"ForClause",as:"for_clause",optional:!0,autoSpacing:`
`}];return e===1?t():e===2?s():t(s())}dataType(){return l.DataType.fromJSON({value:"SET"})}};var $e=class extends Ze(Pe){static get syntaxRules(){return this.buildSyntaxRules(1)}static get syntaxPriority(){return-1}distinctClause(){return this._get("distinct_clause")}selectList(){return this._get("select_list")}fromClause(){return this._get("from_clause")}joinClauses(){return this._get("join_clauses")}whereClause(){return this._get("where_clause")}groupByClause(){return this._get("group_by_clause")}havingClause(){return this._get("having_clause")}windowClause(){return this._get("window_clause")}myPartitionClause(){return this._get("my_partition_clause")}get length(){return this.selectList()?.length??0}[Symbol.iterator](){return(this.selectList()||[])[Symbol.iterator]()}jsonfy(e={},t=null,s=null){if(!e.deSugar)return super.jsonfy(e,t,s);let r={select_list:null,group_by_clause:new Set,having_clause:new Set,order_by_clause:new Set};t=new ne((p,c,u)=>{if(p instanceof l.SelectList){r.select_list=c;return}return p instanceof l.GroupByClause||p instanceof l.HavingClause||p instanceof l.OrderByClause?c((f,m,d)=>{if((typeof d=="number"||d==="expr")&&f.parentNode===p){try{r[u].add(m())}catch(y){if(y instanceof Te)r[u].add(m);else throw y}return}return m()}):c()},t,this);let n=super.jsonfy(e,t,s),a=r.select_list();n=this.finalizeSelectorJSON(n,t,s,e),a=this.selectList().finalizeJSON(a,t,s,e),n={...n,select_list:a,result_schema:a.result_schema};for(let[p,c]of Object.entries(r)){if(p==="select_list"||!c.size)continue;let u=[];for(let f of c)typeof f=="function"&&(f=f()),u.push(f);p==="having_clause"?n={...n,[p]:u[0]}:p==="group_by_clause"&&(n={...n,[p]:{entries:u}})}return n}};var Gs=class extends $e{static get syntaxRules(){return this.buildSyntaxRules()}static get syntaxPriority(){return 99}orderByClause(){return this._get("order_by_clause")}offsetClause(){return this._get("offset_clause")}limitClause(){return this._get("limit_clause")}forClause(){return this._get("for_clause")}pgFetchClause(){return this._get("pg_fetch_clause")}static async parse(e,{left:t=void 0,minPrecedence:s=0,trail:r=[],...n}={}){if(t)return;let a=await this.toStream(e,n),p=await super.parse(a,{minPrecedence:s,trail:r,...n});if(await a.match("operator",["INTERSECT","UNION","EXCEPT"])){if(p.order_by_clause||p.offset_clause||p.limit_clause||p.for_clause){let c=a.current(),u=`[${this.NODE_NAME}] Unexpected ${c.type} token:${typeof c.value=="string"?` "${c.value}"`:""} at <line ${c.line}, column ${c.column}>`;throw new SyntaxError(u)}return $e.fromJSON({...p.jsonfy(),nodeName:void 0})}return p}};var Ws=class extends Pe{static get syntaxRules(){let e=["DerivedQuery","ValuesTableLiteral","ParenExpr","BasicSelectStmt","CallExpr"];return[{type:e,as:"left"},{type:"operator",as:"operator",value:["INTERSECT","UNION","EXCEPT"],autoSpacing:`
`},{type:"keyword",as:"all_or_distinct",value:["ALL","DISTINCT"],optional:!0},{type:e,as:"right",assert:!0,autoSpacing:`
`},...this.buildSyntaxRules(2)]}static get syntaxPriority(){return 100}left(){return this._get("left")}operator(){return this._get("operator")}allOrDistinct(){return this._get("all_or_distinct")}right(){return this._get("right")}orderByClause(){return this._get("order_by_clause")}offsetClause(){return this._get("offset_clause")}limitClause(){return this._get("limit_clause")}forClause(){return this._get("for_clause")}pgFetchClause(){return this._get("pg_fetch_clause")}get length(){return this.left()?.selectList()?.length??0}[Symbol.iterator](){return(this.left()?.selectList()||[])[Symbol.iterator]()}jsonfy(e={},t=null,s=null){let r=super.jsonfy(e,t,s);return{...r,result_schema:r.left?.result_schema}}};var Ys=class extends Ce{static get syntaxRules(){return[{type:"keyword",value:"TABLE"},{type:"keyword",as:"pg_only_kw",value:"ONLY",optional:!0,dialect:"postgres"},{type:"TableRef2",as:"table_ref",assert:!0},{type:"operator",as:"pg_star_ref",value:"*",booleanfy:!0,optional:!0,dialect:"postgres"}]}tableRef(){return this._get("table_ref")}pgOnlyKW(){return this._get("pg_only_kw")}pgStarRef(){return this._get("pg_star_ref")}querySchemas(){let e=this.tableRef(),t=registry.Identifier.fromJSON({value:e.value()}),s=e.resultSchema(transformer).clone({renameTo:t});return new Set([s])}};var la={};ve(la,{AggrNotation:()=>Ks,LQVersionSpec:()=>Hs});var Ks=class extends h{static get syntaxRules(){return{type:"bracket_block",syntax:{type:"Expr",as:"_",arity:0,assert:!0}}}static get syntaxPriority(){return-1}};var Hs=class extends h{static get syntaxRules(){return{type:"version_spec",as:"."}}static get syntaxPriority(){return-1}value(){return this._get("value")}};var ua={};ve(ua,{DataType:()=>Vs});var Vs=class extends h{static get syntaxRules(){return[{syntaxes:[{type:"data_type",as:"."},{type:"keyword",as:".",value:["SET"]}]},{type:"paren_block",syntax:{type:"Expr",as:"specificity",arity:1/0,itemSeparator:{type:"punctuation",value:","},assert:!0},optional:!0,optionalParens:!0,autoSpacing:!1},{type:"AggrNotation",as:"pg_is_aggr",autoSpacing:!1,optional:!0,dialect:"postgres"}]}value(){return this._get("value")}specificity(){return this._get("specificity")}pgIsAggr(){return this._get("pg_is_aggr")}};var Qs=class extends b{static get syntaxRules(){return{type:["JSONSchema","TableSchema","ColumnSchema","ColumnRef1"],as:"entries",arity:1/0}}};Object.assign(l,{...aa,...na,...oa,...ia,...xe,...la,...ua,JSONSchema:Qs});var pa=class extends b{static get _contentTypes(){return["SelectStmt","TableStmt","InsertStmt","UpsertStmt","UpdateStmt","DeleteStmt","MYSetStmt","CTE","CreateTableStmt"]}static get syntaxRules(){let e={type:"punctuation",value:";"};return{type:this._contentTypes,as:"entries",arity:1/0,itemSeparator:e,autoSpacing:`
`}}static async parse(e,t={}){let s=await this.toStream(e,t),r=await super.parse(s,t);if(!s.done&&s.current()){let n=s.current(),a=`[${this.NODE_NAME}] Unexpected ${n.type} token:${typeof n.value=="string"?` "${n.value}"`:""} at <line ${n.line}, column ${n.column}>`;throw new SyntaxError(a)}return r}stringify(e={}){return`${super.stringify(e)};`}};})();
//# sourceMappingURL=main.js.map
