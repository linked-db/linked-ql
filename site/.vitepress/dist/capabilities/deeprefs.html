<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DeepRefs | LinkedQL</title>
    <meta name="description" content="A modern take on SQL and SQL databases — with reactivity, versioning, and more.">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.DxeyQAKk.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.BuoupY3R.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.CDUit8FX.js">
    <link rel="modulepreload" href="/assets/chunks/framework.B-XtCDNB.js">
    <link rel="modulepreload" href="/assets/capabilities_deeprefs.md.CYOx2SXL.lean.js">
    <meta name="theme-color" content="gold">
    <script id="check-dark-mode">document.documentElement.classList.add("dark");</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/img/brand/linked-ql-logo.png" height="140" alt data-v-8426fc1a><!--]--><!----><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/overview" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>What is LinkedQL</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/capabilities" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Capabilities</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Docs</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/flashql" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>FlashQL</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/engineering/realtime-engine" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Engineering</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/linked-db/linked-ql" target="_blank" rel="noreferrer" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Star on GitHub</span><!--]--></a><!--]--><!--]--></nav><!----><!----><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/linked-db/linked-ql" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><!----><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/linked-db/linked-ql" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Overview</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/overview" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>What is LinkedQL</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Docs</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Getting Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/setup" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Dialects & Clients</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/query-api" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Query Interface</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Capabilities</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/capabilities" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Capabilities Overview</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/capabilities/deeprefs" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>DeepRefs</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/capabilities/json-literals" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>JSON Literals</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/capabilities/upsert" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>UPSERT</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/capabilities/realtime-sql" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Realtime SQL</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>FlashQL</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/flashql" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>FlashQL Overview</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/flashql/foreign-io" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Federation & Sync</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/flashql/lang" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Language Reference</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Engineering</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/engineering/realtime-engine" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Realtime Engine</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _capabilities_deeprefs" data-v-39a288b8><div><h1 id="deeprefs" tabindex="-1">DeepRefs <a class="header-anchor" href="#deeprefs" aria-label="Permalink to &quot;DeepRefs&quot;">​</a></h1><p><em>Follow relationships using simple arrow notation: <code>a ~&gt; b</code>. Insert or update nested structures using same notation</em></p><p>SQL schemas already describe relationships — <code>FOREIGN KEY (author) REFERENCES users (id)</code></p><p>DeepRefs let you <strong>traverse those foreign-key declarations directly</strong>, inline, without writing a join.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> name</span><span style="color:#F78C6C;"> FROM</span><span style="color:#BABED8;"> posts</span></span></code></pre></div><p>If you’ve declared any relationship, you can traverse them directly. LinkedQL automatically handles the mechanics and resolves them all from the schema catalog.</p><h2 id="general-syntax" tabindex="-1">General Syntax <a class="header-anchor" href="#general-syntax" aria-label="Permalink to &quot;General Syntax&quot;">​</a></h2><p>DeepRefs are path expressions. You use:</p><ul><li><strong>DeepRef (<code>~&gt;</code>)</strong> to walk <em>forward</em> along a foreign-key path (from the current row <em>A</em> to the referenced row <em>B</em>).</li><li><strong>BackRef (<code>&lt;~</code>)</strong> to walk <em>backward</em> along the same path (from rows <em>B</em> that reference the current row <em>A</em>).</li></ul><p>Essentially, DeepRefs and BackRefs mirror each other — one walks forward, the other walks back.</p><p><strong><em>Example</em></strong>:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#BABED8;">  p.id,</span></span>
<span class="line"><span style="color:#BABED8;">  p.title,</span></span>
<span class="line"><span style="color:#BABED8;">  p.author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> name</span><span style="color:#F78C6C;"> AS</span><span style="color:#BABED8;"> author_name</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p;</span></span></code></pre></div><p>The <code>~&gt;</code> arrow means:</p><blockquote><p>“From this post, follow the <code>author</code> foreign key to the <code>users</code> table, then take the <code>name</code> column.”</p></blockquote><h3 id="quick-cheatsheet" tabindex="-1">Quick Cheatsheet <a class="header-anchor" href="#quick-cheatsheet" aria-label="Permalink to &quot;Quick Cheatsheet&quot;">​</a></h3><table tabindex="0"><thead><tr><th style="text-align:left;">Type</th><th style="text-align:left;">Syntax</th><th style="text-align:left;">Direction</th><th style="text-align:left;">Meaning</th><th style="text-align:left;">Example</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>DeepRef</strong></td><td style="text-align:left;"><code>fk ~&gt; col</code></td><td style="text-align:left;">forward</td><td style="text-align:left;">From the current row (A), follow the foreign key <code>fk</code> to the referenced row (B) and read <code>B.col</code>.</td><td style="text-align:left;"><code>post.author ~&gt; name</code></td></tr><tr><td style="text-align:left;"><strong>Multi-hop DeepRef</strong></td><td style="text-align:left;"><code>fk ~&gt; fk2 ~&gt; col</code></td><td style="text-align:left;">forward depth</td><td style="text-align:left;">Follow multiple foreign key hops: <code>A.fk → B.fk2 → C.col</code>.</td><td style="text-align:left;"><code>comment.post ~&gt; author ~&gt; email</code></td></tr><tr><td style="text-align:left;"><strong>BackRef</strong></td><td style="text-align:left;"><code>(fk &lt;~ T) ~&gt; col</code></td><td style="text-align:left;">backward</td><td style="text-align:left;">From the current row (A), find rows in table <code>T</code> whose foreign key <code>fk</code> points to A’s primary key; read their <code>col</code>.</td><td style="text-align:left;"><code>(author &lt;~ posts) ~&gt; title</code></td></tr><tr><td style="text-align:left;"><strong>Multi-hop BackRef</strong></td><td style="text-align:left;"><code>(fk &lt;~ fk2 &lt;~ T) ~&gt; col</code></td><td style="text-align:left;">backward depth</td><td style="text-align:left;">Walk backward through multiple foreign key hops.</td><td style="text-align:left;"><code>(author &lt;~ posts &lt;~ comments) ~&gt; text</code></td></tr></tbody></table><p><strong><em>Legend</em></strong>:</p><ul><li><strong>A</strong> — the <em>current row</em> (the table you’re selecting from)</li><li><strong>B, C</strong> — the rows reached by following arrows</li><li>Each <code>~&gt;</code> or <code>&lt;~</code> one foreign-key hop</li></ul><p><strong><em>Variants</em></strong>:</p><p>For BackRefs, a dot (<code>.</code>) may be used on the first outer hop:</p><table tabindex="0"><thead><tr><th style="text-align:left;">Formal</th><th style="text-align:left;">Shorthand</th></tr></thead><tbody><tr><td style="text-align:left;"><code>(author &lt;~ posts) ~&gt; title</code></td><td style="text-align:left;"><code>(author &lt;~ posts).title</code></td></tr><tr><td style="text-align:left;"><code>(author &lt;~ comments) ~&gt; post ~&gt; title</code></td><td style="text-align:left;"><code>(author &lt;~ comments).post ~&gt; title</code></td></tr></tbody></table><h2 id="deeprefs-in-context" tabindex="-1">DeepRefs in Context <a class="header-anchor" href="#deeprefs-in-context" aria-label="Permalink to &quot;DeepRefs in Context&quot;">​</a></h2><p>DeepRefs expose foreign-key relationships as <strong>first-class</strong> column references inside SQL.<br> They behave like columns — and work anywhere a column reference works.</p><ul><li><code>SELECT fk ~&gt; col FROM ...</code> (projection)</li><li><code>fk ~&gt; col + 2, LOWER(fk ~&gt; col)</code> (expressions)</li><li><code>SELECT/UPDATE/DELETE ... WHERE fk ~&gt; col = 1</code> (filtering)</li><li><code>SELECT ... ORDER BY fk ~&gt; col</code> (ordering)</li><li><code>UPDATE ... SET fk ~&gt; col = 2</code> (writes)</li><li><code>INSERT INTO ... (fk ~&gt; col) VALUES (...)</code> (writes) </li><li><code>INSERT INTO ... ON CONFLICT ... DO UPDATE SET fk ~&gt; col = 2</code> (conditional writes)</li><li><code>SELECT v.fk ~&gt; col FROM (SELECT fk) AS v</code> (derived queries)</li><li><code>FROM t1 LEFT JOIN LATERAL (SELECT t1.fk ~&gt; col)</code> (lateral joins)</li></ul><p>Essentially, wherever SQL expects a column, you can just as well drop a <em>ref</em> — a <em>DeepRef</em>.</p><h3 id="backref-binding" tabindex="-1">BackRef Binding <a class="header-anchor" href="#backref-binding" aria-label="Permalink to &quot;BackRef Binding&quot;">​</a></h3><p>When using BackRefs in queries involving multiple instances of the same table (such as self-joins), its left-hand binding may be ambiguous.</p><p>For example, in the self-join: <code>... FROM users AS u1 LEFT JOIN users AS u2 ...</code>, the left-hand binding of the BackRef <code>(author &lt;~ posts) ~&gt; title</code> would be ambiguous — potentially matching both <code>u1</code> and <code>u2</code>.</p><p>In these cases, you must explicitly specify the binding alias in the BackRef syntax to disambiguate: <code>((u1) author &lt;~ posts) ~&gt; title</code>.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> u1.id, ((u1) author </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">~ posts) ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> title</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> users </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u1 </span><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> users </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u2 </span><span style="color:#F78C6C;">ON</span><span style="color:#BABED8;"> u1.id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> u2.id</span></span></code></pre></div><p>Here, <code>((u1) author &lt;~ posts)</code> makes it clear that the BackRef binding to <code>u1</code> on the left-side for the foreign key traversal.</p><p>This explicit aliasing ensures that DeepRefs and BackRefs resolve correctly in complex queries with multiple table instances.</p><h2 id="projections" tabindex="-1">Projections <a class="header-anchor" href="#projections" aria-label="Permalink to &quot;Projections&quot;">​</a></h2><p>In addition to keeping queries short, consistent, and readable at any complexity, DeepRefs especially turn the query surface — the SELECT list — into a connected view of data.</p><p>Internally, these expand into <strong>LEFT JOIN</strong> expressions derived from the schema. Multi-hop chains become hierarchies of nested LEFT JOINs, preserving nullability and order at every step.</p><h3 id="projection-semantics" tabindex="-1">Projection Semantics <a class="header-anchor" href="#projection-semantics" aria-label="Permalink to &quot;Projection Semantics&quot;">​</a></h3><p>Inside a projection list, DeepRefs work exactly like columns — being <strong>first-class column references</strong>. Each yields values from the referenced row. And being syntactic sugar for LEFT JOINs, a <em>ref</em> may return <code>NULL</code> where no <em>right</em> rows match — as standard JOIN cardinality applies.</p><h4 id="deeprefs-1" tabindex="-1">DeepRefs (<code>~&gt;</code>) <a class="header-anchor" href="#deeprefs-1" aria-label="Permalink to &quot;DeepRefs (`~&gt;`)&quot;">​</a></h4><p>Forward <em>refs</em> model relationships that terminate on exactly one record:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> p.id, p.title, p.author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> name</span><span style="color:#F78C6C;"> AS</span><span style="color:#BABED8;"> author_name</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p;</span></span></code></pre></div><p>They project identically to their JOIN equivalents — producing at most one <em>right-hand</em> row per base record:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> p.id, p.title, u.name </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> author_name</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p</span></span>
<span class="line"><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> id, </span><span style="color:#F78C6C;">name</span><span style="color:#F78C6C;"> FROM</span><span style="color:#BABED8;"> users) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u</span></span>
<span class="line"><span style="color:#F78C6C;">    ON</span><span style="color:#BABED8;"> p.author </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> u.id;</span></span></code></pre></div><p>Because these work as LEFT JOINs, a post without an author simply produces <code>NULL</code> for <code>author_name</code>.</p><p>Longer chains preserve this same cardinality:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> c.id, c.text, c.post ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> email </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> post_author_email</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> comments </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> c;</span></span></code></pre></div><p>Those just follow the semantics of what they translate to — a hierarchy of LEFT JOINs:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> c.id, c.text, u.email </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> post_author_email</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> comments </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> c</span></span>
<span class="line"><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">  SELECT</span><span style="color:#BABED8;"> id, author </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#F78C6C;">  LEFT JOIN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> id, email </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> users) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u </span><span style="color:#F78C6C;">ON</span><span style="color:#BABED8;"> posts.author </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> u.id</span></span>
<span class="line"><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p </span><span style="color:#F78C6C;">ON</span><span style="color:#BABED8;"> c.post </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> p.id;</span></span></code></pre></div><h4 id="backrefs" tabindex="-1">BackRefs (<code>&lt;~</code>) <a class="header-anchor" href="#backrefs" aria-label="Permalink to &quot;BackRefs (`&lt;~`)&quot;">​</a></h4><p>Backward <em>refs</em> model relationships that may terminate on <em>multiple</em> records — rows in other tables that reference the current one through a foreign key:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> u.id, (author </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">~ posts) ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> title </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> post_title</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> users </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u;</span></span></code></pre></div><p>They project just identically as their JOIN equivalent — producing one output row for each matching <em>right-hand</em> record:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> u.id, p.title </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> post_title</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> users </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u</span></span>
<span class="line"><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> author, title </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p</span></span>
<span class="line"><span style="color:#F78C6C;">    ON</span><span style="color:#BABED8;"> p.author </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> u.id;</span></span></code></pre></div><p>Because these are also LEFT JOINs, a user without posts simply produces <code>NULL</code> for <code>post_title</code>.</p><p>When there are multiple matching <em>right-hand</em> rows, those naturally become additional output rows.<br> But those may also be aggregated into a single collection field:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> u.id, JSON_AGG((author </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">~ posts) ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> title) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> post_titles</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> users </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u</span></span>
<span class="line"><span style="color:#F78C6C;">GROUP BY</span><span style="color:#BABED8;"> u.id;</span></span></code></pre></div><p>That would equate to:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> u.id, JSON_AGG(p.title) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> post_titles</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> users </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u</span></span>
<span class="line"><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> author, title </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p</span></span>
<span class="line"><span style="color:#F78C6C;">    ON</span><span style="color:#BABED8;"> p.author </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> u.id</span></span>
<span class="line"><span style="color:#F78C6C;">GROUP BY</span><span style="color:#BABED8;"> u.id;</span></span></code></pre></div><p>Alternatively, you can use the <a href="./json-literals#aggregation-syntax">declarative aggregation syntax</a>: <code>AS col[]</code>.<br> This performs aggregation <strong>within</strong> the BackRef’s inner scope rather than the outer query, isolating the grouping semantics to that subrelation.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> u.id, (author </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">~ posts) ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> title </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> title[]</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> users </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u;</span></span></code></pre></div><p>Which expands to:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> u.id, p.title </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> title</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> users </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u</span></span>
<span class="line"><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">    SELECT</span><span style="color:#BABED8;"> author, JSON_AGG(title) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> title</span></span>
<span class="line"><span style="color:#F78C6C;">    FROM</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#F78C6C;">    GROUP BY</span><span style="color:#BABED8;"> author</span></span>
<span class="line"><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p</span></span>
<span class="line"><span style="color:#F78C6C;">    ON</span><span style="color:#BABED8;"> p.author </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> u.id;</span></span></code></pre></div><p>This gives you aggregated results without requiring the <code>GROUP BY</code> clause on the main query.</p><table tabindex="0"><thead><tr><th style="text-align:left;">Form</th><th style="text-align:left;">Aggregation Scope</th><th style="text-align:left;">Outer Query Grouped</th><th style="text-align:left;">Effect</th></tr></thead><tbody><tr><td style="text-align:left;"><code>JSON_AGG((fk &lt;~ T) ~&gt; col)</code></td><td style="text-align:left;">outer query</td><td style="text-align:left;">✅ yes</td><td style="text-align:left;">outer grouping semantics apply</td></tr><tr><td style="text-align:left;"><code>(fk &lt;~ T) ~&gt; col AS col[]</code></td><td style="text-align:left;">inner BackRef scope</td><td style="text-align:left;">❌ no</td><td style="text-align:left;">aggregation scoped to BackRef; outer query ungrouped</td></tr></tbody></table><p>For chained backward refs, those also just follow the semantics of what they translate to — a hierarchy of LEFT JOINs, preserving both nullability and join order across depth.</p><h3 id="structural-projection" tabindex="-1">Structural Projection <a class="header-anchor" href="#structural-projection" aria-label="Permalink to &quot;Structural Projection&quot;">​</a></h3><p>DeepRefs can project structures instead of scalars — returning object-shaped results from the referenced rows.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> p.id, p.title, p.author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> { id, </span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;"> } </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> author</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p;</span></span></code></pre></div><p>That would equate to:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> p.id, p.title,</span></span>
<span class="line"><span style="color:#BABED8;">    JSON_BUILD_OBJECT(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, u.id, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, u.name) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> author</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p</span></span>
<span class="line"><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> id, </span><span style="color:#F78C6C;">name</span><span style="color:#F78C6C;"> FROM</span><span style="color:#BABED8;"> users) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u</span></span>
<span class="line"><span style="color:#F78C6C;">    ON</span><span style="color:#BABED8;"> p.author </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> u.id;</span></span></code></pre></div><p>The special wildcard form: <code>{ * }</code> projects all columns from the referenced table:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> p.title, p.author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> { </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> } </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> author</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p;</span></span></code></pre></div><p>That would equate to:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> p.title,</span></span>
<span class="line"><span style="color:#BABED8;">    JSON_BUILD_OBJECT(</span></span>
<span class="line"><span style="color:#89DDFF;">      &#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, u.id,</span></span>
<span class="line"><span style="color:#89DDFF;">      &#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, u.name,</span></span>
<span class="line"><span style="color:#89DDFF;">      &#39;</span><span style="color:#C3E88D;">email</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, u.email</span></span>
<span class="line"><span style="color:#BABED8;">    ) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> author</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p</span></span>
<span class="line"><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> id, </span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">, email </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> users) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u</span></span>
<span class="line"><span style="color:#F78C6C;">    ON</span><span style="color:#BABED8;"> p.author </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> u.id;</span></span></code></pre></div><p>Nested structures compose naturally across relationships:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> c.id, c.text,</span></span>
<span class="line"><span style="color:#BABED8;">    c.post ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#BABED8;">      title,</span></span>
<span class="line"><span style="color:#BABED8;">      author: author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> { </span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">, email }</span></span>
<span class="line"><span style="color:#BABED8;">    } </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> post</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> comments </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> c;</span></span></code></pre></div><p>BackRefs can similarly project structures instead of scalars — returning object-shaped results from the referenced rows.</p><p>And as before, rows may be aggregated into a collection:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> u.id,</span></span>
<span class="line"><span style="color:#BABED8;">    (author </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">~ posts) ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> { id, title } </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> posts[]</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> users </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u;</span></span></code></pre></div><p>That would equate to:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> u.id, p.posts </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> users </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u</span></span>
<span class="line"><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">    SELECT</span><span style="color:#BABED8;"> author,</span></span>
<span class="line"><span style="color:#BABED8;">        JSON_AGG(JSON_BUILD_OBJECT(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, id, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">title</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, title)) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#F78C6C;">    FROM</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#F78C6C;">    GROUP BY</span><span style="color:#BABED8;"> author</span></span>
<span class="line"><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p</span></span>
<span class="line"><span style="color:#F78C6C;">    ON</span><span style="color:#BABED8;"> p.author </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> u.id;</span></span></code></pre></div><h3 id="projection-summary" tabindex="-1">Projection Summary <a class="header-anchor" href="#projection-summary" aria-label="Permalink to &quot;Projection Summary&quot;">​</a></h3><p>In the SELECT surface, DeepRefs can project:</p><ul><li><strong>scalars</strong> — individual referenced fields: <code>fk ~&gt; col</code></li><li><strong>structures</strong> — shapes of related columns: <code>fk ~&gt; { col1, col2 }</code></li><li><strong>collections</strong> — aggregated collections: <code>AS alias[]</code></li></ul><p>Also, each follows the same join semantics:</p><ul><li><strong>DeepRefs (<code>~&gt;</code>)</strong> yield one related record (and nullable)</li><li><strong>BackRefs (<code>&lt;~</code>)</strong> yield zero or more (and nullable, optionally aggregated)</li></ul><h2 id="expressions" tabindex="-1">Expressions <a class="header-anchor" href="#expressions" aria-label="Permalink to &quot;Expressions&quot;">​</a></h2><p>Because DeepRefs are <strong>first-class column references</strong>, they can participate in any expression exactly as ordinary columns do:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> fk ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> col </span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;"> 3</span><span style="color:#676E95;font-style:italic;">        -- same as (fk ~&gt; col) + 3</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> t;</span></span></code></pre></div><h3 id="composability" tabindex="-1">Composability <a class="header-anchor" href="#composability" aria-label="Permalink to &quot;Composability&quot;">​</a></h3><p>DeepRef operators — <code>~&gt;</code> and <code>&lt;~</code> — bind tighter than any other SQL operator (arithmetic, comparison, logical, etc.).<br> Thus, above, the <code>~&gt;</code> operator resolves before the <code>+</code> operator.</p><p>Essentially, DeepRefs hold together as indivisible units, just like ordinary columns. Thus, parentheses around them aren&#39;t necessary; but those are perfectly valid and can be used to clarify intent.</p><p>Each expression is evaluated on the <strong>dereferenced value</strong>.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> fk ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> value</span><span style="color:#89DDFF;"> +</span><span style="color:#F78C6C;"> 1</span><span style="color:#BABED8;">;                    </span><span style="color:#676E95;font-style:italic;">-- arithmetic</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#82AAFF;"> LOWER</span><span style="color:#BABED8;">(fk ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> name</span><span style="color:#BABED8;">);                  </span><span style="color:#676E95;font-style:italic;">-- function call</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#82AAFF;"> COALESCE</span><span style="color:#BABED8;">(fk ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> email, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">none</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">);      </span><span style="color:#676E95;font-style:italic;">-- null handling</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> fk ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> title ILIKE </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">%draft%</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">;        </span><span style="color:#676E95;font-style:italic;">-- predicate</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> fk ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> created_at </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> NOW</span><span style="color:#89DDFF;">()</span><span style="color:#89DDFF;"> -</span><span style="color:#BABED8;"> INTERVAL </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">7 days</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">; </span><span style="color:#676E95;font-style:italic;">-- comparison</span></span></code></pre></div><p>Because they can appear anywhere a column reference can, they can be used in filtering, ordering, and conditional contexts:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#89DDFF;"> *</span><span style="color:#F78C6C;"> FROM</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> email ILIKE </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">%@example.com</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F78C6C;">ORDER BY</span><span style="color:#BABED8;"> author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> name</span><span style="color:#BABED8;">;</span></span></code></pre></div><h3 id="structural-contexts" tabindex="-1">Structural Contexts <a class="header-anchor" href="#structural-contexts" aria-label="Permalink to &quot;Structural Contexts&quot;">​</a></h3><p>DeepRefs can terminate as composite record types in contexts where record types apply:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#89DDFF;"> *</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> $</span><span style="color:#F78C6C;">1</span><span style="color:#F78C6C;"> IN</span><span style="color:#BABED8;"> author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> (username, email);</span></span></code></pre></div><p>Since the left-hand side of the <code>IN</code> operator can be a tuple, we can also write:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#89DDFF;"> *</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> (id, </span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">IN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ada</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">);</span></span></code></pre></div><p>In each case, the tuple syntax applies to the dereferenced path, not to the path itself.</p><h3 id="expression-summary" tabindex="-1">Expression Summary <a class="header-anchor" href="#expression-summary" aria-label="Permalink to &quot;Expression Summary&quot;">​</a></h3><p>DeepRefs behave as atomic references in expressions:</p><ul><li><strong>Binding:</strong> <code>~&gt;</code> and <code>&lt;~</code> bind tighter than all other operators; no special parentheses required.</li><li><strong>Composability:</strong> usable in any expression or clause where a column works.</li><li><strong>Structural forms:</strong> may terminate as tuples in contexts expecting tuples.</li></ul><h2 id="mutations" tabindex="-1">Mutations <a class="header-anchor" href="#mutations" aria-label="Permalink to &quot;Mutations&quot;">​</a></h2><p><em>Declaratively write through relationships</em></p><p>DeepRefs aren’t limited to reading.<br> You can <strong>write through them</strong> — directly into related tables, using the same syntax you use to traverse them.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#BABED8;">  (title, author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> name</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">VALUES</span></span>
<span class="line"><span style="color:#BABED8;">  (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Intro to DeepRefs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">);</span></span></code></pre></div><p>This single statement creates both the post and its author in one operation.</p><p>Generally, the outer command defines what the statement does:</p><ul><li><code>INSERT</code> — create this structure.</li><li><code>UPSERT</code> — create or update this structure (update where rows exist).</li><li><code>UPDATE</code> — update this structure (ignore where rows don’t exist).</li></ul><p>The direction of traversal (<code>~&gt;</code> or <code>&lt;~</code>) determines the order of execution within the dependency graph.<br> The compiler builds and executes that graph automatically within one statement.</p><h3 id="deeprefs-2" tabindex="-1">DeepRefs (<code>~&gt;</code>) <a class="header-anchor" href="#deeprefs-2" aria-label="Permalink to &quot;DeepRefs (`~&gt;`)&quot;">​</a></h3><p>A DeepRef mutation implies a write through a foreign key — from the referencing row to the referenced one.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#BABED8;">  (title, author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> name</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">VALUES</span></span>
<span class="line"><span style="color:#BABED8;">  (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Intro to DeepRefs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">);</span></span></code></pre></div><p>This executes <strong>depth-first</strong>, with <strong>primary keys binding to foreign keys up the structure</strong>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>Command:</span></span>
<span class="line"><span>INSERT post → author → name  (create this structure)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Execution order:</span></span>
<span class="line"><span>  1. CREATE user (name)</span></span>
<span class="line"><span>  2. CREATE post (linked to user.id)</span></span></code></pre></div><p>That expands conceptually to:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> inserted_authors </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">  INSERT INTO</span><span style="color:#BABED8;"> users (</span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">  VALUES</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  RETURNING id</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> posts (title, author)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Intro to DeepRefs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, id </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> inserted_authors;</span></span></code></pre></div><p>Refs spanning multiple columns take composite values:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#BABED8;">  (title, author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">, email))</span></span>
<span class="line"><span style="color:#F78C6C;">VALUES</span></span>
<span class="line"><span style="color:#BABED8;">  (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Intro to DeepRefs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, </span><span style="color:#F78C6C;">ROW</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ada@example.com</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">));</span></span></code></pre></div><p>Semantics and execution order remain the same.</p><h3 id="backrefs-1" tabindex="-1">BackRefs (<code>&lt;~</code>) <a class="header-anchor" href="#backrefs-1" aria-label="Permalink to &quot;BackRefs (`&lt;~`)&quot;">​</a></h3><p>A BackRef mutation traverses in the opposite direction — from a referenced row to its dependents.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> users</span></span>
<span class="line"><span style="color:#BABED8;">  (</span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">, (author </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">~ posts) ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> title)</span></span>
<span class="line"><span style="color:#F78C6C;">VALUES</span></span>
<span class="line"><span style="color:#BABED8;">  (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Intro to DeepRefs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">);</span></span></code></pre></div><p>This executes depth-first, again, but reversed in direction — with parent primary keys binding to foreign keys down the structure:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>Command:</span></span>
<span class="line"><span>INSERT user ← post → title  (create this structure)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Execution order:</span></span>
<span class="line"><span>  1. CREATE user</span></span>
<span class="line"><span>  2. CREATE post (title)  (linked to user.id)</span></span></code></pre></div><p>That expands conceptually to:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> new_user </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">  INSERT INTO</span><span style="color:#BABED8;"> users (</span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">  VALUES</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  RETURNING id</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> posts (title, author)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Intro to DeepRefs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, id </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> new_user;</span></span></code></pre></div><p>Refs spanning multiple columns take composite values as before:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> users</span></span>
<span class="line"><span style="color:#BABED8;">  (</span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">, (author </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">~ posts) ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> (id, title))</span></span>
<span class="line"><span style="color:#F78C6C;">VALUES</span></span>
<span class="line"><span style="color:#BABED8;">  (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, </span><span style="color:#F78C6C;">ROW</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">12</span><span style="color:#BABED8;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Intro to DeepRefs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">));</span></span></code></pre></div><h3 id="nested-and-mixed-chains" tabindex="-1">Nested and Mixed Chains <a class="header-anchor" href="#nested-and-mixed-chains" aria-label="Permalink to &quot;Nested and Mixed Chains&quot;">​</a></h3><p>As in the case of reads, refs can be multi-hop:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> comments</span></span>
<span class="line"><span style="color:#BABED8;">  (</span><span style="color:#C792EA;">text</span><span style="color:#BABED8;">, post ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> name</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">VALUES</span></span>
<span class="line"><span style="color:#BABED8;">  (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Brilliant work!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">);</span></span></code></pre></div><p>For refs that alternate direction across levels to model defined relationships, each change of arrow (<code>~&gt;</code> or <code>&lt;~</code>) introduces a new dependency edge, and each path is resolved depth-first.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#BABED8;">  (title, (post </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">~ comments) ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">, email))</span></span>
<span class="line"><span style="color:#F78C6C;">VALUES</span></span>
<span class="line"><span style="color:#BABED8;">  (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Nice post!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, </span><span style="color:#F78C6C;">ROW</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ada@example.com</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">));</span></span></code></pre></div><p>Here, each direction change reverses the dependency orientation while preserving referential closure:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>Command:</span></span>
<span class="line"><span>INSERT post → comment → author  (create this structure)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Execution order:</span></span>
<span class="line"><span>  1. CREATE post (title)</span></span>
<span class="line"><span>  2. CREATE user (name, email)</span></span>
<span class="line"><span>  3. CREATE comment (linked to post.id, user.id)</span></span></code></pre></div><h3 id="default-and-derived-sources" tabindex="-1">Default and Derived Sources <a class="header-anchor" href="#default-and-derived-sources" aria-label="Permalink to &quot;Default and Derived Sources&quot;">​</a></h3><p>Default and derived sources integrate seamlessly with DeepRefs.<br> Both preserve dependency ordering and transactional behavior.</p><p>PostgreSQL has the <code>INSERT ... DEFAULT VALUES</code> syntax:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#BABED8;">  (title, author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">, email))</span></span>
<span class="line"><span style="color:#C792EA;">DEFAULT</span><span style="color:#F78C6C;"> VALUES</span><span style="color:#BABED8;">;</span></span></code></pre></div><p>That expands conceptually to:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> inserted_authors </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">  INSERT INTO</span><span style="color:#BABED8;"> users (</span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">, email)</span></span>
<span class="line"><span style="color:#C792EA;">  DEFAULT</span><span style="color:#F78C6C;"> VALUES</span></span>
<span class="line"><span style="color:#BABED8;">  RETURNING id</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> posts (title, author)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#C792EA;"> DEFAULT</span><span style="color:#BABED8;">, id </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> inserted_authors;</span></span></code></pre></div><p>Both PostgreSQL and MySQL have the <code>INSERT ... SELECT</code> syntax:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#BABED8;">  (id, title, author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">, email))</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> id, title, </span><span style="color:#F78C6C;">ROW</span><span style="color:#BABED8;">(customer_name, customer_email)</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> orders;</span></span></code></pre></div><p>That expands conceptually to:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> source_orders </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">  SELECT</span><span style="color:#BABED8;"> id, title, customer_name, customer_email </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> orders</span></span>
<span class="line"><span style="color:#BABED8;">),</span></span>
<span class="line"><span style="color:#BABED8;">inserted_authors </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">  INSERT INTO</span><span style="color:#BABED8;"> users (</span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">, email)</span></span>
<span class="line"><span style="color:#F78C6C;">  SELECT</span><span style="color:#BABED8;"> customer_name, customer_email </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> source_orders</span></span>
<span class="line"><span style="color:#BABED8;">  RETURNING id</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> posts (id, title, author)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> o.id, o.title, a.id</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> source_orders </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> o</span></span>
<span class="line"><span style="color:#F78C6C;">JOIN</span><span style="color:#BABED8;"> inserted_authors </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> a </span><span style="color:#F78C6C;">ON</span><span style="color:#BABED8;"> deterministic </span><span style="color:#F78C6C;">row</span><span style="color:#BABED8;"> alignment;</span></span></code></pre></div><p>Each row from the source query becomes one complete relational structure and executes deterministically within the same transaction.</p><h3 id="upserts" tabindex="-1">Upserts <a class="header-anchor" href="#upserts" aria-label="Permalink to &quot;Upserts&quot;">​</a></h3><p>DeepRefs are fully supported in <a href="./upsert">UPSERT</a> operations — being just a variation of the <code>INSERT</code> statement.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#BABED8;">UPSERT </span><span style="color:#F78C6C;">INTO</span><span style="color:#BABED8;"> posts</span></span>
<span class="line"><span style="color:#BABED8;">  (title, author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> name</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">VALUES</span></span>
<span class="line"><span style="color:#BABED8;">  (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Intro to DeepRefs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">);</span></span></code></pre></div><p>This executes depth-first, with dependency order preserved as in inserts:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>Command:</span></span>
<span class="line"><span>UPSERT post → author → name  (materialize this structure — create or update)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Execution order:</span></span>
<span class="line"><span>  1. UPSERT user (name)</span></span>
<span class="line"><span>  2. UPSERT post (linked to user.id)</span></span></code></pre></div><p>That expands conceptually to a dialect-aware upsert:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> resolved_authors </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">  INSERT INTO</span><span style="color:#BABED8;"> users (</span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">  VALUES</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">  ON</span><span style="color:#BABED8;"> CONFLICT (</span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  DO </span><span style="color:#F78C6C;">UPDATE</span><span style="color:#F78C6C;"> SET</span><span style="color:#F78C6C;"> name</span><span style="color:#89DDFF;"> =</span><span style="color:#BABED8;"> EXCLUDED.name</span></span>
<span class="line"><span style="color:#BABED8;">  RETURNING id</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> posts (title, author)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Intro to DeepRefs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, id </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> resolved_authors</span></span>
<span class="line"><span style="color:#F78C6C;">ON</span><span style="color:#BABED8;"> CONFLICT (title)</span></span>
<span class="line"><span style="color:#BABED8;">DO </span><span style="color:#F78C6C;">UPDATE</span><span style="color:#F78C6C;"> SET</span><span style="color:#BABED8;"> author </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> EXCLUDED.author;</span></span></code></pre></div><h4 id="explicit-conditionals-conflict-handling" tabindex="-1">Explicit Conditionals (Conflict-Handling) <a class="header-anchor" href="#explicit-conditionals-conflict-handling" aria-label="Permalink to &quot;Explicit Conditionals (Conflict-Handling)&quot;">​</a></h4><p>For the explicit <code>INSERT ... ON CONFLICT</code> form of upserts, refs remain traversable inside conflict-handling clauses.<br> The specified path is traversed only when the conflict condition is triggered.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#BABED8;"> posts (title)</span></span>
<span class="line"><span style="color:#F78C6C;">VALUES</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Intro to DeepRefs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">ON</span><span style="color:#BABED8;"> CONFLICT (title)</span></span>
<span class="line"><span style="color:#BABED8;">DO </span><span style="color:#F78C6C;">UPDATE</span><span style="color:#F78C6C;"> SET</span><span style="color:#BABED8;"> author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;"> name</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">;</span></span></code></pre></div><p>Here, if a post with the same title already exists, the <code>ON CONFLICT</code> clause updates the author’s name through the <code>author</code> reference, rather than overwriting the foreign key.</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>Command:</span></span>
<span class="line"><span>CONDITIONALLY UPDATE post → author → name  (update existing structure through refs)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Execution order:</span></span>
<span class="line"><span>  1. UPDATE post (title)</span></span>
<span class="line"><span>  2. UPDATE user (name)</span></span></code></pre></div><h3 id="updates" tabindex="-1">Updates <a class="header-anchor" href="#updates" aria-label="Permalink to &quot;Updates&quot;">​</a></h3><p>Updates execute <strong>left-to-right</strong>, regardless of traversal direction.<br> These also execute in a single transaction and maintain referential coherence across the chain.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">UPDATE</span><span style="color:#BABED8;"> posts </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p</span></span>
<span class="line"><span style="color:#F78C6C;">SET</span><span style="color:#BABED8;"> author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">name</span><span style="color:#BABED8;">, email) </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> ROW</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ada@example.com</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> p.title </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Intro to DeepRefs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">;</span></span></code></pre></div><p>This resolves sequentially, so deeper mutations apply to the results of prior paths within the same statement:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>Command:</span></span>
<span class="line"><span>UPDATE post → author → (name, email)  (update this structure)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Evaluation order:</span></span>
<span class="line"><span>  1. UPDATE post ()</span></span>
<span class="line"><span>  2. UPDATE user (name, email)</span></span></code></pre></div><p>That expands conceptually to:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">WITH</span><span style="color:#BABED8;"> updated_posts </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">  UPDATE</span><span style="color:#BABED8;"> posts p</span></span>
<span class="line"><span style="color:#F78C6C;">  SET</span><span style="color:#BABED8;"> ...</span></span>
<span class="line"><span style="color:#BABED8;">  RETURNING p.author</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#F78C6C;">UPDATE</span><span style="color:#BABED8;"> users</span></span>
<span class="line"><span style="color:#F78C6C;">SET</span><span style="color:#F78C6C;"> name</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Ada Lovelace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">, email </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">ada@example.com</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> id </span><span style="color:#F78C6C;">IN</span><span style="color:#BABED8;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> author </span><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> updated_posts);</span></span></code></pre></div><h3 id="deletes" tabindex="-1">Deletes <a class="header-anchor" href="#deletes" aria-label="Permalink to &quot;Deletes&quot;">​</a></h3><p>For deletes, refs have their place in the <code>WHERE</code> clause.<br> Each ref simply expands to a relational join that filters the target rows before deletion.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">DELETE</span><span style="color:#F78C6C;"> FROM</span><span style="color:#BABED8;"> users</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#BABED8;"> (author </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">~ posts) ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> title </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Intro to DeepRefs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">;</span></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>Command:</span></span>
<span class="line"><span>DELETE user (remove rows matching this relationship)</span></span></code></pre></div><h3 id="mutation-summary" tabindex="-1">Mutation Summary <a class="header-anchor" href="#mutation-summary" aria-label="Permalink to &quot;Mutation Summary&quot;">​</a></h3><ul><li><strong>Resolution (<code>~&gt;</code>, <code>&lt;~</code>)</strong> — dependencies resolve first, with primary keys binding up the structure.</li><li><strong>Atomicity</strong> — every structural mutation, regardless of complexity, compiles into <strong>one SQL statement</strong>.</li><li><strong>Consistency</strong> — referential integrity is always schema-driven.</li><li><strong>Determinism</strong> — the same mutation yields the same dependency plan.</li></ul><h2 id="foreign-key-scopes" tabindex="-1">Foreign Key Scopes <a class="header-anchor" href="#foreign-key-scopes" aria-label="Permalink to &quot;Foreign Key Scopes&quot;">​</a></h2><p>Foreign keys in LinkedQL&#39;s relational space retain their semantics across query scopes.<br> This means, foreign keys projected from an inner query or inherited from an outer query can be traversed seamlessly as <em>refs</em> across the query boundary.</p><h4 id="foreign-key-projected-from-an-inner-query" tabindex="-1">Foreign Key Projected from an Inner Query <a class="header-anchor" href="#foreign-key-projected-from-an-inner-query" aria-label="Permalink to &quot;Foreign Key Projected from an Inner Query&quot;">​</a></h4><p>A foreign key projected from a derived query remains traversable in the outer scope:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> dt.post_fk ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> title </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> post_title, dt.author_fk ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> email </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> author_email</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#F78C6C;">    SELECT</span><span style="color:#BABED8;"> c.post </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> post_fk, c.post ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> author </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> author_fk</span></span>
<span class="line"><span style="color:#F78C6C;">    FROM</span><span style="color:#BABED8;"> comments </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> c</span></span>
<span class="line"><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> dt;</span></span></code></pre></div><p>Here, the inner query projects <code>post_fk</code> and <code>author_fk</code> as output columns.<br> Each crosses the query boundary as a foreign key and naturally supports traversal.</p><h4 id="foreign-key-inherited-from-an-outer-query" tabindex="-1">Foreign Key Inherited from an Outer Query <a class="header-anchor" href="#foreign-key-inherited-from-an-outer-query" aria-label="Permalink to &quot;Foreign Key Inherited from an Outer Query&quot;">​</a></h4><p>A foreign key from an outer query can be referenced within an inner scope, allowing DeepRefs to resolve normally inside the subquery.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> p.title, (</span></span>
<span class="line"><span style="color:#F78C6C;">    SELECT</span><span style="color:#F78C6C;"> name</span></span>
<span class="line"><span style="color:#F78C6C;">    FROM</span><span style="color:#BABED8;"> users </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u</span></span>
<span class="line"><span style="color:#F78C6C;">    WHERE</span><span style="color:#BABED8;"> u.email </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> p.author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> email</span></span>
<span class="line"><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> author_name</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p;</span></span></code></pre></div><p>Here, the inner subquery inherits <code>p.author</code> from each row in the outer query.<br> That crosses the query boundary as a foreign key and naturally supports traversal.</p><p>The same semantics apply within <strong>LATERAL</strong> joins, where the derived table depends on the current row of an outer <em>FROM</em> item:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#BABED8;"> p.title, sub.name </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> author_name, sub.email </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> author_email</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> posts </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> p</span></span>
<span class="line"><span style="color:#F78C6C;">LEFT JOIN</span><span style="color:#BABED8;"> LATERAL (</span></span>
<span class="line"><span style="color:#F78C6C;">    SELECT</span><span style="color:#F78C6C;"> name</span><span style="color:#BABED8;">, email</span></span>
<span class="line"><span style="color:#F78C6C;">    FROM</span><span style="color:#BABED8;"> users </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> u</span></span>
<span class="line"><span style="color:#F78C6C;">    WHERE</span><span style="color:#BABED8;"> u.email </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> p.author ~</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> email</span></span>
<span class="line"><span style="color:#F78C6C;">    LIMIT</span><span style="color:#F78C6C;"> 1</span></span>
<span class="line"><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> sub </span><span style="color:#F78C6C;">ON</span><span style="color:#BABED8;"> TRUE;</span></span></code></pre></div><p>The LATERAL clause inherits <code>p</code> row by row, and traversal works naturally as before.</p><h3 id="scope-summary" tabindex="-1">Scope Summary <a class="header-anchor" href="#scope-summary" aria-label="Permalink to &quot;Scope Summary&quot;">​</a></h3><p>Essentially, any foreign key in scope — whether inherited or projected — retains its relational meaning and can be traversed as a DeepRef.</p><h2 id="appendix-a-—-implied-schema-and-dialect" tabindex="-1">Appendix A — Implied Schema and Dialect <a class="header-anchor" href="#appendix-a-—-implied-schema-and-dialect" aria-label="Permalink to &quot;Appendix A — Implied Schema and Dialect&quot;">​</a></h2><p>The examples in this document assume a simple illustrative schema and a specific SQL dialect.</p><h3 id="default-dialect" tabindex="-1">Default Dialect <a class="header-anchor" href="#default-dialect" aria-label="Permalink to &quot;Default Dialect&quot;">​</a></h3><p>Unless otherwise noted, all examples assume the <strong>PostgreSQL</strong> syntax and semantics.<br> Equivalent behavior applies across other SQL dialects (e.g., MySQL, MariaDB) <strong>where supported</strong>.</p><h3 id="reference-schema" tabindex="-1">Reference Schema <a class="header-anchor" href="#reference-schema" aria-label="Permalink to &quot;Reference Schema&quot;">​</a></h3><p>The following minimal schema underpins most examples:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#F78C6C;"> TABLE</span><span style="color:#82AAFF;"> users</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">  id </span><span style="color:#C792EA;">SERIAL</span><span style="color:#C792EA;"> PRIMARY KEY</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#F78C6C;">  name</span><span style="color:#C792EA;"> TEXT</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  email </span><span style="color:#C792EA;">TEXT</span></span>
<span class="line"><span style="color:#BABED8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#F78C6C;"> TABLE</span><span style="color:#82AAFF;"> posts</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">  id </span><span style="color:#C792EA;">SERIAL</span><span style="color:#C792EA;"> PRIMARY KEY</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  title </span><span style="color:#C792EA;">TEXT</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  author </span><span style="color:#C792EA;">INTEGER</span><span style="color:#C792EA;"> REFERENCES</span><span style="color:#BABED8;"> users (id)</span></span>
<span class="line"><span style="color:#BABED8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#F78C6C;"> TABLE</span><span style="color:#82AAFF;"> comments</span><span style="color:#BABED8;"> (</span></span>
<span class="line"><span style="color:#BABED8;">  id </span><span style="color:#C792EA;">SERIAL</span><span style="color:#C792EA;"> PRIMARY KEY</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#C792EA;">  text</span><span style="color:#C792EA;"> TEXT</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  post </span><span style="color:#C792EA;">INTEGER</span><span style="color:#C792EA;"> REFERENCES</span><span style="color:#BABED8;"> posts (id)</span></span>
<span class="line"><span style="color:#BABED8;">);</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/capabilities" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>Capabilities Overview</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/capabilities/json-literals" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>JSON Literals</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>MIT Licensed</p><p class="copyright" data-v-e315a0ad>© Oxford Harrison</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"capabilities.md\":\"BztTe5GT\",\"capabilities_deeprefs.md\":\"CYOx2SXL\",\"capabilities_json-literals.md\":\"rGE9X-tr\",\"capabilities_live-queries.md\":\"CHhoCYV3\",\"capabilities_upsert.md\":\"hDNJkkyH\",\"docs.md\":\"CwIgAZwB\",\"docs_query-api.md\":\"Bm8hN7oZ\",\"docs_setup.md\":\"xW8pIM-m\",\"engineering_realtime-engine.md\":\"D0WkL5Ze\",\"flashql.md\":\"dxGRqIGO\",\"flashql_foreign-io.md\":\"B-X4SFru\",\"flashql_lang.md\":\"-dKEfD4V\",\"index.md\":\"BsUu5Xl8\",\"overview.md\":\"CIcdfHfj\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"LinkedQL\",\"description\":\"A modern take on SQL and SQL databases — with reactivity, versioning, and more.\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":\"force-dark\",\"themeConfig\":{\"logo\":{\"src\":\"/img/brand/linked-ql-logo.png\",\"height\":140},\"siteTitle\":false,\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/linked-db/linked-ql\"}],\"nav\":[{\"text\":\"What is LinkedQL\",\"link\":\"/overview\",\"activeMatch\":\"/overview\"},{\"text\":\"Capabilities\",\"link\":\"/capabilities\",\"activeMatch\":\"/capabilities\"},{\"text\":\"Docs\",\"link\":\"/docs\",\"activeMatch\":\"/docs\"},{\"text\":\"FlashQL\",\"link\":\"/flashql\",\"activeMatch\":\"/flashql\"},{\"text\":\"Engineering\",\"link\":\"/engineering/realtime-engine\",\"activeMatch\":\"/engineering\"},{\"text\":\"Star on GitHub\",\"link\":\"https://github.com/linked-db/linked-ql\"}],\"sidebar\":{\"/\":[{\"text\":\"Overview\",\"items\":[{\"text\":\"What is LinkedQL\",\"link\":\"/overview\"}]},{\"text\":\"Docs\",\"items\":[{\"text\":\"Getting Started\",\"link\":\"/docs\"},{\"text\":\"Dialects & Clients\",\"link\":\"/docs/setup\"},{\"text\":\"Query Interface\",\"link\":\"/docs/query-api\"}]},{\"text\":\"Capabilities\",\"items\":[{\"text\":\"Capabilities Overview\",\"link\":\"/capabilities\"},{\"text\":\"DeepRefs\",\"link\":\"/capabilities/deeprefs\"},{\"text\":\"JSON Literals\",\"link\":\"/capabilities/json-literals\"},{\"text\":\"UPSERT\",\"link\":\"/capabilities/upsert\"},{\"text\":\"Realtime SQL\",\"link\":\"/capabilities/realtime-sql\"}]},{\"text\":\"FlashQL\",\"items\":[{\"text\":\"FlashQL Overview\",\"link\":\"/flashql\"},{\"text\":\"Federation & Sync\",\"link\":\"/flashql/foreign-io\"},{\"text\":\"Language Reference\",\"link\":\"/flashql/lang\"}]},{\"text\":\"Engineering\",\"items\":[{\"text\":\"Realtime Engine\",\"link\":\"/engineering/realtime-engine\"}]}]},\"footer\":{\"message\":\"MIT Licensed\",\"copyright\":\"© Oxford Harrison\"},\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>